{"version":3,"file":"erpnext.min.js","sources":["../../../apps/erpnext/erpnext/public/js/conf.js","../../../apps/erpnext/erpnext/public/js/utils.js","../../../apps/erpnext/erpnext/public/js/queries.js","../../../apps/erpnext/erpnext/public/js/sms_manager.js","../../../apps/erpnext/erpnext/public/js/utils/party.js","../../../apps/erpnext/erpnext/public/js/controllers/stock_controller.js","../../../apps/erpnext/erpnext/public/js/payment/payments.js","../../../apps/erpnext/erpnext/public/js/controllers/taxes_and_totals.js","../../../apps/erpnext/erpnext/public/js/controllers/transaction.js","../../../apps/erpnext/erpnext/public/js/utils/item_selector.js","../../../apps/erpnext/erpnext/public/js/help_links.js","../../../apps/erpnext/erpnext/public/js/agriculture/ternary_plot.js","../../../apps/erpnext/erpnext/public/js/utils/item_quick_entry.js","../../../apps/erpnext/erpnext/public/js/utils/customer_quick_entry.js","../../../apps/erpnext/erpnext/public/js/hub/hub_factory.js","../../../apps/erpnext/erpnext/public/js/call_popup/call_popup.js","../../../apps/erpnext/erpnext/public/js/utils/dimension_tree_filter.js"],"sourcesContent":["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide('erpnext');\n\n// preferred modules for breadcrumbs\n$.extend(frappe.breadcrumbs.preferred, {\n\t\"Item Group\": \"Stock\",\n\t\"Customer Group\": \"Selling\",\n\t\"Supplier Group\": \"Buying\",\n\t\"Territory\": \"Selling\",\n\t\"Sales Person\": \"Selling\",\n\t\"Sales Partner\": \"Selling\",\n\t\"Brand\": \"Stock\",\n\t\"Maintenance Schedule\": \"Support\",\n\t\"Maintenance Visit\": \"Support\"\n});\n\n$.extend(frappe.breadcrumbs.module_map, {\n\t'ERPNext Integrations': 'Integrations',\n\t'Geo': 'Settings',\n\t'Portal': 'Website',\n\t'Utilities': 'Settings',\n\t'Shopping Cart': 'Website',\n\t'Contacts': 'CRM'\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\nfrappe.provide(\"erpnext\");\nfrappe.provide(\"erpnext.utils\");\n\n$.extend(erpnext, {\n\tget_currency: function(company) {\n\t\tif(!company && cur_frm)\n\t\t\tcompany = cur_frm.doc.company;\n\t\tif(company)\n\t\t\treturn frappe.get_doc(\":Company\", company).default_currency || frappe.boot.sysdefaults.currency;\n\t\telse\n\t\t\treturn frappe.boot.sysdefaults.currency;\n\t},\n\n\tget_presentation_currency_list: () => {\n\t\tconst docs = frappe.boot.docs;\n\t\tlet currency_list = docs.filter(d => d.doctype === \":Currency\").map(d => d.name);\n\t\tcurrency_list.unshift(\"\");\n\t\treturn currency_list;\n\t},\n\n\ttoggle_naming_series: function() {\n\t\tif(cur_frm.fields_dict.naming_series) {\n\t\t\tcur_frm.toggle_display(\"naming_series\", cur_frm.doc.__islocal?true:false);\n\t\t}\n\t},\n\n\thide_company: function() {\n\t\tif(cur_frm.fields_dict.company) {\n\t\t\tvar companies = Object.keys(locals[\":Company\"] || {});\n\t\t\tif(companies.length === 1) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", companies[0]);\n\t\t\t\tcur_frm.toggle_display(\"company\", false);\n\t\t\t} else if(erpnext.last_selected_company) {\n\t\t\t\tif(!cur_frm.doc.company) cur_frm.set_value(\"company\", erpnext.last_selected_company);\n\t\t\t}\n\t\t}\n\t},\n\n\tis_perpetual_inventory_enabled: function(company) {\n\t\tif(company) {\n\t\t\treturn frappe.get_doc(\":Company\", company).enable_perpetual_inventory\n\t\t}\n\t},\n\n\tstale_rate_allowed: () => {\n\t\treturn cint(frappe.boot.sysdefaults.allow_stale);\n\t},\n\n\tsetup_serial_no: function() {\n\t\tvar grid_row = cur_frm.open_grid_row();\n\t\tif(!grid_row || !grid_row.grid_form.fields_dict.serial_no ||\n\t\t\tgrid_row.grid_form.fields_dict.serial_no.get_status()!==\"Write\") return;\n\n\t\tvar $btn = $('<button class=\"btn btn-sm btn-default\">'+__(\"Add Serial No\")+'</button>')\n\t\t\t.appendTo($(\"<div>\")\n\t\t\t\t.css({\"margin-bottom\": \"10px\", \"margin-top\": \"10px\"})\n\t\t\t\t.appendTo(grid_row.grid_form.fields_dict.serial_no.$wrapper));\n\n\t\tvar me = this;\n\t\t$btn.on(\"click\", function() {\n\t\t\tlet callback = '';\n\t\t\tlet on_close = '';\n\n\t\t\tfrappe.model.get_value('Item', {'name':grid_row.doc.item_code}, 'has_serial_no',\n\t\t\t\t(data) => {\n\t\t\t\t\tif(data) {\n\t\t\t\t\t\tgrid_row.doc.has_serial_no = data.has_serial_no;\n\t\t\t\t\t\tme.show_serial_batch_selector(grid_row.frm, grid_row.doc,\n\t\t\t\t\t\t\tcallback, on_close, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\n\troute_to_adjustment_jv: (args) => {\n\t\tfrappe.model.with_doctype('Journal Entry', () => {\n\t\t\t// route to adjustment Journal Entry to handle Account Balance and Stock Value mismatch\n\t\t\tlet journal_entry = frappe.model.get_new_doc('Journal Entry');\n\n\t\t\targs.accounts.forEach((je_account) => {\n\t\t\t\tlet child_row = frappe.model.add_child(journal_entry, \"accounts\");\n\t\t\t\tchild_row.account = je_account.account;\n\t\t\t\tchild_row.debit_in_account_currency = je_account.debit_in_account_currency;\n\t\t\t\tchild_row.credit_in_account_currency = je_account.credit_in_account_currency;\n\t\t\t\tchild_row.party_type = \"\" ;\n\t\t\t});\n\t\t\tfrappe.set_route('Form','Journal Entry', journal_entry.name);\n\t\t});\n\t}\n});\n\n\n$.extend(erpnext.utils, {\n\tset_party_dashboard_indicators: function(frm) {\n\t\tif(frm.doc.__onload && frm.doc.__onload.dashboard_info) {\n\t\t\tvar company_wise_info = frm.doc.__onload.dashboard_info;\n\t\t\tif(company_wise_info.length > 1) {\n\t\t\t\tcompany_wise_info.forEach(function(info) {\n\t\t\t\t\terpnext.utils.add_indicator_for_multicompany(frm, info);\n\t\t\t\t});\n\t\t\t} else if (company_wise_info.length === 1) {\n\t\t\t\tfrm.dashboard.add_indicator(__('Annual Billing: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].billing_this_year, company_wise_info[0].currency)]), 'blue');\n\t\t\t\tfrm.dashboard.add_indicator(__('Total Unpaid: {0}',\n\t\t\t\t\t[format_currency(company_wise_info[0].total_unpaid, company_wise_info[0].currency)]),\n\t\t\t\tcompany_wise_info[0].total_unpaid ? 'orange' : 'green');\n\n\t\t\t\tif(company_wise_info[0].loyalty_points) {\n\t\t\t\t\tfrm.dashboard.add_indicator(__('Loyalty Points: {0}',\n\t\t\t\t\t\t[company_wise_info[0].loyalty_points]), 'blue');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tadd_indicator_for_multicompany: function(frm, info) {\n\t\tfrm.dashboard.stats_area.removeClass('hidden');\n\t\tfrm.dashboard.stats_area_row.addClass('flex');\n\t\tfrm.dashboard.stats_area_row.css('flex-wrap', 'wrap');\n\n\t\tvar color = info.total_unpaid ? 'orange' : 'green';\n\n\t\tvar indicator = $('<div class=\"flex-column col-xs-6\">'+\n\t\t\t'<div style=\"margin-top:10px\"><h6>'+info.company+'</h6></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Annual Billing: '+format_currency(info.billing_this_year, info.currency)+'</span></div>'+\n\n\t\t\t'<div class=\"badge-link small\" style=\"margin-bottom:10px\">'+\n\t\t\t'<span class=\"indicator '+color+'\">Total Unpaid: '\n\t\t\t+format_currency(info.total_unpaid, info.currency)+'</span></div>'+\n\n\n\t\t\t'</div>').appendTo(frm.dashboard.stats_area_row);\n\n\t\tif(info.loyalty_points){\n\t\t\t$('<div class=\"badge-link small\" style=\"margin-bottom:10px\"><span class=\"indicator blue\">'+\n\t\t\t'Loyalty Points: '+info.loyalty_points+'</span></div>').appendTo(indicator);\n\t\t}\n\n\t\treturn indicator;\n\t},\n\n\tget_party_name: function(party_type) {\n\t\tvar dict = {'Customer': 'customer_name', 'Supplier': 'supplier_name', 'Employee': 'employee_name',\n\t\t\t'Member': 'member_name'};\n\t\treturn dict[party_type];\n\t},\n\n\tcopy_value_in_all_rows: function(doc, dt, dn, table_fieldname, fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tif(!cl[i][fieldname]) cl[i][fieldname] = d[fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tget_terms: function(tc_name, doc, callback) {\n\t\tif(tc_name) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: 'erpnext.setup.doctype.terms_and_conditions.terms_and_conditions.get_terms_and_conditions',\n\t\t\t\targs: {\n\t\t\t\t\ttemplate_name: tc_name,\n\t\t\t\t\tdoc: doc\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcallback(r)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_bank_account: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.bank_account.bank_account.make_bank_account\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tfreeze: true,\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tadd_dimensions: function(report_name, index) {\n\t\tlet filters = frappe.query_reports[report_name].filters;\n\n\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\tlet found = filters.some(el => el.fieldname === dimension['fieldname']);\n\n\t\t\tif (!found) {\n\t\t\t\tfilters.splice(index, 0 ,{\n\t\t\t\t\t\"fieldname\": dimension[\"fieldname\"],\n\t\t\t\t\t\"label\": __(dimension[\"label\"]),\n\t\t\t\t\t\"fieldtype\": \"Link\",\n\t\t\t\t\t\"options\": dimension[\"document_type\"]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_subscription: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.automation.doctype.auto_repeat.auto_repeat.make_auto_repeat\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\tmake_pricing_rule: function(doctype, docname) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.make_pricing_rule\",\n\t\t\targs: {\n\t\t\t\tdoctype: doctype,\n\t\t\t\tdocname: docname\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t}\n\t\t})\n\t},\n\n\t/**\n\t* Checks if the first row of a given child table is empty\n\t* @param child_table - Child table Doctype\n\t* @return {Boolean}\n\t**/\n\tfirst_row_is_empty: function(child_table){\n\t\tif($.isArray(child_table) && child_table.length > 0) {\n\t\t\treturn !child_table[0].item_code;\n\t\t}\n\t\treturn false;\n\t},\n\n\t/**\n\t* Removes the first row of a child table if it is empty\n\t* @param {_Frm} frm - The current form\n\t* @param {String} child_table_name - The child table field name\n\t* @return {Boolean}\n\t**/\n\tremove_empty_first_row: function(frm, child_table_name){\n\t\tconst rows = frm['doc'][child_table_name];\n\t\tif (this.first_row_is_empty(rows)){\n\t\t\tfrm['doc'][child_table_name] = rows.splice(1);\n\t\t}\n\t\treturn rows;\n\t},\n\tget_tree_options: function(option) {\n\t\t// get valid options for tree based on user permission & locals dict\n\t\tlet unscrub_option = frappe.model.unscrub(option);\n\t\tlet user_permission = frappe.defaults.get_user_permissions();\n\t\tlet options;\n\n\t\tif(user_permission && user_permission[unscrub_option]) {\n\t\t\toptions = user_permission[unscrub_option].map(perm => perm.doc);\n\t\t} else {\n\t\t\toptions = $.map(locals[`:${unscrub_option}`], function(c) { return c.name; }).sort();\n\t\t}\n\n\t\t// filter unique values, as there may be multiple user permissions for any value\n\t\treturn options.filter((value, index, self) => self.indexOf(value) === index);\n\t},\n\tget_tree_default: function(option) {\n\t\t// set default for a field based on user permission\n\t\tlet options = this.get_tree_options(option);\n\t\tif(options.includes(frappe.defaults.get_default(option))) {\n\t\t\treturn frappe.defaults.get_default(option);\n\t\t} else {\n\t\t\treturn options[0];\n\t\t}\n\t},\n\tcopy_parent_value_in_all_row: function(doc, dt, dn, table_fieldname, fieldname, parent_fieldname) {\n\t\tvar d = locals[dt][dn];\n\t\tif(d[fieldname]){\n\t\t\tvar cl = doc[table_fieldname] || [];\n\t\t\tfor(var i = 0; i < cl.length; i++) {\n\t\t\t\tcl[i][fieldname] = doc[parent_fieldname];\n\t\t\t}\n\t\t}\n\t\trefresh_field(table_fieldname);\n\t},\n\n\tcreate_new_doc: function (doctype, update_fields) {\n\t\tfrappe.model.with_doctype(doctype, function() {\n\t\t\tvar new_doc = frappe.model.get_new_doc(doctype);\n\t\t\tfor (let [key, value] of Object.entries(update_fields)) {\n\t\t\t\tnew_doc[key] = value;\n\t\t\t}\n\t\t\tfrappe.ui.form.make_quick_entry(doctype, null, null, new_doc);\n\t\t});\n\t}\n\n});\n\nerpnext.utils.select_alternate_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst warehouse_field = opts.warehouse_field || 'warehouse';\n\tconst item_field = opts.item_field || 'item_code';\n\n\tthis.data = [];\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Select Alternate Item\"),\n\t\tfields: [\n\t\t\t{fieldtype:'Section Break', label: __('Items')},\n\t\t\t{\n\t\t\t\tfieldname: \"alternative_items\", fieldtype: \"Table\", cannot_add_rows: true,\n\t\t\t\tin_place_edit: true, data: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: [{\n\t\t\t\t\tfieldtype:'Data',\n\t\t\t\t\tfieldname:\"docname\",\n\t\t\t\t\thidden: 1\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"item_code\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tlabel: __('Item Code')\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"alternate_item\",\n\t\t\t\t\toptions: 'Item',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Alternate Item'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst item_code = this.get_value();\n\t\t\t\t\t\tconst warehouse = this.grid_row.on_grid_fields_dict.warehouse.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tget_query: (e) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tquery: \"erpnext.stock.doctype.item_alternative.item_alternative.get_alternative_items\",\n\t\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\t\titem_code: e.item_code\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Link',\n\t\t\t\t\tfieldname:\"warehouse\",\n\t\t\t\t\toptions: 'Warehouse',\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Warehouse'),\n\t\t\t\t\tonchange: function() {\n\t\t\t\t\t\tconst warehouse = this.get_value();\n\t\t\t\t\t\tconst item_code = this.grid_row.on_grid_fields_dict.item_code.get_value();\n\t\t\t\t\t\tif (item_code && warehouse) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.stock.utils.get_latest_stock_qty\",\n\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\titem_code: item_code,\n\t\t\t\t\t\t\t\t\twarehouse: warehouse\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tthis.grid_row.on_grid_fields_dict\n\t\t\t\t\t\t\t\t\t\t.actual_qty.set_value(r.message || 0);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}, {\n\t\t\t\t\tfieldtype:'Float',\n\t\t\t\t\tfieldname:\"actual_qty\",\n\t\t\t\t\tdefault: 0,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t\tin_list_view: 1,\n\t\t\t\t\tlabel: __('Available Qty')\n\t\t\t\t}]\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst args = this.get_values()[\"alternative_items\"];\n\t\t\tconst alternative_items = args.filter(d => {\n\t\t\t\tif (d.alternate_item && d.item_code != d.alternate_item) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\talternative_items.forEach(d => {\n\t\t\t\tlet row = frappe.get_doc(opts.child_doctype, d.docname);\n\t\t\t\tlet qty = null;\n\t\t\t\tif (row.doctype === 'Work Order Item') {\n\t\t\t\t\tqty = row.required_qty;\n\t\t\t\t} else {\n\t\t\t\t\tqty = row.qty;\n\t\t\t\t}\n\t\t\t\trow[item_field] = d.alternate_item;\n\t\t\t\tfrm.script_manager.trigger(item_field, row.doctype, row.name)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, 'qty', qty);\n\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name,\n\t\t\t\t\t\t\topts.original_item_field, d.item_code);\n\t\t\t\t\t});\n\t\t\t});\n\n\t\t\trefresh_field(opts.child_docname);\n\t\t\tthis.hide();\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tif (!opts.condition || opts.condition(d)) {\n\t\t\tdialog.fields_dict.alternative_items.df.data.push({\n\t\t\t\t\"docname\": d.name,\n\t\t\t\t\"item_code\": d[item_field],\n\t\t\t\t\"warehouse\": d[warehouse_field],\n\t\t\t\t\"actual_qty\": d.actual_qty\n\t\t\t});\n\t\t}\n\t})\n\n\tthis.data = dialog.fields_dict.alternative_items.df.data;\n\tdialog.fields_dict.alternative_items.grid.refresh();\n\tdialog.show();\n}\n\nerpnext.utils.update_child_items = function(opts) {\n\tconst frm = opts.frm;\n\tconst cannot_add_row = (typeof opts.cannot_add_row === 'undefined') ? true : opts.cannot_add_row;\n\tconst child_docname = (typeof opts.cannot_add_row === 'undefined') ? \"items\" : opts.child_docname;\n\tconst child_meta = frappe.get_meta(`${frm.doc.doctype} Item`);\n\tconst get_precision = (fieldname) => child_meta.fields.find(f => f.fieldname == fieldname).precision;\n\n\tthis.data = [];\n\tconst fields = [{\n\t\tfieldtype:'Data',\n\t\tfieldname:\"docname\",\n\t\tread_only: 1,\n\t\thidden: 1,\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:\"item_code\",\n\t\toptions: 'Item',\n\t\tin_list_view: 1,\n\t\tread_only: 0,\n\t\tdisabled: 0,\n\t\tlabel: __('Item Code')\n\t}, {\n\t\tfieldtype:'Link',\n\t\tfieldname:'uom',\n\t\toptions: 'UOM',\n\t\tread_only: 0,\n\t\tlabel: __('UOM'),\n\t\treqd: 1,\n\t\tonchange: function () {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\targs: { item_code: this.doc.item_code, uom: this.value },\n\t\t\t\tcallback: r => {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif (this.doc.conversion_factor == r.message.conversion_factor) return;\n\n\t\t\t\t\t\tconst docname = this.doc.docname;\n\t\t\t\t\t\tdialog.fields_dict.trans_items.df.data.some(doc => {\n\t\t\t\t\t\t\tif (doc.docname == docname) {\n\t\t\t\t\t\t\t\tdoc.conversion_factor = r.message.conversion_factor;\n\t\t\t\t\t\t\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, {\n\t\tfieldtype:'Float',\n\t\tfieldname:\"qty\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Qty'),\n\t\tprecision: get_precision(\"qty\")\n\t}, {\n\t\tfieldtype:'Currency',\n\t\tfieldname:\"rate\",\n\t\tdefault: 0,\n\t\tread_only: 0,\n\t\tin_list_view: 1,\n\t\tlabel: __('Rate'),\n\t\tprecision: get_precision(\"rate\")\n\t}];\n\n\tif (frm.doc.doctype == 'Sales Order' || frm.doc.doctype == 'Purchase Order' ) {\n\t\tfields.splice(2, 0, {\n\t\t\tfieldtype: 'Date',\n\t\t\tfieldname: frm.doc.doctype == 'Sales Order' ? \"delivery_date\" : \"schedule_date\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: frm.doc.doctype == 'Sales Order' ? __(\"Delivery Date\") : __(\"Reqd by date\"),\n\t\t\treqd: 1\n\t\t})\n\t\tfields.splice(3, 0, {\n\t\t\tfieldtype: 'Float',\n\t\t\tfieldname: \"conversion_factor\",\n\t\t\tin_list_view: 1,\n\t\t\tlabel: __(\"Conversion Factor\"),\n\t\t\tprecision: get_precision('conversion_factor')\n\t\t})\n\t}\n\n\tconst dialog = new frappe.ui.Dialog({\n\t\ttitle: __(\"Update Items\"),\n\t\tfields: [\n\t\t\t{\n\t\t\t\tfieldname: \"trans_items\",\n\t\t\t\tfieldtype: \"Table\",\n\t\t\t\tlabel: \"Items\",\n\t\t\t\tcannot_add_rows: cannot_add_row,\n\t\t\t\tin_place_edit: true,\n\t\t\t\treqd: 1,\n\t\t\t\tdata: this.data,\n\t\t\t\tget_data: () => {\n\t\t\t\t\treturn this.data;\n\t\t\t\t},\n\t\t\t\tfields: fields\n\t\t\t},\n\t\t],\n\t\tprimary_action: function() {\n\t\t\tconst trans_items = this.get_values()[\"trans_items\"];\n\t\t\tfrappe.call({\n\t\t\t\tmethod: 'erpnext.controllers.accounts_controller.update_child_qty_rate',\n\t\t\t\tfreeze: true,\n\t\t\t\targs: {\n\t\t\t\t\t'parent_doctype': frm.doc.doctype,\n\t\t\t\t\t'trans_items': trans_items,\n\t\t\t\t\t'parent_doctype_name': frm.doc.name,\n\t\t\t\t\t'child_docname': child_docname\n\t\t\t\t},\n\t\t\t\tcallback: function() {\n\t\t\t\t\tfrm.reload_doc();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.hide();\n\t\t\trefresh_field(\"items\");\n\t\t},\n\t\tprimary_action_label: __('Update')\n\t});\n\n\tfrm.doc[opts.child_docname].forEach(d => {\n\t\tdialog.fields_dict.trans_items.df.data.push({\n\t\t\t\"docname\": d.name,\n\t\t\t\"name\": d.name,\n\t\t\t\"item_code\": d.item_code,\n\t\t\t\"delivery_date\": d.delivery_date,\n\t\t\t\"schedule_date\": d.schedule_date,\n\t\t\t\"conversion_factor\": d.conversion_factor,\n\t\t\t\"qty\": d.qty,\n\t\t\t\"rate\": d.rate,\n\t\t\t\"uom\": d.uom\n\t\t});\n\t\tthis.data = dialog.fields_dict.trans_items.df.data;\n\t\tdialog.fields_dict.trans_items.grid.refresh();\n\t})\n\tdialog.show();\n}\n\nerpnext.utils.map_current_doc = function(opts) {\n\tlet query_args = {};\n\tif (opts.get_query_filters) {\n\t\tquery_args.filters = opts.get_query_filters;\n\t}\n\n\tif (opts.get_query_method) {\n\t\tquery_args.query = opts.get_query_method;\n\t}\n\n\tif (query_args.filters || query_args.query) {\n\t\topts.get_query = () => {\n\t\t\treturn query_args;\n\t\t}\n\t}\n\tvar _map = function() {\n\t\tif($.isArray(cur_frm.doc.items) && cur_frm.doc.items.length > 0) {\n\t\t\t// remove first item row if empty\n\t\t\tif(!cur_frm.doc.items[0].item_code) {\n\t\t\t\tcur_frm.doc.items = cur_frm.doc.items.splice(1);\n\t\t\t}\n\n\t\t\t// find the doctype of the items table\n\t\t\tvar items_doctype = frappe.meta.get_docfield(cur_frm.doctype, 'items').options;\n\n\t\t\t// find the link fieldname from items table for the given\n\t\t\t// source_doctype\n\t\t\tvar link_fieldname = null;\n\t\t\tfrappe.get_meta(items_doctype).fields.forEach(function(d) {\n\t\t\t\tif(d.options===opts.source_doctype) link_fieldname = d.fieldname; });\n\n\t\t\t// search in existing items if the source_name is already set and full qty fetched\n\t\t\tvar already_set = false;\n\t\t\tvar item_qty_map = {};\n\n\t\t\t$.each(cur_frm.doc.items, function(i, d) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tif(d[link_fieldname]==src) {\n\t\t\t\t\t\talready_set = true;\n\t\t\t\t\t\tif (item_qty_map[d.item_code])\n\t\t\t\t\t\t\titem_qty_map[d.item_code] += flt(d.qty);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\titem_qty_map[d.item_code] = flt(d.qty);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif(already_set) {\n\t\t\t\topts.source_name.forEach(function(src) {\n\t\t\t\t\tfrappe.model.with_doc(opts.source_doctype, src, function(r) {\n\t\t\t\t\t\tvar source_doc = frappe.model.get_doc(opts.source_doctype, src);\n\t\t\t\t\t\t$.each(source_doc.items || [], function(i, row) {\n\t\t\t\t\t\t\tif(row.qty > flt(item_qty_map[row.item_code])) {\n\t\t\t\t\t\t\t\talready_set = false;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\n\t\t\t\t\tif(already_set) {\n\t\t\t\t\t\tfrappe.msgprint(__(\"You have already selected items from {0} {1}\",\n\t\t\t\t\t\t\t[opts.source_doctype, src]));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\treturn frappe.call({\n\t\t\t// Sometimes we hit the limit for URL length of a GET request\n\t\t\t// as we send the full target_doc. Hence this is a POST request.\n\t\t\ttype: \"POST\",\n\t\t\tmethod: 'frappe.model.mapper.map_docs',\n\t\t\targs: {\n\t\t\t\t\"method\": opts.method,\n\t\t\t\t\"source_names\": opts.source_name,\n\t\t\t\t\"target_doc\": cur_frm.doc,\n\t\t\t\t\"args\": opts.args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tcur_frm.dirty();\n\t\t\t\t\tcur_frm.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\tif(opts.source_doctype) {\n\t\tvar d = new frappe.ui.form.MultiSelectDialog({\n\t\t\tdoctype: opts.source_doctype,\n\t\t\ttarget: opts.target,\n\t\t\tdate_field: opts.date_field || undefined,\n\t\t\tsetters: opts.setters,\n\t\t\tget_query: opts.get_query,\n\t\t\tadd_filters_group: 1,\n\t\t\taction: function(selections, args) {\n\t\t\t\tlet values = selections;\n\t\t\t\tif(values.length === 0){\n\t\t\t\t\tfrappe.msgprint(__(\"Please select {0}\", [opts.source_doctype]))\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\topts.source_name = values;\n\t\t\t\topts.setters = args;\n\t\t\t\td.dialog.hide();\n\t\t\t\t_map();\n\t\t\t},\n\t\t});\n\t} else if(opts.source_name) {\n\t\topts.source_name = [opts.source_name];\n\t\t_map();\n\t}\n}\n\nfrappe.form.link_formatters['Item'] = function(value, doc) {\n\tif (doc && value && doc.item_name && doc.item_name !== value) {\n\t\treturn value + ': ' + doc.item_name;\n\t} else if (!value && doc.doctype && doc.item_name) {\n\t\t// format blank value in child table\n\t\treturn doc.item_name;\n\t} else {\n\t\t// if value is blank in report view or item code and name are the same, return as is\n\t\treturn value;\n\t}\n}\n\nfrappe.form.link_formatters['Employee'] = function(value, doc) {\n\tif(doc && doc.employee_name && doc.employee_name !== value) {\n\t\treturn value? value + ': ' + doc.employee_name: doc.employee_name;\n\t} else {\n\t\treturn value;\n\t}\n}\n\n// add description on posting time\n$(document).on('app_ready', function() {\n\tif(!frappe.datetime.is_timezone_same()) {\n\t\t$.each([\"Stock Reconciliation\", \"Stock Entry\", \"Stock Ledger Entry\",\n\t\t\t\"Delivery Note\", \"Purchase Receipt\", \"Sales Invoice\"], function(i, d) {\n\t\t\tfrappe.ui.form.on(d, \"onload\", function(frm) {\n\t\t\t\tcur_frm.set_df_property(\"posting_time\", \"description\",\n\t\t\t\t\tfrappe.sys_defaults.time_zone);\n\t\t\t});\n\t\t});\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// searches for enabled users\nfrappe.provide(\"erpnext.queries\");\n$.extend(erpnext.queries, {\n\tuser: function() {\n\t\treturn { query: \"frappe.core.doctype.user.user.user_query\" };\n\t},\n\n\tlead: function() {\n\t\treturn { query: \"erpnext.controllers.queries.lead_query\" };\n\t},\n\n\tcustomer: function() {\n\t\treturn { query: \"erpnext.controllers.queries.customer_query\" };\n\t},\n\n\tsupplier: function() {\n\t\treturn { query: \"erpnext.controllers.queries.supplier_query\" };\n\t},\n\n\titem: function(filters) {\n\t\tvar args = { query: \"erpnext.controllers.queries.item_query\" };\n\t\tif(filters) args[\"filters\"] = filters;\n\t\treturn args;\n\t},\n\n\tbom: function() {\n\t\treturn { query: \"erpnext.controllers.queries.bom\" };\n\t},\n\n\ttask: function() {\n\t\treturn { query: \"erpnext.projects.utils.query_task\" };\n\t},\n\n\tcustomer_filter: function(doc) {\n\t\tif(!doc.customer) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"customer\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { customer: doc.customer } };\n\t},\n\n\tcontact_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.contact.contact.contact_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\taddress_query: function(doc) {\n\t\tif(frappe.dynamic_link) {\n\t\t\tif(!doc[frappe.dynamic_link.fieldname]) {\n\t\t\t\tfrappe.throw(__(\"Please set {0}\",\n\t\t\t\t\t[__(frappe.meta.get_label(doc.doctype, frappe.dynamic_link.fieldname, doc.name))]));\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\t\tfilters: {\n\t\t\t\t\tlink_doctype: frappe.dynamic_link.doctype,\n\t\t\t\t\tlink_name: doc[frappe.dynamic_link.fieldname]\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t},\n\n\tcompany_address_query: function(doc) {\n\t\treturn {\n\t\t\tquery: 'frappe.contacts.doctype.address.address.address_query',\n\t\t\tfilters: { is_your_company_address: 1, link_doctype: 'Company', link_name: doc.company || '' }\n\t\t};\n\t},\n\n\tsupplier_filter: function(doc) {\n\t\tif(!doc.supplier) {\n\t\t\tfrappe.throw(__(\"Please set {0}\", [__(frappe.meta.get_label(doc.doctype, \"supplier\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { supplier: doc.supplier } };\n\t},\n\n\tlead_filter: function(doc) {\n\t\tif(!doc.lead) {\n\t\t\tfrappe.throw(__(\"Please specify a {0}\",\n\t\t\t\t[__(frappe.meta.get_label(doc.doctype, \"lead\", doc.name))]));\n\t\t}\n\n\t\treturn { filters: { lead: doc.lead } };\n\t},\n\n\tnot_a_group_filter: function() {\n\t\treturn { filters: { is_group: 0 } };\n\t},\n\n\temployee: function() {\n\t\treturn { query: \"erpnext.controllers.queries.employee_query\" }\n\t},\n\n\twarehouse: function(doc) {\n\t\treturn {\n\t\t\tfilters: [\n\t\t\t\t[\"Warehouse\", \"company\", \"in\", [\"\", cstr(doc.company)]],\n\t\t\t\t[\"Warehouse\", \"is_group\", \"=\",0]\n\n\t\t\t]\n\t\t}\n\t}\n});\n\nerpnext.queries.setup_queries = function(frm, options, query_fn) {\n\tvar me = this;\n\tvar set_query = function(doctype, parentfield) {\n\t\tvar link_fields = frappe.meta.get_docfields(doctype, frm.doc.name,\n\t\t\t{\"fieldtype\": \"Link\", \"options\": options});\n\t\t$.each(link_fields, function(i, df) {\n\t\t\tif(parentfield) {\n\t\t\t\tfrm.set_query(df.fieldname, parentfield, query_fn);\n\t\t\t} else {\n\t\t\t\tfrm.set_query(df.fieldname, query_fn);\n\t\t\t}\n\t\t});\n\t};\n\n\tset_query(frm.doc.doctype);\n\n\t// warehouse field in tables\n\t$.each(frappe.meta.get_docfields(frm.doc.doctype, frm.doc.name, {\"fieldtype\": \"Table\"}),\n\t\tfunction(i, df) {\n\t\t\tset_query(df.options, df.fieldname);\n\t\t});\n}\n\n/* \tif item code is selected in child table\n\tthen list down warehouses with its quantity\n\telse apply default filters.\n*/\nerpnext.queries.setup_warehouse_query = function(frm){\n\tfrm.set_query('warehouse', 'items', function(doc, cdt, cdn) {\n\t\tvar row  = locals[cdt][cdn];\n\t\tvar filters = erpnext.queries.warehouse(frm.doc);\n\t\tif(row.item_code){\n\t\t\t$.extend(filters, {\"query\":\"erpnext.controllers.queries.warehouse_query\"});\n\t\t\tfilters[\"filters\"].push([\"Bin\", \"item_code\", \"=\", row.item_code]);\n\t\t}\n\t\treturn filters\n\t});\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.SMSManager = function SMSManager(doc) {\n\tvar me = this;\n\tthis.setup = function() {\n\t\tvar default_msg = {\n\t\t\t'Lead'\t\t\t\t: '',\n\t\t\t'Opportunity'\t\t\t: 'Your enquiry has been logged into the system. Ref No: ' + doc.name,\n\t\t\t'Quotation'\t\t\t: 'Quotation ' + doc.name + ' has been sent via email. Thanks!',\n\t\t\t'Sales Order'\t\t: 'Sales Order ' + doc.name + ' has been created against '\n\t\t\t\t\t\t+ (doc.quotation_no ? ('Quote No:' + doc.quotation_no) : '')\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Delivery Note'\t\t: 'Items has been delivered against delivery note: ' + doc.name\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Sales Invoice': 'Invoice ' + doc.name + ' has been sent via email '\n\t\t\t\t\t\t+ (doc.po_no ? (' for your PO: ' + doc.po_no) : ''),\n\t\t\t'Material Request'\t\t\t: 'Material Request ' + doc.name + ' has been raised in the system',\n\t\t\t'Purchase Order'\t: 'Purchase Order ' + doc.name + ' has been sent via email',\n\t\t\t'Purchase Receipt'\t: 'Items has been received against purchase receipt: ' + doc.name\n\t\t}\n\n\t\tif (in_list(['Sales Order', 'Delivery Note', 'Sales Invoice'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.customer, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype === 'Quotation')\n\t\t\tthis.show(doc.contact_person, 'Customer', doc.party_name, '', default_msg[doc.doctype]);\n\t\telse if (in_list(['Purchase Order', 'Purchase Receipt'], doc.doctype))\n\t\t\tthis.show(doc.contact_person, 'Supplier', doc.supplier, '', default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Lead')\n\t\t\tthis.show('', '', '', doc.mobile_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Opportunity')\n\t\t\tthis.show('', '', '', doc.contact_no, default_msg[doc.doctype]);\n\t\telse if (doc.doctype == 'Material Request')\n\t\t\tthis.show('', '', '', '', default_msg[doc.doctype]);\n\n\t};\n\n\tthis.get_contact_number = function(contact, ref_doctype, ref_name) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.get_contact_number\",\n\t\t\targs: {\n\t\t\t\tcontact_name: contact,\n\t\t\t\tref_doctype: ref_doctype,\n\t\t\t\tref_name: ref_name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(r.exc) { frappe.msgprint(r.exc); return; }\n\t\t\t\tme.number = r.message;\n\t\t\t\tme.show_dialog();\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.show = function(contact, ref_doctype, ref_name, mobile_nos, message) {\n\t\tthis.message = message;\n\t\tif (mobile_nos) {\n\t\t\tme.number = mobile_nos;\n\t\t\tme.show_dialog();\n\t\t} else if (contact){\n\t\t\tthis.get_contact_number(contact, ref_doctype, ref_name)\n\t\t} else {\n\t\t\tme.show_dialog();\n\t\t}\n\t}\n\tthis.show_dialog = function() {\n\t\tif(!me.dialog)\n\t\t\tme.make_dialog();\n\t\tme.dialog.set_values({\n\t\t\t'message': me.message,\n\t\t\t'number': me.number\n\t\t})\n\t\tme.dialog.show();\n\t}\n\tthis.make_dialog = function() {\n\t\tvar d = new frappe.ui.Dialog({\n\t\t\ttitle: 'Send SMS',\n\t\t\twidth: 400,\n\t\t\tfields: [\n\t\t\t\t{fieldname:'number', fieldtype:'Data', label:'Mobile Number', reqd:1},\n\t\t\t\t{fieldname:'message', fieldtype:'Text', label:'Message', reqd:1},\n\t\t\t\t{fieldname:'send', fieldtype:'Button', label:'Send'}\n\t\t\t]\n\t\t})\n\t\td.fields_dict.send.input.onclick = function() {\n\t\t\tvar btn = d.fields_dict.send.input;\n\t\t\tvar v = me.dialog.get_values();\n\t\t\tif(v) {\n\t\t\t\t$(btn).set_working();\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.core.doctype.sms_settings.sms_settings.send_sms\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\treceiver_list: [v.number],\n\t\t\t\t\t\tmsg: v.message\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t$(btn).done_working();\n\t\t\t\t\t\tif(r.exc) {frappe.msgprint(r.exc); return; }\n\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tthis.dialog = d;\n\t}\n\tthis.setup();\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.utils\");\n\nerpnext.utils.get_party_details = function(frm, method, args, callback) {\n\tif (!method) {\n\t\tmethod = \"erpnext.accounts.party.get_party_details\";\n\t}\n\n\tif (args) {\n\t\tif (in_list(['Sales Invoice', 'Sales Order', 'Delivery Note'], frm.doc.doctype)) {\n\t\t\tif (frm.doc.company_address && (!args.company_address)) {\n\t\t\t\targs.company_address = frm.doc.company_address;\n\t\t\t}\n\t\t}\n\n\t\tif (in_list(['Purchase Invoice', 'Purchase Order', 'Purchase Receipt'], frm.doc.doctype)) {\n\t\t\tif (frm.doc.shipping_address && (!args.shipping_address)) {\n\t\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!args) {\n\t\tif ((frm.doctype != \"Purchase Order\" && frm.doc.customer)\n\t\t\t|| (frm.doc.party_name && in_list(['Quotation', 'Opportunity'], frm.doc.doctype))) {\n\n\t\t\tlet party_type = \"Customer\";\n\t\t\tif (frm.doc.quotation_to && frm.doc.quotation_to === \"Lead\") {\n\t\t\t\tparty_type = \"Lead\";\n\t\t\t}\n\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\tparty_type: party_type,\n\t\t\t\tprice_list: frm.doc.selling_price_list\n\t\t\t};\n\t\t} else if (frm.doc.supplier) {\n\t\t\targs = {\n\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\tparty_type: \"Supplier\",\n\t\t\t\tbill_date: frm.doc.bill_date,\n\t\t\t\tprice_list: frm.doc.buying_price_list\n\t\t\t};\n\t\t}\n\n\t\tif (in_list(['Sales Invoice', 'Sales Order', 'Delivery Note'], frm.doc.doctype)) {\n\t\t\tif (!args) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.customer || frm.doc.party_name,\n\t\t\t\t\tparty_type: 'Customer'\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (frm.doc.company_address && (!args.company_address)) {\n\t\t\t\targs.company_address = frm.doc.company_address;\n\t\t\t}\n\n\t\t\tif (frm.doc.shipping_address_name &&(!args.shipping_address_name)) {\n\t\t\t\targs.shipping_address_name = frm.doc.shipping_address_name;\n\t\t\t}\n\t\t}\n\n\t\tif (in_list(['Purchase Invoice', 'Purchase Order', 'Purchase Receipt'], frm.doc.doctype)) {\n\t\t\tif (!args) {\n\t\t\t\targs = {\n\t\t\t\t\tparty: frm.doc.supplier,\n\t\t\t\t\tparty_type: 'Supplier'\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (frm.doc.shipping_address && (!args.shipping_address)) {\n\t\t\t\targs.shipping_address = frm.doc.shipping_address;\n\t\t\t}\n\t\t}\n\n\t\tif (args) {\n\t\t\targs.posting_date = frm.doc.posting_date || frm.doc.transaction_date;\n\t\t}\n\t}\n\tif (!args || !args.party) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\targs.posting_date, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) return;\n\t}\n\n\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, args.party_type==\"Customer\" ? \"customer\": \"supplier\")) {\n\t\treturn;\n\t}\n\n\targs.currency = frm.doc.currency;\n\targs.company = frm.doc.company;\n\targs.doctype = frm.doc.doctype;\n\tfrappe.call({\n\t\tmethod: method,\n\t\targs: args,\n\t\tcallback: function(r) {\n\t\t\tif (r.message) {\n\t\t\t\tfrm.supplier_tds = r.message.supplier_tds;\n\t\t\t\tfrm.updating_party_details = true;\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frm.set_value(r.message),\n\t\t\t\t\t() => {\n\t\t\t\t\t\tfrm.updating_party_details = false;\n\t\t\t\t\t\tif (callback) callback();\n\t\t\t\t\t\tfrm.refresh();\n\t\t\t\t\t\terpnext.utils.add_item(frm);\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\t});\n}\n\nerpnext.utils.add_item = function(frm) {\n\tif (frm.is_new()) {\n\t\tvar prev_route = frappe.get_prev_route();\n\t\tif (prev_route[1]==='Item' && !(frm.doc.items && frm.doc.items.length)) {\n\t\t\t// add row\n\t\t\tvar item = frm.add_child('items');\n\t\t\tfrm.refresh_field('items');\n\n\t\t\t// set item\n\t\t\tfrappe.model.set_value(item.doctype, item.name, 'item_code', prev_route[2]);\n\t\t}\n\t}\n}\n\nerpnext.utils.get_address_display = function(frm, address_field, display_field, is_your_company_address) {\n\tif (frm.updating_party_details) return;\n\n\tif (!address_field) {\n\t\tif (frm.doctype != \"Purchase Order\" && frm.doc.customer) {\n\t\t\taddress_field = \"customer_address\";\n\t\t} else if (frm.doc.supplier) {\n\t\t\taddress_field = \"supplier_address\";\n\t\t} else return;\n\t}\n\n\tif (!display_field) display_field = \"address_display\";\n\tif (frm.doc[address_field]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.address.address.get_address_display\",\n\t\t\targs: {\"address_dict\": frm.doc[address_field] },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message) {\n\t\t\t\t\tfrm.set_value(display_field, r.message)\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t} else {\n\t\tfrm.set_value(display_field, '');\n\t}\n};\n\nerpnext.utils.set_taxes_from_address = function(frm, triggered_from_field, billing_address_field, shipping_address_field) {\n\tif (frm.updating_party_details) return;\n\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.get_address_tax_category\",\n\t\targs: {\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": frm.doc[billing_address_field],\n\t\t\t\"shipping_address\": frm.doc[shipping_address_field]\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (!r.exc){\n\t\t\t\tif (frm.doc.tax_category != r.message) {\n\t\t\t\t\tfrm.set_value(\"tax_category\", r.message);\n\t\t\t\t} else {\n\t\t\t\t\terpnext.utils.set_taxes(frm, triggered_from_field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.set_taxes = function(frm, triggered_from_field) {\n\tif (frappe.meta.get_docfield(frm.doc.doctype, \"taxes\")) {\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Company\", frm.doc.company, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Lead / Customer / Supplier\",\n\t\t\tfrm.doc.customer || frm.doc.supplier || frm.doc.lead || frm.doc.party_name, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!erpnext.utils.validate_mandatory(frm, \"Posting / Transaction Date\",\n\t\t\tfrm.doc.posting_date || frm.doc.transaction_date, triggered_from_field)) {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tvar party_type, party;\n\tif (frm.doc.lead) {\n\t\tparty_type = 'Lead';\n\t\tparty = frm.doc.lead;\n\t} else if (frm.doc.customer) {\n\t\tparty_type = 'Customer';\n\t\tparty = frm.doc.customer;\n\t} else if (frm.doc.supplier) {\n\t\tparty_type = 'Supplier';\n\t\tparty = frm.doc.supplier;\n\t} else if (frm.doc.quotation_to){\n\t\tparty_type = frm.doc.quotation_to;\n\t\tparty = frm.doc.party_name;\n\t}\n\n\tif (!frm.doc.company) {\n\t\tfrappe.throw(__(\"Kindly select the company first\"));\n\t}\n\n\tfrappe.call({\n\t\tmethod: \"erpnext.accounts.party.set_taxes\",\n\t\targs: {\n\t\t\t\"party\": party,\n\t\t\t\"party_type\": party_type,\n\t\t\t\"posting_date\": frm.doc.posting_date || frm.doc.transaction_date,\n\t\t\t\"company\": frm.doc.company,\n\t\t\t\"customer_group\": frm.doc.customer_group,\n\t\t\t\"supplier_group\": frm.doc.supplier_group,\n\t\t\t\"tax_category\": frm.doc.tax_category,\n\t\t\t\"billing_address\": ((frm.doc.customer || frm.doc.lead) ? (frm.doc.customer_address) : (frm.doc.supplier_address)),\n\t\t\t\"shipping_address\": frm.doc.shipping_address_name\n\t\t},\n\t\tcallback: function(r) {\n\t\t\tif (r.message){\n\t\t\t\tfrm.set_value(\"taxes_and_charges\", r.message)\n\t\t\t}\n\t\t}\n\t});\n};\n\nerpnext.utils.get_contact_details = function(frm) {\n\tif (frm.updating_party_details) return;\n\n\tif (frm.doc[\"contact_person\"]) {\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.contacts.doctype.contact.contact.get_contact_details\",\n\t\t\targs: {contact: frm.doc.contact_person },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (r.message)\n\t\t\t\t\tfrm.set_value(r.message);\n\t\t\t}\n\t\t})\n\t}\n}\n\nerpnext.utils.validate_mandatory = function(frm, label, value, trigger_on) {\n\tif (!value) {\n\t\tfrm.doc[trigger_on] = \"\";\n\t\trefresh_field(trigger_on);\n\t\tfrappe.throw({message:__(\"Please enter {0} first\", [label]), title:__(\"Mandatory\")});\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nerpnext.utils.get_shipping_address = function(frm, callback){\n\tif (frm.doc.company) {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.accounts.custom.address.get_shipping_address\",\n\t\t\targs: {\n\t\t\t\tcompany: frm.doc.company,\n\t\t\t\taddress: frm.doc.shipping_address\n\t\t\t},\n\t\t\tcallback: function(r){\n\t\t\t\tif (r.message){\n\t\t\t\t\tfrm.set_value(\"shipping_address\", r.message[0]) //Address title or name\n\t\t\t\t\tfrm.set_value(\"shipping_address_display\", r.message[1]) //Address to be displayed on the page\n\t\t\t\t}\n\n\t\t\t\tif (callback){\n\t\t\t\t\treturn callback();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\tfrappe.msgprint(__(\"Select company first\"));\n\t}\n}\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"erpnext.stock\");\n\nerpnext.stock.StockController = frappe.ui.form.Controller.extend({\n\tonload: function() {\n\t\t// warehouse query if company\n\t\tif (this.frm.fields_dict.company) {\n\t\t\tthis.setup_warehouse_query();\n\t\t}\n\t},\n\n\tsetup_warehouse_query: function() {\n\t\tvar me = this;\n\t\terpnext.queries.setup_queries(this.frm, \"Warehouse\", function() {\n\t\t\treturn erpnext.queries.warehouse(me.frm.doc);\n\t\t});\n\t},\n\n\tsetup_posting_date_time_check: function() {\n\t\t// make posting date default and read only unless explictly checked\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_date_and_time_read_only', function(frm) {\n\t\t\tif(frm.doc.docstatus == 0 && frm.doc.set_posting_time) {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 0);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 0);\n\t\t\t} else {\n\t\t\t\tfrm.set_df_property('posting_date', 'read_only', 1);\n\t\t\t\tfrm.set_df_property('posting_time', 'read_only', 1);\n\t\t\t}\n\t\t})\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'set_posting_time', function(frm) {\n\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, 'refresh', function(frm) {\n\t\t\t// set default posting date / time\n\t\t\tif(frm.doc.docstatus==0) {\n\t\t\t\tif(!frm.doc.posting_date) {\n\t\t\t\t\tfrm.set_value('posting_date', frappe.datetime.nowdate());\n\t\t\t\t}\n\t\t\t\tif(!frm.doc.posting_time) {\n\t\t\t\t\tfrm.set_value('posting_time', frappe.datetime.now_time());\n\t\t\t\t}\n\t\t\t\tfrm.trigger('set_posting_date_and_time_read_only');\n\t\t\t}\n\t\t});\n\t},\n\n\tshow_stock_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__(\"Stock Ledger\"), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"Stock Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\n\t},\n\n\tshow_general_ledger: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.docstatus > 0) {\n\t\t\tcur_frm.add_custom_button(__('Accounting Ledger'), function() {\n\t\t\t\tfrappe.route_options = {\n\t\t\t\t\tvoucher_no: me.frm.doc.name,\n\t\t\t\t\tfrom_date: me.frm.doc.posting_date,\n\t\t\t\t\tto_date: moment(me.frm.doc.modified).format('YYYY-MM-DD'),\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\tgroup_by: \"Group by Voucher (Consolidated)\",\n\t\t\t\t\tshow_cancelled_entries: me.frm.doc.docstatus === 2\n\t\t\t\t};\n\t\t\t\tfrappe.set_route(\"query-report\", \"General Ledger\");\n\t\t\t}, __(\"View\"));\n\t\t}\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.payments = erpnext.stock.StockController.extend({\n\tmake_payment: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: 'Payment'\n\t\t});\n\t\n\t\tthis.dialog.show();\n\t\tthis.$body = this.dialog.body;\n\t\tthis.set_payment_primary_action();\n\t\tthis.make_keyboard();\n\t\tthis.select_text()\n\t},\n\n\tselect_text: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\t$(this).select();\n\t\t})\n\t},\n\n\tset_payment_primary_action: function(){\n\t\tvar me = this;\n\t\n\t\tthis.dialog.set_primary_action(__(\"Submit\"), function() {\n\t\t\t// Allow no ZERO payment\n\t\t\t$.each(me.frm.doc.payments, function (index, data) {\n\t\t\t\tif (data.amount != 0) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\tme.submit_invoice();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t},\n\n\tmake_keyboard: function(){\n\t\tvar me = this;\n\t\t$(this.$body).empty();\n\t\t$(this.$body).html(frappe.render_template('pos_payment', this.frm.doc))\n\t\tthis.show_payment_details();\n\t\tthis.bind_keyboard_event()\n\t\tthis.clear_amount()\n\t},\n\n\tmake_multimode_payment: function(){\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.change_amount > 0){\n\t\t\tme.payment_val = me.doc.outstanding_amount\n\t\t}\n\n\t\tthis.payments = frappe.model.add_child(this.frm.doc, 'Multi Mode Payment', \"payments\");\n\t\tthis.payments.mode_of_payment = this.dialog.fields_dict.mode_of_payment.get_value();\n\t\tthis.payments.amount = flt(this.payment_val);\n\t},\n\n\tshow_payment_details: function(){\n\t\tvar me = this;\n\t\tvar multimode_payments = $(this.$body).find('.multimode-payments').empty();\n\t\tif(this.frm.doc.payments.length){\n\t\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\t\t$(frappe.render_template('payment_details', {\n\t\t\t\t\tmode_of_payment: data.mode_of_payment,\n\t\t\t\t\tamount: data.amount,\n\t\t\t\t\tidx: data.idx,\n\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\ttype: data.type\n\t\t\t\t})).appendTo(multimode_payments)\n\n\t\t\t\tif (data.type == 'Cash' && data.amount == me.frm.doc.paid_amount) {\n\t\t\t\t\tme.idx = data.idx;\n\t\t\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\t\t\tme.highlight_selected_row();\n\t\t\t\t\tme.bind_amount_change_event();\n\t\t\t\t}\n\t\t\t})\n\t\t}else{\n\t\t\t$(\"<p>No payment mode selected in pos profile</p>\").appendTo(multimode_payments)\n\t\t}\n\t},\n\n\tset_outstanding_amount: function(){\n\t\tthis.selected_mode = $(this.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': this.idx}));\n\t\tthis.highlight_selected_row()\n\t\tthis.payment_val = 0.0\n\t\tif(this.frm.doc.outstanding_amount > 0 && flt(this.selected_mode.val()) == 0.0){\n\t\t\t//When user first time click on row\n\t\t\tthis.payment_val = flt(this.frm.doc.outstanding_amount / this.frm.doc.conversion_rate, precision(\"outstanding_amount\"))\n\t\t\tthis.selected_mode.val(format_currency(this.payment_val, this.frm.doc.currency));\n\t\t\tthis.update_payment_amount()\n\t\t}else if(flt(this.selected_mode.val()) > 0){\n\t\t\t//If user click on existing row which has value\n\t\t\tthis.payment_val = flt(this.selected_mode.val());\n\t\t}\n\t\tthis.selected_mode.select()\n\t\tthis.bind_amount_change_event();\n\t},\n\t\n\tbind_keyboard_event: function(){\n\t\tvar me = this;\n\t\tthis.payment_val = '';\n\t\tthis.bind_form_control_event();\n\t\tthis.bind_numeric_keys_event();\n\t},\n\n\tbind_form_control_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-payment-row').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.form-control').click(function(){\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.set_outstanding_amount();\n\t\t\tme.update_paid_amount(true);\n\t\t})\n\t\t\n\t\t$(this.$body).find('.write_off_amount').change(function(){\n\t\t\tme.write_off_amount(flt($(this).val()), precision(\"write_off_amount\"));\n\t\t})\n\t\t\n\t\t$(this.$body).find('.change_amount').change(function(){\n\t\t\tme.change_amount(flt($(this).val()), precision(\"change_amount\"));\n\t\t})\n\t},\n\n\thighlight_selected_row: function(){\n\t\tvar me = this;\n\t\tvar selected_row = $(this.$body).find(repl(\".pos-payment-row[idx='%(idx)s']\",{'idx': this.idx}));\n\t\t$(this.$body).find('.pos-payment-row').removeClass('selected-payment-mode')\n\t\tselected_row.addClass('selected-payment-mode')\n\t\t$(this.$body).find('.amount').attr('disabled', true);\n\t\tthis.selected_mode.attr('disabled', false);\n\t},\n\t\n\tbind_numeric_keys_event: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find('.pos-keyboard-key').click(function(){\n\t\t\tme.payment_val += $(this).text();\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount()\n\t\t})\n\t\t\n\t\t$(this.$body).find('.delete-btn').click(function(){\n\t\t\tme.payment_val =  cstr(flt(me.selected_mode.val())).slice(0, -1);\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency));\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_paid_amount();\n\t\t})\n\n\t},\n\t\n\tbind_amount_change_event: function(){\n\t\tvar me = this;\n\t\tthis.selected_mode.change(function(){\n\t\t\tme.payment_val =  flt($(this).val()) || 0.0;\n\t\t\tme.selected_mode.val(format_currency(me.payment_val, me.frm.doc.currency))\n\t\t\tme.idx = me.selected_mode.attr(\"idx\")\n\t\t\tme.update_payment_amount()\n\t\t})\n\t},\n\n\tclear_amount: function() {\n\t\tvar me = this;\n\t\t$(this.$body).find('.clr').click(function(e){\n\t\t\te.stopPropagation();\n\t\t\tme.idx = $(this).attr(\"idx\");\n\t\t\tme.selected_mode = $(me.$body).find(repl(\"input[idx='%(idx)s']\",{'idx': me.idx}));\n\t\t\tme.payment_val = 0.0;\n\t\t\tme.selected_mode.val(0.0);\n\t\t\tme.highlight_selected_row();\n\t\t\tme.update_payment_amount();\n\t\t})\n\t},\n\n\twrite_off_amount: function(write_off_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.write_off_amount = flt(write_off_amount, precision(\"write_off_amount\"));\n\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\tprecision(\"base_write_off_amount\"));\n\t\tthis.calculate_outstanding_amount(false)\n\t\tthis.show_amounts()\n\t},\n\n\tchange_amount: function(change_amount) {\n\t\tvar me = this;\n\n\t\tthis.frm.doc.change_amount = flt(change_amount, precision(\"change_amount\"));\n\t\tthis.calculate_write_off_amount()\n\t\tthis.show_amounts()\n\t},\n\n\tupdate_paid_amount: function(update_write_off) {\n\t\tvar me = this;\n\t\tif(in_list(['change_amount', 'write_off_amount'], this.idx)){\n\t\t\tvar value = me.selected_mode.val();\n\t\t\tif(me.idx == 'change_amount'){\n\t\t\t\tme.change_amount(value)\n\t\t\t} else{\n\t\t\t\tif(flt(value) == 0 && update_write_off && me.frm.doc.outstanding_amount > 0) {\n\t\t\t\t\tvalue = flt(me.frm.doc.outstanding_amount / me.frm.doc.conversion_rate, precision(me.idx));\n\t\t\t\t}\n\t\t\t\tme.write_off_amount(value)\n\t\t\t}\n\t\t}else{\n\t\t\tthis.update_payment_amount()\n\t\t}\n\t},\n\n\tupdate_payment_amount: function(){\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc.payments, function(index, data){\n\t\t\tif(cint(me.idx) == cint(data.idx)){\n\t\t\t\tdata.amount = flt(me.selected_mode.val(), 2)\n\t\t\t}\n\t\t})\n\n\t\tthis.calculate_outstanding_amount(false);\n\t\tthis.show_amounts();\n\t},\n\n\tshow_amounts: function(){\n\t\tvar me = this;\n\t\t$(this.$body).find(\".write_off_amount\").val(format_currency(this.frm.doc.write_off_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.paid_amount').text(format_currency(this.frm.doc.paid_amount, this.frm.doc.currency));\n\t\t$(this.$body).find('.change_amount').val(format_currency(this.frm.doc.change_amount, this.frm.doc.currency))\n\t\t$(this.$body).find('.outstanding_amount').text(format_currency(this.frm.doc.outstanding_amount, frappe.get_doc(\":Company\", this.frm.doc.company).default_currency))\n\t\tthis.update_invoice();\n\t}\n})","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.taxes_and_totals = erpnext.payments.extend({\n\tsetup: function() {},\n\n\tapply_pricing_rule_on_item: function(item){\n\t\tlet effective_item_rate = item.price_list_rate;\n\t\tif (in_list([\"Sales Order\", \"Quotation\"], item.parenttype) && item.blanket_order_rate) {\n\t\t\teffective_item_rate = item.blanket_order_rate;\n\t\t}\n\t\tif(item.margin_type == \"Percentage\"){\n\t\t\titem.rate_with_margin = flt(effective_item_rate)\n\t\t\t\t+ flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n\t\t} else {\n\t\t\titem.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n\t\t}\n\t\titem.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n\n\t\titem.rate = flt(item.rate_with_margin , precision(\"rate\", item));\n\n\t\tif(item.discount_percentage){\n\t\t\titem.discount_amount = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n\t\t}\n\n\t\tif (item.discount_amount) {\n\t\t\titem.rate = flt((item.rate_with_margin) - (item.discount_amount), precision('rate', item));\n\t\t}\n\t},\n\n\tcalculate_taxes_and_totals: function(update_paid_amount) {\n\t\tthis.discount_amount_applied = false;\n\t\tthis._calculate_taxes_and_totals();\n\t\tthis.calculate_discount_amount();\n\n\t\t// Advance calculation applicable to Sales /Purchase Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.docstatus < 2 && !this.frm.doc.is_return) {\n\t\t\tthis.calculate_total_advance(update_paid_amount);\n\t\t}\n\n\t\tif (in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_pos &&\n\t\t\tthis.frm.doc.is_return) {\n\t\t\tthis.update_paid_amount_for_return();\n\t\t}\n\n\t\t// Sales person's commission\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.calculate_commission();\n\t\t\tthis.calculate_contribution();\n\t\t}\n\n\t\t// Update paid amount on return/debit note creation\n\t\tif(this.frm.doc.doctype === \"Purchase Invoice\" && this.frm.doc.is_return\n\t\t\t&& (this.frm.doc.grand_total > this.frm.doc.paid_amount)) {\n\t\t\tthis.frm.doc.paid_amount = flt(this.frm.doc.grand_total, precision(\"grand_total\"));\n\t\t}\n\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tcalculate_discount_amount: function(){\n\t\tif (frappe.meta.get_docfield(this.frm.doc.doctype, \"discount_amount\")) {\n\t\t\tthis.set_discount_amount();\n\t\t\tthis.apply_discount_amount();\n\t\t}\n\t},\n\n\t_calculate_taxes_and_totals: function() {\n\t\tthis.validate_conversion_rate();\n\t\tthis.calculate_item_values();\n\t\tthis.initialize_taxes();\n\t\tthis.determine_exclusive_rate();\n\t\tthis.calculate_net_total();\n\t\tthis.calculate_taxes();\n\t\tthis.manipulate_grand_total_for_inclusive_tax();\n\t\tthis.calculate_totals();\n\t\tthis._cleanup();\n\t},\n\n\tvalidate_conversion_rate: function() {\n\t\tthis.frm.doc.conversion_rate = flt(this.frm.doc.conversion_rate, (cur_frm) ? precision(\"conversion_rate\") : 9);\n\t\tvar conversion_rate_label = frappe.meta.get_label(this.frm.doc.doctype, \"conversion_rate\",\n\t\t\tthis.frm.doc.name);\n\t\tvar company_currency = this.get_company_currency();\n\n\t\tif(!this.frm.doc.conversion_rate) {\n\t\t\tif(this.frm.doc.currency == company_currency) {\n\t\t\t\tthis.frm.set_value(\"conversion_rate\", 1);\n\t\t\t} else {\n\t\t\t\tconst err_message = __('{0} is mandatory. Maybe Currency Exchange record is not created for {1} to {2}', [\n\t\t\t\t\tconversion_rate_label,\n\t\t\t\t\tthis.frm.doc.currency,\n\t\t\t\t\tcompany_currency\n\t\t\t\t]);\n\t\t\t\tfrappe.throw(err_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_item_values: function() {\n\t\tvar me = this;\n\t\tif (!this.discount_amount_applied) {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\tfrappe.model.round_floats_in(item);\n\t\t\t\titem.net_rate = item.rate;\n\n\t\t\t\tif ((!item.qty) && me.frm.doc.is_return) {\n\t\t\t\t\titem.amount = flt(item.rate * -1, precision(\"amount\", item));\n\t\t\t\t} else {\n\t\t\t\t\titem.amount = flt(item.rate * item.qty, precision(\"amount\", item));\n\t\t\t\t}\n\n\t\t\t\titem.net_amount = item.amount;\n\t\t\t\titem.item_tax_amount = 0.0;\n\t\t\t\titem.total_weight = flt(item.weight_per_unit * item.stock_qty);\n\n\t\t\t\tme.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_in_company_currency: function(doc, fields) {\n\t\tvar me = this;\n\t\t$.each(fields, function(i, f) {\n\t\t\tdoc[\"base_\"+f] = flt(flt(doc[f], precision(f, doc)) * me.frm.doc.conversion_rate, precision(\"base_\" + f, doc));\n\t\t});\n\t},\n\n\tinitialize_taxes: function() {\n\t\tvar me = this;\n\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\ttax.item_wise_tax_detail = {};\n\t\t\tvar tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n\t\t\t\t\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif (cstr(tax.charge_type) != \"Actual\" &&\n\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\ttax_fields.push(\"tax_amount\");\n\t\t\t}\n\n\t\t\t$.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n\n\t\t\tif (!this.discount_amount_applied && cur_frm) {\n\t\t\t\tcur_frm.cscript.validate_taxes_and_charges(tax.doctype, tax.name);\n\t\t\t\tme.validate_inclusive_tax(tax);\n\t\t\t}\n\t\t\tfrappe.model.round_floats_in(tax);\n\t\t});\n\t},\n\n\tdetermine_exclusive_rate: function() {\n\t\tvar me = this;\n\n\t\tvar has_inclusive_tax = false;\n\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n\t\t\tif(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n\t\t});\n\t\tif(has_inclusive_tax==false) return;\n\n\t\t$.each(me.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\tvar cumulated_tax_fraction = 0.0;\n\t\t\tvar total_inclusive_tax_amount_per_qty = 0;\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tvar current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n\t\t\t\ttax.tax_fraction_for_current_item = current_tax_fraction[0];\n\t\t\t\tvar inclusive_tax_amount_per_qty = current_tax_fraction[1];\n\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_fraction_for_current_item =\n\t\t\t\t\t\tme.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n\t\t\t\t\t\ttax.tax_fraction_for_current_item;\n\t\t\t\t}\n\n\t\t\t\tcumulated_tax_fraction += tax.tax_fraction_for_current_item;\n\t\t\t\ttotal_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n\t\t\t});\n\n\t\t\tif(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n\t\t\t\tvar amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n\t\t\t\titem.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\n\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t}\n\t\t});\n\t},\n\n\tget_current_tax_fraction: function(tax, item_tax_map) {\n\t\t// Get tax fraction for calculating tax exclusive amount\n\t\t// from tax inclusive amount\n\t\tvar current_tax_fraction = 0.0;\n\t\tvar inclusive_tax_amount_per_qty = 0;\n\n\t\tif(cint(tax.included_in_print_rate)) {\n\t\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\n\t\t\tif(tax.charge_type == \"On Net Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0);\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_fraction_for_current_item;\n\n\t\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\t\tcurrent_tax_fraction = (tax_rate / 100.0) *\n\t\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_fraction_for_current_item;\n\t\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\t\tinclusive_tax_amount_per_qty = flt(tax_rate);\n\t\t\t}\n\t\t}\n\n\t\tif(tax.add_deduct_tax && tax.add_deduct_tax == \"Deduct\") {\n\t\t\tcurrent_tax_fraction *= -1;\n\t\t\tinclusive_tax_amount_per_qty *= -1;\n\t\t}\n\t\treturn [current_tax_fraction, inclusive_tax_amount_per_qty];\n\t},\n\n\t_get_tax_rate: function(tax, item_tax_map) {\n\t\treturn (Object.keys(item_tax_map).indexOf(tax.account_head) != -1) ?\n\t\t\tflt(item_tax_map[tax.account_head], precision(\"rate\", tax)) : tax.rate;\n\t},\n\n\tcalculate_net_total: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total = 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total += item.amount;\n\t\t\tme.frm.doc.total_qty += item.qty;\n\t\t\tme.frm.doc.base_total += item.base_amount;\n\t\t\tme.frm.doc.net_total += item.net_amount;\n\t\t\tme.frm.doc.base_net_total += item.base_net_amount;\n\t\t\t});\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"total\", \"base_total\", \"net_total\", \"base_net_total\"]);\n\t},\n\n\tcalculate_taxes: function() {\n\t\tvar me = this;\n\t\tthis.frm.doc.rounding_adjustment = 0;\n\t\tvar actual_tax_dict = {};\n\n\t\t// maintain actual tax rate based on idx\n\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\tactual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\t}\n\t\t});\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(n, item) {\n\t\t\tvar item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n\t\t\t$.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t// tax_amount represents the amount of tax for the current step\n\t\t\t\tvar current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n\n\t\t\t\t// Adjust divisional loss to the last item\n\t\t\t\tif (tax.charge_type == \"Actual\") {\n\t\t\t\t\tactual_tax_dict[tax.idx] -= current_tax_amount;\n\t\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\t\tcurrent_tax_amount += actual_tax_dict[tax.idx];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// accumulate tax amount into tax.tax_amount\n\t\t\t\tif (tax.charge_type != \"Actual\" &&\n\t\t\t\t\t!(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n\t\t\t\t\ttax.tax_amount += current_tax_amount;\n\t\t\t\t}\n\n\t\t\t\t// store tax_amount for current item as it will be used for\n\t\t\t\t// charge type = 'On Previous Row Amount'\n\t\t\t\ttax.tax_amount_for_current_item = current_tax_amount;\n\n\t\t\t\t// tax amount after discount amount\n\t\t\t\ttax.tax_amount_after_discount_amount += current_tax_amount;\n\n\t\t\t\t// for buying\n\t\t\t\tif(tax.category) {\n\t\t\t\t\t// if just for valuation, do not add the tax amount in total\n\t\t\t\t\t// hence, setting it as 0 for further steps\n\t\t\t\t\tcurrent_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n\n\t\t\t\t\tcurrent_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t}\n\n\t\t\t\t// note: grand_total_for_current_item contains the contribution of\n\t\t\t\t// item's amount, previously applied tax and the current tax on that item\n\t\t\t\tif(i==0) {\n\t\t\t\t\ttax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n\t\t\t\t} else {\n\t\t\t\t\ttax.grand_total_for_current_item =\n\t\t\t\t\t\tflt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n\t\t\t\t}\n\n\t\t\t\t// set precision in the last item iteration\n\t\t\t\tif (n == me.frm.doc[\"items\"].length - 1) {\n\t\t\t\t\tme.round_off_totals(tax);\n\n\t\t\t\t\t// in tax.total, accumulate grand total for each item\n\t\t\t\t\tme.set_cumulative_total(i, tax);\n\n\t\t\t\t\tme.set_in_company_currency(tax,\n\t\t\t\t\t\t[\"total\", \"tax_amount\", \"tax_amount_after_discount_amount\"]);\n\n\t\t\t\t\t// adjust Discount Amount loss in last tax iteration\n\t\t\t\t\tif ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n\t\t\t\t\t\t&& me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\t\t\t\t\t\tme.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total -\n\t\t\t\t\t\t\tflt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tset_cumulative_total: function(row_idx, tax) {\n\t\tvar tax_amount = tax.tax_amount_after_discount_amount;\n\t\tif (tax.category == 'Valuation') {\n\t\t\ttax_amount = 0;\n\t\t}\n\n\t\tif (tax.add_deduct_tax == \"Deduct\") { tax_amount = -1*tax_amount; }\n\n\t\tif(row_idx==0) {\n\t\t\ttax.total = flt(this.frm.doc.net_total + tax_amount, precision(\"total\", tax));\n\t\t} else {\n\t\t\ttax.total = flt(this.frm.doc[\"taxes\"][row_idx-1].total + tax_amount, precision(\"total\", tax));\n\t\t}\n\t},\n\n\t_load_item_tax_rate: function(item_tax_rate) {\n\t\treturn item_tax_rate ? JSON.parse(item_tax_rate) : {};\n\t},\n\n\tget_current_tax_amount: function(item, tax, item_tax_map) {\n\t\tvar tax_rate = this._get_tax_rate(tax, item_tax_map);\n\t\tvar current_tax_amount = 0.0;\n\n\t\t// To set row_id by default as previous row.\n\t\tif([\"On Previous Row Amount\", \"On Previous Row Total\"].includes(tax.charge_type)) {\n\t\t\tif (tax.idx === 1) {\n\t\t\t\tfrappe.throw(\n\t\t\t\t\t__(\"Cannot select charge type as 'On Previous Row Amount' or 'On Previous Row Total' for first row\"));\n\t\t\t}\n\t\t\tif (!tax.row_id) {\n\t\t\t\ttax.row_id = tax.idx - 1;\n\t\t\t}\n\t\t}\n\t\tif(tax.charge_type == \"Actual\") {\n\t\t\t// distribute the tax amount proportionally to each item row\n\t\t\tvar actual = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\t\tcurrent_tax_amount = this.frm.doc.net_total ?\n\t\t\t\t((item.net_amount / this.frm.doc.net_total) * actual) : 0.0;\n\n\t\t} else if(tax.charge_type == \"On Net Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) * item.net_amount;\n\t\t} else if(tax.charge_type == \"On Previous Row Amount\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].tax_amount_for_current_item;\n\n\t\t} else if(tax.charge_type == \"On Previous Row Total\") {\n\t\t\tcurrent_tax_amount = (tax_rate / 100.0) *\n\t\t\t\tthis.frm.doc[\"taxes\"][cint(tax.row_id) - 1].grand_total_for_current_item;\n\t\t} else if (tax.charge_type == \"On Item Quantity\") {\n\t\t\tcurrent_tax_amount = tax_rate * item.qty;\n\t\t}\n\t\tthis.set_item_wise_tax(item, tax, tax_rate, current_tax_amount);\n\n\t\treturn current_tax_amount;\n\t},\n\n\tset_item_wise_tax: function(item, tax, tax_rate, current_tax_amount) {\n\t\t// store tax breakup for each item\n\t\tlet tax_detail = tax.item_wise_tax_detail;\n\t\tlet key = item.item_code || item.item_name;\n\n\t\tlet item_wise_tax_amount = current_tax_amount * this.frm.doc.conversion_rate;\n\t\tif (tax_detail && tax_detail[key])\n\t\t\titem_wise_tax_amount += tax_detail[key][1];\n\n\t\ttax_detail[key] = [tax_rate, flt(item_wise_tax_amount, precision(\"base_tax_amount\", tax))];\n\t},\n\n\tround_off_totals: function(tax) {\n\t\ttax.tax_amount = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n\t\ttax.tax_amount_after_discount_amount = flt(tax.tax_amount_after_discount_amount, precision(\"tax_amount\", tax));\n\t},\n\n\tmanipulate_grand_total_for_inclusive_tax: function() {\n\t\tvar me = this;\n\t\t// if fully inclusive taxes and diff\n\t\tif (this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar any_inclusive_tax = false;\n\t\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\t\tif(cint(d.included_in_print_rate)) any_inclusive_tax = true;\n\t\t\t});\n\t\t\tif (any_inclusive_tax) {\n\t\t\t\tvar last_tax = me.frm.doc[\"taxes\"].slice(-1)[0];\n\t\t\t\tvar non_inclusive_tax_amount = frappe.utils.sum($.map(this.frm.doc.taxes || [],\n\t\t\t\t\tfunction(d) {\n\t\t\t\t\t\tif(!d.included_in_print_rate) {\n\t\t\t\t\t\t\treturn flt(d.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t));\n\t\t\t\tvar diff = me.frm.doc.total + non_inclusive_tax_amount\n\t\t\t\t\t- flt(last_tax.total, precision(\"grand_total\"));\n\n\t\t\t\tif(me.discount_amount_applied && me.frm.doc.discount_amount) {\n\t\t\t\t\tdiff -= flt(me.frm.doc.discount_amount);\n\t\t\t\t}\n\n\t\t\t\tdiff = flt(diff, precision(\"rounding_adjustment\"));\n\n\t\t\t\tif ( diff && Math.abs(diff) <= (5.0 / Math.pow(10, precision(\"tax_amount\", last_tax))) ) {\n\t\t\t\t\tme.frm.doc.rounding_adjustment = diff;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_totals: function() {\n\t\t// Changing sequence can cause rounding_adjustmentng issue and on-screen discrepency\n\t\tvar me = this;\n\t\tvar tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n\t\tthis.frm.doc.grand_total = flt(tax_count\n\t\t\t? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n\t\t\t: this.frm.doc.net_total);\n\n\t\tif(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\tthis.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total;\n\t\t} else {\n\t\t\t// other charges added/deducted\n\t\t\tthis.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n\t\t\tif(tax_count) {\n\t\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t\tif (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n\t\t\t\t\t\tif(tax.add_deduct_tax == \"Add\") {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfrappe.model.round_floats_in(this.frm.doc,\n\t\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t\t}\n\n\t\t\tthis.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n\t\t\t\tflt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n\t\t\tthis.set_in_company_currency(this.frm.doc,\n\t\t\t\t[\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n\t\t}\n\n\t\tthis.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total\n\t\t\t- flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n\t\tthis.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n\t\t// Round grand total as per precision\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n\t\t// rounded totals\n\t\tthis.set_rounded_total();\n\t},\n\n\tset_rounded_total: function() {\n\t\tvar disable_rounded_total = 0;\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"disable_rounded_total\", this.frm.doc.name)) {\n\t\t\tdisable_rounded_total = this.frm.doc.disable_rounded_total;\n\t\t} else if (frappe.sys_defaults.disable_rounded_total) {\n\t\t\tdisable_rounded_total = frappe.sys_defaults.disable_rounded_total;\n\t\t}\n\n\t\tif (cint(disable_rounded_total)) {\n\t\t\tthis.frm.doc.rounded_total = 0;\n\t\t\tthis.frm.doc.base_rounded_total = 0;\n\t\t\treturn;\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"rounded_total\", this.frm.doc.name)) {\n\t\t\tthis.frm.doc.rounded_total = round_based_on_smallest_currency_fraction(this.frm.doc.grand_total,\n\t\t\t\tthis.frm.doc.currency, precision(\"rounded_total\"));\n\t\t\tthis.frm.doc.rounding_adjustment += flt(this.frm.doc.rounded_total - this.frm.doc.grand_total,\n\t\t\t\tprecision(\"rounding_adjustment\"));\n\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"rounding_adjustment\", \"rounded_total\"]);\n\t\t}\n\t},\n\n\t_cleanup: function() {\n\t\tthis.frm.doc.base_in_words = this.frm.doc.in_words = \"\";\n\n\t\tif(this.frm.doc[\"items\"] && this.frm.doc[\"items\"].length) {\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"items\"][0].doctype, \"item_tax_amount\", this.frm.doctype)) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdelete item[\"item_tax_amount\"];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc[\"taxes\"] && this.frm.doc[\"taxes\"].length) {\n\t\t\tvar temporary_fields = [\"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n\t\t\t\t\"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n\n\t\t\tif(!frappe.meta.get_docfield(this.frm.doc[\"taxes\"][0].doctype, \"tax_amount_after_discount_amount\", this.frm.doctype)) {\n\t\t\t\ttemporary_fields.push(\"tax_amount_after_discount_amount\");\n\t\t\t}\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\t$.each(temporary_fields, function(i, fieldname) {\n\t\t\t\t\tdelete tax[fieldname];\n\t\t\t\t});\n\n\t\t\t\ttax.item_wise_tax_detail = JSON.stringify(tax.item_wise_tax_detail);\n\t\t\t});\n\t\t}\n\t},\n\n\tset_discount_amount: function() {\n\t\tif(this.frm.doc.additional_discount_percentage) {\n\t\t\tthis.frm.doc.discount_amount = flt(flt(this.frm.doc[frappe.scrub(this.frm.doc.apply_discount_on)])\n\t\t\t\t* this.frm.doc.additional_discount_percentage / 100, precision(\"discount_amount\"));\n\t\t}\n\t},\n\n\tapply_discount_amount: function() {\n\t\tvar me = this;\n\t\tvar distributed_amount = 0.0;\n\t\tthis.frm.doc.base_discount_amount = 0.0;\n\n\t\tif (this.frm.doc.discount_amount) {\n\t\t\tif(!this.frm.doc.apply_discount_on)\n\t\t\t\tfrappe.throw(__(\"Please select Apply Discount On\"));\n\n\t\t\tthis.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_discount_amount\"));\n\n\t\t\tvar total_for_discount_amount = this.get_total_for_discount_amount();\n\t\t\tvar net_total = 0;\n\t\t\t// calculate item amount after Discount Amount\n\t\t\tif (total_for_discount_amount) {\n\t\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\t\t\tdistributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n\t\t\t\t\titem.net_amount = flt(item.net_amount - distributed_amount,\n\t\t\t\t\t\tprecision(\"base_amount\", item));\n\t\t\t\t\tnet_total += item.net_amount;\n\n\t\t\t\t\t// discount amount rounding loss adjustment if no taxes\n\t\t\t\t\tif ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n\t\t\t\t\t\t\t&& i == (me.frm.doc.items || []).length - 1) {\n\t\t\t\t\t\tvar discount_amount_loss = flt(me.frm.doc.net_total - net_total\n\t\t\t\t\t\t\t- me.frm.doc.discount_amount, precision(\"net_total\"));\n\t\t\t\t\t\titem.net_amount = flt(item.net_amount + discount_amount_loss,\n\t\t\t\t\t\t\tprecision(\"net_amount\", item));\n\t\t\t\t\t}\n\t\t\t\t\titem.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n\t\t\t\t\tme.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n\t\t\t\t});\n\n\t\t\t\tthis.discount_amount_applied = true;\n\t\t\t\tthis._calculate_taxes_and_totals();\n\t\t\t}\n\t\t}\n\t},\n\n\tget_total_for_discount_amount: function() {\n\t\tif(this.frm.doc.apply_discount_on == \"Net Total\") {\n\t\t\treturn this.frm.doc.net_total;\n\t\t} else {\n\t\t\tvar total_actual_tax = 0.0;\n\t\t\tvar actual_taxes_dict = {};\n\n\t\t\t$.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n\t\t\t\tif (in_list([\"Actual\", \"On Item Quantity\"], tax.charge_type)) {\n\t\t\t\t\tvar tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n\t\t\t\t\ttax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = tax_amount;\n\t\t\t\t} else if (actual_taxes_dict[tax.row_id] !== null) {\n\t\t\t\t\tvar actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n\t\t\t\t\tactual_taxes_dict[tax.idx] = actual_tax_amount;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$.each(actual_taxes_dict, function(key, value) {\n\t\t\t\tif (value) total_actual_tax += value;\n\t\t\t});\n\n\t\t\treturn flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n\t\t}\n\t},\n\n\tcalculate_total_advance: function(update_paid_amount) {\n\t\tvar total_allocated_amount = frappe.utils.sum($.map(this.frm.doc[\"advances\"] || [], function(adv) {\n\t\t\treturn flt(adv.allocated_amount, precision(\"allocated_amount\", adv));\n\t\t}));\n\t\tthis.frm.doc.total_advance = flt(total_allocated_amount, precision(\"total_advance\"));\n\n\t\tthis.calculate_outstanding_amount(update_paid_amount);\n\t},\n\n\tcalculate_outstanding_amount: function(update_paid_amount) {\n\t\t// NOTE:\n\t\t// paid_amount and write_off_amount is only for POS/Loyalty Point Redemption Invoice\n\t\t// total_advance is only for non POS Invoice\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype) && this.frm.doc.is_return){\n\t\t\tthis.calculate_paid_amount();\n\t\t}\n\n\t\tif(this.frm.doc.is_return || this.frm.doc.docstatus > 0) return;\n\n\t\tfrappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"total_advance\", \"write_off_amount\"]);\n\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\n\t\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t\t} else {\n\t\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t\t(flt(grand_total*this.frm.doc.conversion_rate, precision(\"grand_total\"))\n\t\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfrappe.model.round_floats_in(this.frm.doc, [\"paid_amount\"]);\n\t\t\tthis.set_in_company_currency(this.frm.doc, [\"paid_amount\"]);\n\n\t\t\tif(this.frm.refresh_field){\n\t\t\t\tthis.frm.refresh_field(\"paid_amount\");\n\t\t\t\tthis.frm.refresh_field(\"base_paid_amount\");\n\t\t\t}\n\n\t\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)) {\n\t\t\t\tlet total_amount_for_payment = (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount)\n\t\t\t\t\t? flt(total_amount_to_pay - this.frm.doc.loyalty_amount, precision(\"base_grand_total\"))\n\t\t\t\t\t: total_amount_to_pay;\n\t\t\t\tthis.set_default_payment(total_amount_for_payment, update_paid_amount);\n\t\t\t\tthis.calculate_paid_amount();\n\t\t\t}\n\t\t\tthis.calculate_change_amount();\n\n\t\t\tvar paid_amount = (this.frm.doc.party_account_currency == this.frm.doc.currency) ?\n\t\t\t\tthis.frm.doc.paid_amount : this.frm.doc.base_paid_amount;\n\t\t\tthis.frm.doc.outstanding_amount =  flt(total_amount_to_pay - flt(paid_amount) +\n\t\t\t\tflt(this.frm.doc.change_amount * this.frm.doc.conversion_rate), precision(\"outstanding_amount\"));\n\t\t}\n\t},\n\n\tupdate_paid_amount_for_return: function() {\n\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\n\t\tif(this.frm.doc.party_account_currency == this.frm.doc.currency) {\n\t\t\tvar total_amount_to_pay = flt((grand_total - this.frm.doc.total_advance\n\t\t\t\t- this.frm.doc.write_off_amount), precision(\"grand_total\"));\n\t\t} else {\n\t\t\tvar total_amount_to_pay = flt(\n\t\t\t\t(flt(grand_total*this.frm.doc.conversion_rate, precision(\"grand_total\"))\n\t\t\t\t\t- this.frm.doc.total_advance - this.frm.doc.base_write_off_amount),\n\t\t\t\tprecision(\"base_grand_total\")\n\t\t\t);\n\t\t}\n\n\t\tthis.frm.doc.payments.find(pay => {\n\t\t\tif (pay.default) {\n\t\t\t\tpay.amount = total_amount_to_pay;\n\t\t\t} else {\n\t\t\t\tpay.amount = 0.0\n\t\t\t}\n\t\t});\n\t\tthis.frm.refresh_fields();\n\n\t\tthis.calculate_paid_amount();\n\t},\n\n\tset_default_payment: function(total_amount_to_pay, update_paid_amount) {\n\t\tvar me = this;\n\t\tvar payment_status = true;\n\t\tif(this.frm.doc.is_pos && (update_paid_amount===undefined || update_paid_amount)) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data) {\n\t\t\t\tif(data.default && payment_status && total_amount_to_pay > 0) {\n\t\t\t\t\tlet base_amount = flt(total_amount_to_pay, precision(\"base_amount\", data));\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"base_amount\", base_amount);\n\t\t\t\t\tlet amount = flt(total_amount_to_pay / me.frm.doc.conversion_rate, precision(\"amount\", data));\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", amount);\n\t\t\t\t\tpayment_status = false;\n\t\t\t\t} else if(me.frm.doc.paid_amount) {\n\t\t\t\t\tfrappe.model.set_value(data.doctype, data.name, \"amount\", 0.0);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tcalculate_paid_amount: function() {\n\t\tvar me = this;\n\t\tvar paid_amount = 0.0;\n\t\tvar base_paid_amount = 0.0;\n\t\tif(this.frm.doc.is_pos) {\n\t\t\t$.each(this.frm.doc['payments'] || [], function(index, data){\n\t\t\t\tdata.base_amount = flt(data.amount * me.frm.doc.conversion_rate, precision(\"base_amount\", data));\n\t\t\t\tpaid_amount += data.amount;\n\t\t\t\tbase_paid_amount += data.base_amount;\n\t\t\t});\n\t\t} else if(!this.frm.doc.is_return){\n\t\t\tthis.frm.doc.payments = [];\n\t\t}\n\t\tif (this.frm.doc.redeem_loyalty_points && this.frm.doc.loyalty_amount) {\n\t\t\tbase_paid_amount += this.frm.doc.loyalty_amount;\n\t\t\tpaid_amount += flt(this.frm.doc.loyalty_amount / me.frm.doc.conversion_rate, precision(\"paid_amount\"));\n\t\t}\n\n\t\tthis.frm.set_value('paid_amount', flt(paid_amount, precision(\"paid_amount\")));\n\t\tthis.frm.set_value('base_paid_amount', flt(base_paid_amount, precision(\"base_paid_amount\")));\n\t},\n\n\tcalculate_change_amount: function(){\n\t\tthis.frm.doc.change_amount = 0.0;\n\t\tthis.frm.doc.base_change_amount = 0.0;\n\t\tif(in_list([\"Sales Invoice\", \"POS Invoice\"], this.frm.doc.doctype)\n\t\t\t&& this.frm.doc.paid_amount > this.frm.doc.grand_total && !this.frm.doc.is_return) {\n\n\t\t\tvar payment_types = $.map(this.frm.doc.payments, function(d) { return d.type; });\n\t\t\tif (in_list(payment_types, 'Cash')) {\n\t\t\t\tvar grand_total = this.frm.doc.rounded_total || this.frm.doc.grand_total;\n\t\t\t\tvar base_grand_total = this.frm.doc.base_rounded_total || this.frm.doc.base_grand_total;\n\n\t\t\t\tthis.frm.doc.change_amount = flt(this.frm.doc.paid_amount - grand_total +\n\t\t\t\t\tthis.frm.doc.write_off_amount, precision(\"change_amount\"));\n\n\t\t\t\tthis.frm.doc.base_change_amount = flt(this.frm.doc.base_paid_amount -\n\t\t\t\t\tbase_grand_total + this.frm.doc.base_write_off_amount,\n\t\t\t\t\tprecision(\"base_change_amount\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tcalculate_write_off_amount: function(){\n\t\tif(this.frm.doc.paid_amount > this.frm.doc.grand_total){\n\t\t\tthis.frm.doc.write_off_amount = flt(this.frm.doc.grand_total - this.frm.doc.paid_amount\n\t\t\t\t+ this.frm.doc.change_amount, precision(\"write_off_amount\"));\n\n\t\t\tthis.frm.doc.base_write_off_amount = flt(this.frm.doc.write_off_amount * this.frm.doc.conversion_rate,\n\t\t\t\tprecision(\"base_write_off_amount\"));\n\t\t}else{\n\t\t\tthis.frm.doc.paid_amount = 0.0;\n\t\t}\n\t\tthis.calculate_outstanding_amount(false);\n\t}\n});\n","// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nerpnext.TransactionController = erpnext.taxes_and_totals.extend({\n\tsetup: function() {\n\t\tthis._super();\n\t\tfrappe.flags.hide_serial_batch_dialog = true;\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tvar has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n\n\t\t\tfrappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n\n\t\t\tif(item.price_list_rate) {\n\t\t\t\tif(item.rate > item.price_list_rate && has_margin_field) {\n\t\t\t\t\t// if rate is greater than price_list_rate, set margin\n\t\t\t\t\t// or set discount\n\t\t\t\t\titem.discount_percentage = 0;\n\t\t\t\t\titem.margin_type = 'Amount';\n\t\t\t\t\titem.margin_rate_or_amount = flt(item.rate - item.price_list_rate,\n\t\t\t\t\t\tprecision(\"margin_rate_or_amount\", item));\n\t\t\t\t\titem.rate_with_margin = item.rate;\n\t\t\t\t} else {\n\t\t\t\t\titem.discount_percentage = flt((1 - item.rate / item.price_list_rate) * 100.0,\n\t\t\t\t\t\tprecision(\"discount_percentage\", item));\n\t\t\t\t\titem.discount_amount = flt(item.price_list_rate) - flt(item.rate);\n\t\t\t\t\titem.margin_type = '';\n\t\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\t\titem.rate_with_margin = 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\titem.discount_percentage = 0.0;\n\t\t\t\titem.margin_type = '';\n\t\t\t\titem.margin_rate_or_amount = 0;\n\t\t\t\titem.rate_with_margin = 0;\n\t\t\t}\n\t\t\titem.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\n\n\t\t\tcur_frm.cscript.set_gross_profit(item);\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\n\t\t});\n\n\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"tax_amount\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"row_id\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.cscript.tax_table, \"included_in_print_rate\", function(frm, cdt, cdn) {\n\t\t\tcur_frm.cscript.set_dynamic_labels();\n\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"apply_discount_on\", function(frm) {\n\t\t\tif(frm.doc.additional_discount_percentage) {\n\t\t\t\tfrm.trigger(\"additional_discount_percentage\");\n\t\t\t} else {\n\t\t\t\tcur_frm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"additional_discount_percentage\", function(frm) {\n\t\t\tif(!frm.doc.apply_discount_on) {\n\t\t\t\tfrappe.msgprint(__(\"Please set 'Apply Additional Discount On'\"));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfrm.via_discount_percentage = true;\n\n\t\t\tif(frm.doc.additional_discount_percentage && frm.doc.discount_amount) {\n\t\t\t\t// Reset discount amount and net / grand total\n\t\t\t\tfrm.doc.discount_amount = 0;\n\t\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t\t}\n\n\t\t\tvar total = flt(frm.doc[frappe.model.scrub(frm.doc.apply_discount_on)]);\n\t\t\tvar discount_amount = flt(total*flt(frm.doc.additional_discount_percentage) / 100,\n\t\t\t\tprecision(\"discount_amount\"));\n\n\t\t\tfrm.set_value(\"discount_amount\", discount_amount)\n\t\t\t\t.then(() => delete frm.via_discount_percentage);\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype, \"discount_amount\", function(frm) {\n\t\t\tfrm.cscript.set_dynamic_labels();\n\n\t\t\tif (!frm.via_discount_percentage) {\n\t\t\t\tfrm.doc.additional_discount_percentage = 0;\n\t\t\t}\n\n\t\t\tfrm.cscript.calculate_taxes_and_totals();\n\t\t});\n\n\t\tfrappe.ui.form.on(this.frm.doctype + \" Item\", {\n\t\t\titems_add: function(frm, cdt, cdn) {\n\t\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\t\tif(!item.warehouse && frm.doc.set_warehouse) {\n\t\t\t\t\titem.warehouse = frm.doc.set_warehouse;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tvar me = this;\n\t\tif(this.frm.fields_dict[\"items\"].grid.get_field('batch_no')) {\n\t\t\tthis.frm.set_query(\"batch_no\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\treturn me.set_query_for_batch(doc, cdt, cdn);\n\t\t\t});\n\t\t}\n\n\t\tif(\n\t\t\tthis.frm.docstatus < 2\n\t\t\t&& this.frm.fields_dict[\"payment_terms_template\"]\n\t\t\t&& this.frm.fields_dict[\"payment_schedule\"]\n\t\t\t&& this.frm.doc.payment_terms_template\n\t\t\t&& !this.frm.doc.payment_schedule.length\n\t\t){\n\t\t\tthis.frm.trigger(\"payment_terms_template\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis[\"taxes_remove\"] = this.calculate_taxes_and_totals;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"items\"]) {\n\t\t\tthis[\"items_remove\"] = this.calculate_net_weight;\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"recurring_print_format\"]) {\n\t\t\tthis.frm.set_query(\"recurring_print_format\", function(doc) {\n\t\t\t\treturn{\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t['Print Format', 'doc_type', '=', cur_frm.doctype],\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"return_against\"]) {\n\t\t\tthis.frm.set_query(\"return_against\", function(doc) {\n\t\t\t\tvar filters = {\n\t\t\t\t\t\"docstatus\": 1,\n\t\t\t\t\t\"is_return\": 0,\n\t\t\t\t\t\"company\": doc.company\n\t\t\t\t};\n\t\t\t\tif (me.frm.fields_dict[\"customer\"] && doc.customer) filters[\"customer\"] = doc.customer;\n\t\t\t\tif (me.frm.fields_dict[\"supplier\"] && doc.supplier) filters[\"supplier\"] = doc.supplier;\n\n\t\t\t\treturn {\n\t\t\t\t\tfilters: filters\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"cost_center\")) {\n\t\t\tthis.frm.set_query(\"cost_center\", \"items\", function(doc) {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\"is_group\": 0\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field(\"expense_account\")) {\n\t\t\tthis.frm.set_query(\"expense_account\", \"items\", function(doc) {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype, \"pricing_rules\")) {\n\t\t\tthis.frm.set_indicator_formatter('pricing_rule', function(doc) {\n\t\t\t\treturn (doc.rule_applied) ? \"green\" : \"red\";\n\t\t\t});\n\t\t}\n\n\t\tlet batch_no_field = this.frm.get_docfield(\"items\", \"batch_no\");\n\t\tif (batch_no_field) {\n\t\t\tbatch_no_field.get_route_options_for_new_doc = function(row) {\n\t\t\t\treturn {\n\t\t\t\t\t\"item\": row.doc.item_code\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (this.frm.fields_dict[\"items\"].grid.get_field('blanket_order')) {\n\t\t\tthis.frm.set_query(\"blanket_order\", \"items\", function(doc, cdt, cdn) {\n\t\t\t\tvar item = locals[cdt][cdn];\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_blanket_orders\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"company\": doc.company,\n\t\t\t\t\t\t\"blanket_order_type\": doc.doctype === \"Sales Order\" ? \"Selling\" : \"Purchasing\",\n\t\t\t\t\t\t\"item\": item.item_code\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t},\n\tonload: function() {\n\t\tvar me = this;\n\n\t\tif(this.frm.doc.__islocal) {\n\t\t\tvar currency = frappe.defaults.get_user_default(\"currency\");\n\n\t\t\tlet set_value = (fieldname, value) => {\n\t\t\t\tif(me.frm.fields_dict[fieldname] && !me.frm.doc[fieldname]) {\n\t\t\t\t\treturn me.frm.set_value(fieldname, value);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn frappe.run_serially([\n\t\t\t\t() => set_value('currency', currency),\n\t\t\t\t() => set_value('price_list_currency', currency),\n\t\t\t\t() => set_value('status', 'Draft'),\n\t\t\t\t() => set_value('is_subcontracted', 'No'),\n\t\t\t\t() => {\n\t\t\t\t\tif(this.frm.doc.company && !this.frm.doc.amended_from) {\n\t\t\t\t\t\tthis.frm.trigger(\"company\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\t},\n\n\tis_return: function() {\n\t\tif(!this.frm.doc.is_return && this.frm.doc.return_against) {\n\t\t\tthis.frm.set_value('return_against', '');\n\t\t}\n\t},\n\n\tsetup_quality_inspection: function() {\n\t\tif(!in_list([\"Delivery Note\", \"Sales Invoice\", \"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)) {\n\t\t\treturn;\n\t\t}\n\t\tvar me = this;\n\t\tvar inspection_type = in_list([\"Purchase Receipt\", \"Purchase Invoice\"], this.frm.doc.doctype)\n\t\t\t? \"Incoming\" : \"Outgoing\";\n\n\t\tvar quality_inspection_field = this.frm.get_docfield(\"items\", \"quality_inspection\");\n\t\tquality_inspection_field.get_route_options_for_new_doc = function(row) {\n\t\t\tif(me.frm.is_new()) return;\n\t\t\treturn {\n\t\t\t\t\"inspection_type\": inspection_type,\n\t\t\t\t\"reference_type\": me.frm.doc.doctype,\n\t\t\t\t\"reference_name\": me.frm.doc.name,\n\t\t\t\t\"item_code\": row.doc.item_code,\n\t\t\t\t\"description\": row.doc.description,\n\t\t\t\t\"item_serial_no\": row.doc.serial_no ? row.doc.serial_no.split(\"\\n\")[0] : null,\n\t\t\t\t\"batch_no\": row.doc.batch_no\n\t\t\t}\n\t\t}\n\n\t\tthis.frm.set_query(\"quality_inspection\", \"items\", function(doc, cdt, cdn) {\n\t\t\tvar d = locals[cdt][cdn];\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tdocstatus: 1,\n\t\t\t\t\tinspection_type: inspection_type,\n\t\t\t\t\treference_name: doc.name,\n\t\t\t\t\titem_code: d.item_code\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\tmake_payment_request: function() {\n\t\tvar me = this;\n\t\tconst payment_request_type = (in_list(['Sales Order', 'Sales Invoice'], this.frm.doc.doctype))\n\t\t\t? \"Inward\" : \"Outward\";\n\n\t\tfrappe.call({\n\t\t\tmethod:\"erpnext.accounts.doctype.payment_request.payment_request.make_payment_request\",\n\t\t\targs: {\n\t\t\t\tdt: me.frm.doc.doctype,\n\t\t\t\tdn: me.frm.doc.name,\n\t\t\t\trecipient_id: me.frm.doc.contact_email,\n\t\t\t\tpayment_request_type: payment_request_type,\n\t\t\t\tparty_type: payment_request_type == 'Outward' ? \"Supplier\" : \"Customer\",\n\t\t\t\tparty: payment_request_type == 'Outward' ? me.frm.doc.supplier : me.frm.doc.customer\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tif(!r.exc){\n\t\t\t\t\tvar doc = frappe.model.sync(r.message);\n\t\t\t\t\tfrappe.set_route(\"Form\", r.message.doctype, r.message.name);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\n\tonload_post_render: function() {\n\t\tif(this.frm.doc.__islocal && !(this.frm.doc.taxes || []).length\n\t\t\t&& !(this.frm.doc.__onload ? this.frm.doc.__onload.load_after_mapping : false)) {\n\t\t\tfrappe.after_ajax(() => this.apply_default_taxes());\n\t\t} else if(this.frm.doc.__islocal && this.frm.doc.company && this.frm.doc[\"items\"]\n\t\t\t&& !this.frm.doc.is_pos) {\n\t\t\tfrappe.after_ajax(() => this.calculate_taxes_and_totals());\n\t\t}\n\t\tif(frappe.meta.get_docfield(this.frm.doc.doctype + \" Item\", \"item_code\")) {\n\t\t\tthis.setup_item_selector();\n\t\t\tthis.frm.get_field(\"items\").grid.set_multiple_add(\"item_code\", \"qty\");\n\t\t}\n\t},\n\n\trefresh: function() {\n\t\terpnext.toggle_naming_series();\n\t\terpnext.hide_company();\n\t\tthis.set_dynamic_labels();\n\t\tthis.setup_sms();\n\t\tthis.setup_quality_inspection();\n\t\tlet scan_barcode_field = this.frm.get_field('scan_barcode');\n\t\tif (scan_barcode_field && scan_barcode_field.get_value()) {\n\t\t\tscan_barcode_field.set_value(\"\");\n\t\t\tscan_barcode_field.set_new_description(\"\");\n\n\t\t\tif (frappe.is_mobile()) {\n\t\t\t\tif (scan_barcode_field.$input_wrapper.find('.input-group').length) return;\n\n\t\t\t\tlet $input_group = $('<div class=\"input-group\">');\n\t\t\t\tscan_barcode_field.$input_wrapper.find('.control-input').append($input_group);\n\t\t\t\t$input_group.append(scan_barcode_field.$input);\n\t\t\t\t$(`<span class=\"input-group-btn\" style=\"vertical-align: top\">\n\t\t\t\t\t\t<button class=\"btn btn-default border\" type=\"button\">\n\t\t\t\t\t\t\t<i class=\"fa fa-camera text-muted\"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</span>`)\n\t\t\t\t\t.on('click', '.btn', () => {\n\t\t\t\t\t\tfrappe.barcode.scan_barcode().then(barcode => {\n\t\t\t\t\t\t\tscan_barcode_field.set_value(barcode);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.appendTo($input_group);\n\t\t\t}\n\t\t}\n\t},\n\n\tscan_barcode: function() {\n\t\tlet scan_barcode_field = this.frm.fields_dict[\"scan_barcode\"];\n\n\t\tlet show_description = function(idx, exist = null) {\n\t\t\tif (exist) {\n\t\t\t\tscan_barcode_field.set_new_description(__('Row #{0}: Qty increased by 1', [idx]));\n\t\t\t} else {\n\t\t\t\tscan_barcode_field.set_new_description(__('Row #{0}: Item added', [idx]));\n\t\t\t}\n\t\t}\n\n\t\tif(this.frm.doc.scan_barcode) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.selling.page.point_of_sale.point_of_sale.search_serial_or_batch_or_barcode_number\",\n\t\t\t\targs: { search_value: this.frm.doc.scan_barcode }\n\t\t\t}).then(r => {\n\t\t\t\tconst data = r && r.message;\n\t\t\t\tif (!data || Object.keys(data).length === 0) {\n\t\t\t\t\tscan_barcode_field.set_new_description(__('Cannot find Item with this barcode'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet cur_grid = this.frm.fields_dict.items.grid;\n\n\t\t\t\tlet row_to_modify = null;\n\t\t\t\tconst existing_item_row = this.frm.doc.items.find(d => d.item_code === data.item_code);\n\t\t\t\tconst blank_item_row = this.frm.doc.items.find(d => !d.item_code);\n\n\t\t\t\tif (existing_item_row) {\n\t\t\t\t\trow_to_modify = existing_item_row;\n\t\t\t\t} else if (blank_item_row) {\n\t\t\t\t\trow_to_modify = blank_item_row;\n\t\t\t\t}\n\n\t\t\t\tif (!row_to_modify) {\n\t\t\t\t\t// add new row\n\t\t\t\t\trow_to_modify = frappe.model.add_child(this.frm.doc, cur_grid.doctype, 'items');\n\t\t\t\t}\n\n\t\t\t\tshow_description(row_to_modify.idx, row_to_modify.item_code);\n\n\t\t\t\tthis.frm.from_barcode = true;\n\t\t\t\tfrappe.model.set_value(row_to_modify.doctype, row_to_modify.name, {\n\t\t\t\t\titem_code: data.item_code,\n\t\t\t\t\tqty: (row_to_modify.qty || 0) + 1\n\t\t\t\t});\n\n\t\t\t\t['serial_no', 'batch_no', 'barcode'].forEach(field => {\n\t\t\t\t\tif (data[field] && frappe.meta.has_field(row_to_modify.doctype, field)) {\n\n\t\t\t\t\t\tlet value = (row_to_modify[field] && field === \"serial_no\")\n\t\t\t\t\t\t\t? row_to_modify[field] + '\\n' + data[field] : data[field];\n\n\t\t\t\t\t\tfrappe.model.set_value(row_to_modify.doctype,\n\t\t\t\t\t\t\trow_to_modify.name, field, value);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tscan_barcode_field.set_value('');\n\t\t\t\trefresh_field(\"items\");\n\t\t\t});\n\t\t}\n\t\treturn false;\n\t},\n\n\tapply_default_taxes: function() {\n\t\tvar me = this;\n\t\tvar taxes_and_charges_field = frappe.meta.get_docfield(me.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\tme.frm.doc.name);\n\n\t\tif (!this.frm.doc.taxes_and_charges && this.frm.doc.taxes && this.frm.doc.taxes.length > 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (taxes_and_charges_field) {\n\t\t\treturn frappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_default_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": taxes_and_charges_field.options,\n\t\t\t\t\t\"tax_template\": me.frm.doc.taxes_and_charges,\n\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t// directly set in doc, so as not to call triggers\n\t\t\t\t\t\t\t\tif(r.message.taxes_and_charges) {\n\t\t\t\t\t\t\t\t\tme.frm.doc.taxes_and_charges = r.message.taxes_and_charges;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// set taxes table\n\t\t\t\t\t\t\t\tif(r.message.taxes) {\n\t\t\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message.taxes);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t() => me.set_dynamic_labels(),\n\t\t\t\t\t\t\t() => me.calculate_taxes_and_totals()\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tsetup_sms: function() {\n\t\tvar me = this;\n\t\tlet blacklist = ['Purchase Invoice', 'BOM'];\n\t\tif(this.frm.doc.docstatus===1 && !in_list([\"Lost\", \"Stopped\", \"Closed\"], this.frm.doc.status)\n\t\t\t&& !blacklist.includes(this.frm.doctype)) {\n\t\t\tthis.frm.page.add_menu_item(__('Send SMS'), function() { me.send_sms(); });\n\t\t}\n\t},\n\n\tsend_sms: function() {\n\t\tvar sms_man = new erpnext.SMSManager(this.frm.doc);\n\t},\n\n\tbarcode: function(doc, cdt, cdn) {\n\t\tvar d = locals[cdt][cdn];\n\t\tif(d.barcode==\"\" || d.barcode==null) {\n\t\t\t// barcode cleared, remove item\n\t\t\td.item_code = \"\";\n\t\t}\n\n\t\tthis.frm.from_barcode = true;\n\t\tthis.item_code(doc, cdt, cdn);\n\t},\n\n\titem_code: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tvar update_stock = 0, show_batch_dialog = 0;\n\t\tif(['Sales Invoice'].includes(this.frm.doc.doctype)) {\n\t\t\tupdate_stock = cint(me.frm.doc.update_stock);\n\t\t\tshow_batch_dialog = update_stock;\n\n\t\t} else if((this.frm.doc.doctype === 'Purchase Receipt' && me.frm.doc.is_return) ||\n\t\t\tthis.frm.doc.doctype === 'Delivery Note') {\n\t\t\tshow_batch_dialog = 1;\n\t\t}\n\t\t// clear barcode if setting item (else barcode will take priority)\n\t\tif(!this.frm.from_barcode) {\n\t\t\titem.barcode = null;\n\t\t}\n\n\t\tthis.frm.from_barcode = false;\n\t\tif(item.item_code || item.barcode || item.serial_no) {\n\t\t\tif(!this.validate_company_and_party()) {\n\t\t\t\tthis.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n\t\t\t} else {\n\t\t\t\treturn this.frm.call({\n\t\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_details\",\n\t\t\t\t\tchild: item,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoc: me.frm.doc,\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\t\tbarcode: item.barcode,\n\t\t\t\t\t\t\tserial_no: item.serial_no,\n\t\t\t\t\t\t\tbatch_no: item.batch_no,\n\t\t\t\t\t\t\tset_warehouse: me.frm.doc.set_warehouse,\n\t\t\t\t\t\t\twarehouse: item.warehouse,\n\t\t\t\t\t\t\tcustomer: me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\t\t\t\tquotation_to: me.frm.doc.quotation_to,\n\t\t\t\t\t\t\tsupplier: me.frm.doc.supplier,\n\t\t\t\t\t\t\tcurrency: me.frm.doc.currency,\n\t\t\t\t\t\t\tupdate_stock: update_stock,\n\t\t\t\t\t\t\tconversion_rate: me.frm.doc.conversion_rate,\n\t\t\t\t\t\t\tprice_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\t\t\t\tprice_list_currency: me.frm.doc.price_list_currency,\n\t\t\t\t\t\t\tplc_conversion_rate: me.frm.doc.plc_conversion_rate,\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\torder_type: me.frm.doc.order_type,\n\t\t\t\t\t\t\tis_pos: cint(me.frm.doc.is_pos),\n\t\t\t\t\t\t\tis_subcontracted: me.frm.doc.is_subcontracted,\n\t\t\t\t\t\t\ttransaction_date: me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\t\t\t\tignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n\t\t\t\t\t\t\tdoctype: me.frm.doc.doctype,\n\t\t\t\t\t\t\tname: me.frm.doc.name,\n\t\t\t\t\t\t\tproject: item.project || me.frm.doc.project,\n\t\t\t\t\t\t\tqty: item.qty || 1,\n\t\t\t\t\t\t\tstock_qty: item.stock_qty,\n\t\t\t\t\t\t\tconversion_factor: item.conversion_factor,\n\t\t\t\t\t\t\tweight_per_unit: item.weight_per_unit,\n\t\t\t\t\t\t\tweight_uom: item.weight_uom,\n\t\t\t\t\t\t\tmanufacturer: item.manufacturer,\n\t\t\t\t\t\t\tstock_uom: item.stock_uom,\n\t\t\t\t\t\t\tpos_profile: me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n\t\t\t\t\t\t\tcost_center: item.cost_center,\n\t\t\t\t\t\t\ttax_category: me.frm.doc.tax_category,\n\t\t\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\t\t\tchild_docname: item.name\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(d.item_tax_rate);\n\t\t\t\t\t\t\t\t\tif (d.free_item_data) {\n\t\t\t\t\t\t\t\t\t\tme.apply_product_discount(d.free_item_data);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\t// for internal customer instead of pricing rule directly apply valuation rate on item\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n\t\t\t\t\t\t\t\t\t\tme.get_incoming_rate(item, me.frm.posting_date, me.frm.posting_time,\n\t\t\t\t\t\t\t\t\t\t\tme.frm.doc.doctype, me.frm.doc.company);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n\t\t\t\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.toggle_conversion_factor(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (show_batch_dialog)\n\t\t\t\t\t\t\t\t\t\treturn frappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n\t\t\t\t\t\t\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (r.message &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t(r.message.has_batch_no || r.message.has_serial_no)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.flags.hide_serial_batch_dialog = false;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog) {\n\t\t\t\t\t\t\t\t\t\tvar d = locals[cdt][cdn];\n\t\t\t\t\t\t\t\t\t\t$.each(r.message, function(k, v) {\n\t\t\t\t\t\t\t\t\t\t\tif(!d[k]) d[k] = v;\n\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\tif (d.has_batch_no && d.has_serial_no) {\n\t\t\t\t\t\t\t\t\t\t\td.batch_no = undefined;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\terpnext.show_serial_batch_selector(me.frm, d, (item) => {\n\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('qty', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t\tif (!me.frm.doc.set_warehouse)\n\t\t\t\t\t\t\t\t\t\t\t\tme.frm.script_manager.trigger('warehouse', item.doctype, item.name);\n\t\t\t\t\t\t\t\t\t\t}, undefined, !frappe.flags.hide_serial_batch_dialog);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t() => me.conversion_factor(doc, cdt, cdn, true),\n\t\t\t\t\t\t\t\t() => me.remove_pricing_rule(item),\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tif (item.apply_rule_on_other_items) {\n\t\t\t\t\t\t\t\t\t\tlet key = item.name;\n\t\t\t\t\t\t\t\t\t\tme.apply_rule_on_other_items({key: item});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tget_incoming_rate: function(item, posting_date, posting_time, voucher_type, company) {\n\n\t\tlet item_args = {\n\t\t\t'item_code': item.item_code,\n\t\t\t'warehouse': in_list('Purchase Receipt', 'Purchase Invoice') ? item.from_warehouse : item.warehouse,\n\t\t\t'posting_date': posting_date,\n\t\t\t'posting_time': posting_time,\n\t\t\t'qty': item.qty * item.conversion_factor,\n\t\t\t'serial_no': item.serial_no,\n\t\t\t'voucher_type': voucher_type,\n\t\t\t'company': company,\n\t\t\t'allow_zero_valuation_rate': item.allow_zero_valuation_rate\n\t\t}\n\n\t\tfrappe.call({\n\t\t\tmethod: 'erpnext.stock.utils.get_incoming_rate',\n\t\t\targs: {\n\t\t\t\targs: item_args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.model.set_value(item.doctype, item.name, 'rate', r.message);\n\t\t\t}\n\t\t});\n\t},\n\n\tadd_taxes_from_item_tax_template: function(item_tax_map) {\n\t\tlet me = this;\n\n\t\tif(item_tax_map && cint(frappe.defaults.get_default(\"add_taxes_from_item_tax_template\"))) {\n\t\t\tif(typeof (item_tax_map) == \"string\") {\n\t\t\t\titem_tax_map = JSON.parse(item_tax_map);\n\t\t\t}\n\n\t\t\t$.each(item_tax_map, function(tax, rate) {\n\t\t\t\tlet found = (me.frm.doc.taxes || []).find(d => d.account_head === tax);\n\t\t\t\tif(!found) {\n\t\t\t\t\tlet child = frappe.model.add_child(me.frm.doc, \"taxes\");\n\t\t\t\t\tchild.charge_type = \"On Net Total\";\n\t\t\t\t\tchild.account_head = tax;\n\t\t\t\t\tchild.rate = rate;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tserial_no: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif (item && item.serial_no) {\n\t\t\tif (!item.item_code) {\n\t\t\t\tthis.frm.trigger(\"item_code\", cdt, cdn);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar valid_serial_nos = [];\n\n\t\t\t\t// Replacing all occurences of comma with carriage return\n\t\t\t\tvar serial_nos = item.serial_no.trim().replace(/,/g, '\\n');\n\n\t\t\t\tserial_nos = serial_nos.trim().split('\\n');\n\n\t\t\t\t// Trim each string and push unique string to new list\n\t\t\t\tfor (var x=0; x<=serial_nos.length - 1; x++) {\n\t\t\t\t\tif (serial_nos[x].trim() != \"\" && valid_serial_nos.indexOf(serial_nos[x].trim()) == -1) {\n\t\t\t\t\t\tvalid_serial_nos.push(serial_nos[x].trim());\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Add the new list to the serial no. field in grid with each in new line\n\t\t\t\titem.serial_no = valid_serial_nos.join('\\n');\n\t\t\t\titem.conversion_factor = item.conversion_factor || 1;\n\n\t\t\t\trefresh_field(\"serial_no\", item.name, item.parentfield);\n\t\t\t\tif(!doc.is_return && cint(user_defaults.set_qty_in_transactions_based_on_serial_no_input)) {\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name,\n\t\t\t\t\t\t\"qty\", valid_serial_nos.length / item.conversion_factor);\n\t\t\t\t\tfrappe.model.set_value(item.doctype, item.name, \"stock_qty\", valid_serial_nos.length);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tvalidate: function() {\n\t\tthis.calculate_taxes_and_totals(false);\n\t},\n\n\tcompany: function() {\n\t\tvar me = this;\n\t\tvar set_pricing = function() {\n\t\t\tif(me.frm.doc.company && me.frm.fields_dict.currency) {\n\t\t\t\tvar company_currency = me.get_company_currency();\n\t\t\t\tvar company_doc = frappe.get_doc(\":Company\", me.frm.doc.company);\n\n\t\t\t\tif (!me.frm.doc.currency) {\n\t\t\t\t\tme.frm.set_value(\"currency\", company_currency);\n\t\t\t\t}\n\n\t\t\t\tif (me.frm.doc.currency == company_currency) {\n\t\t\t\t\tme.frm.set_value(\"conversion_rate\", 1.0);\n\t\t\t\t}\n\t\t\t\tif (me.frm.doc.price_list_currency == company_currency) {\n\t\t\t\t\tme.frm.set_value('plc_conversion_rate', 1.0);\n\t\t\t\t}\n\t\t\t\tif (company_doc.default_letter_head) {\n\t\t\t\t\tif(me.frm.fields_dict.letter_head) {\n\t\t\t\t\t\tme.frm.set_value(\"letter_head\", company_doc.default_letter_head);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet selling_doctypes_for_tc = [\"Sales Invoice\", \"Quotation\", \"Sales Order\", \"Delivery Note\"];\n\t\t\t\tif (company_doc.default_selling_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tselling_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_selling_terms);\n\t\t\t\t}\n\t\t\t\tlet buying_doctypes_for_tc = [\"Request for Quotation\", \"Supplier Quotation\", \"Purchase Order\",\n\t\t\t\t\t\"Material Request\", \"Purchase Receipt\"];\n\t\t\t\t// Purchase Invoice is excluded as per issue #3345\n\t\t\t\tif (company_doc.default_buying_terms && frappe.meta.has_field(me.frm.doc.doctype, \"tc_name\") &&\n\t\t\t\tbuying_doctypes_for_tc.indexOf(me.frm.doc.doctype) != -1) {\n\t\t\t\t\tme.frm.set_value(\"tc_name\", company_doc.default_buying_terms);\n\t\t\t\t}\n\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => me.frm.script_manager.trigger(\"currency\"),\n\t\t\t\t\t() => me.update_item_tax_map(),\n\t\t\t\t\t() => me.apply_default_taxes(),\n\t\t\t\t\t() => me.apply_pricing_rule()\n\t\t\t\t]);\n\t\t\t}\n\t\t}\n\n\t\tvar set_party_account = function(set_pricing) {\n\t\t\tif (in_list([\"Sales Invoice\", \"Purchase Invoice\"], me.frm.doc.doctype)) {\n\t\t\t\tif(me.frm.doc.doctype==\"Sales Invoice\") {\n\t\t\t\t\tvar party_type = \"Customer\";\n\t\t\t\t\tvar party_account_field = 'debit_to';\n\t\t\t\t} else {\n\t\t\t\t\tvar party_type = \"Supplier\";\n\t\t\t\t\tvar party_account_field = 'credit_to';\n\t\t\t\t}\n\n\t\t\t\tvar party = me.frm.doc[frappe.model.scrub(party_type)];\n\t\t\t\tif(party && me.frm.doc.company) {\n\t\t\t\t\treturn frappe.call({\n\t\t\t\t\t\tmethod: \"erpnext.accounts.party.get_party_account\",\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\t\t\tparty_type: party_type,\n\t\t\t\t\t\t\tparty: party\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\t\tif(!r.exc && r.message) {\n\t\t\t\t\t\t\t\tme.frm.set_value(party_account_field, r.message);\n\t\t\t\t\t\t\t\tset_pricing();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tset_pricing();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tset_pricing();\n\t\t\t}\n\n\t\t}\n\n\t\tif (this.frm.doc.posting_date) var date = this.frm.doc.posting_date;\n\t\telse var date = this.frm.doc.transaction_date;\n\n\t\tif (frappe.meta.get_docfield(this.frm.doctype, \"shipping_address\") &&\n\t\t\tin_list(['Purchase Order', 'Purchase Receipt', 'Purchase Invoice'], this.frm.doctype)) {\n\t\t\terpnext.utils.get_shipping_address(this.frm, function(){\n\t\t\t\tset_party_account(set_pricing);\n\t\t\t})\n\n\t\t\t// Get default company billing address in Purchase Invoice, Order and Receipt\n\t\t\tfrappe.call({\n\t\t\t\t'method': 'frappe.contacts.doctype.address.address.get_default_address',\n\t\t\t\t'args': {\n\t\t\t\t\t'doctype': 'Company',\n\t\t\t\t\t'name': this.frm.doc.company\n\t\t\t\t},\n\t\t\t\t'callback': function(r) {\n\t\t\t\t\tme.frm.set_value('billing_address', r.message);\n\t\t\t\t}\n\t\t\t});\n\n\t\t} else {\n\t\t\tset_party_account(set_pricing);\n\t\t}\n\n\t\tif(this.frm.doc.company) {\n\t\t\terpnext.last_selected_company = this.frm.doc.company;\n\t\t}\n\t},\n\n\ttransaction_date: function() {\n\t\tif (this.frm.doc.transaction_date) {\n\t\t\tthis.frm.transaction_date = this.frm.doc.transaction_date;\n\t\t\tfrappe.ui.form.trigger(this.frm.doc.doctype, \"currency\");\n\t\t}\n\t},\n\n\tposting_date: function() {\n\t\tvar me = this;\n\t\tif (this.frm.doc.posting_date) {\n\t\t\tthis.frm.posting_date = this.frm.doc.posting_date;\n\n\t\t\tif ((this.frm.doc.doctype == \"Sales Invoice\" && this.frm.doc.customer) ||\n\t\t\t\t(this.frm.doc.doctype == \"Purchase Invoice\" && this.frm.doc.supplier)) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: \"erpnext.accounts.party.get_due_date\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\t\"posting_date\": me.frm.doc.posting_date,\n\t\t\t\t\t\t\"party_type\": me.frm.doc.doctype == \"Sales Invoice\" ? \"Customer\" : \"Supplier\",\n\t\t\t\t\t\t\"bill_date\": me.frm.doc.bill_date,\n\t\t\t\t\t\t\"party\": me.frm.doc.doctype == \"Sales Invoice\" ? me.frm.doc.customer : me.frm.doc.supplier,\n\t\t\t\t\t\t\"company\": me.frm.doc.company\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\t\tif(r.message) {\n\t\t\t\t\t\t\tme.frm.doc.due_date = r.message;\n\t\t\t\t\t\t\trefresh_field(\"due_date\");\n\t\t\t\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t\t\t\t\tme.recalculate_terms();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tfrappe.ui.form.trigger(me.frm.doc.doctype, \"currency\");\n\t\t\t}\n\t\t}\n\t},\n\n\tdue_date: function() {\n\t\t// due_date is to be changed, payment terms template and/or payment schedule must\n\t\t// be removed as due_date is automatically changed based on payment terms\n\t\tif (this.frm.doc.due_date && !this.frm.updating_party_details && !this.frm.doc.is_pos) {\n\t\t\tif (this.frm.doc.payment_terms_template ||\n\t\t\t\t(this.frm.doc.payment_schedule && this.frm.doc.payment_schedule.length)) {\n\t\t\t\tvar message1 = \"\";\n\t\t\t\tvar message2 = \"\";\n\t\t\t\tvar final_message = \"Please clear the \";\n\n\t\t\t\tif (this.frm.doc.payment_terms_template) {\n\t\t\t\t\tmessage1 = \"selected Payment Terms Template\";\n\t\t\t\t\tfinal_message = final_message + message1;\n\t\t\t\t}\n\n\t\t\t\tif ((this.frm.doc.payment_schedule || []).length) {\n\t\t\t\t\tmessage2 = \"Payment Schedule Table\";\n\t\t\t\t\tif (message1.length !== 0) message2 = \" and \" + message2;\n\t\t\t\t\tfinal_message = final_message + message2;\n\t\t\t\t}\n\t\t\t\tfrappe.msgprint(final_message);\n\t\t\t}\n\t\t}\n\t},\n\n\tbill_date: function() {\n\t\tthis.posting_date();\n\t},\n\n\trecalculate_terms: function() {\n\t\tconst doc = this.frm.doc;\n\t\tif (doc.payment_terms_template) {\n\t\t\tthis.payment_terms_template();\n\t\t} else if (doc.payment_schedule) {\n\t\t\tconst me = this;\n\t\t\tdoc.payment_schedule.forEach(\n\t\t\t\tfunction(term) {\n\t\t\t\t\tif (term.payment_term) {\n\t\t\t\t\t\tme.payment_term(doc, term.doctype, term.name);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tterm.doctype, term.name, 'due_date',\n\t\t\t\t\t\t\tdoc.posting_date || doc.transaction_date\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t},\n\n\tget_company_currency: function() {\n\t\treturn erpnext.get_currency(this.frm.doc.company);\n\t},\n\n\tcontact_person: function() {\n\t\terpnext.utils.get_contact_details(this.frm);\n\t},\n\n\tcurrency: function() {\n\t\t/* manqala 19/09/2016: let the translation date be whichever of the transaction_date or posting_date is available */\n\t\tvar transaction_date = this.frm.doc.transaction_date || this.frm.doc.posting_date;\n\t\t/* end manqala */\n\t\tvar me = this;\n\t\tthis.set_dynamic_labels();\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.currency && this.frm.doc.currency !== company_currency\n\t\t\t\t&& !this.frm.doc.ignore_pricing_rule) {\n\n\t\t\tthis.get_exchange_rate(transaction_date, this.frm.doc.currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tif(exchange_rate != me.frm.doc.conversion_rate) {\n\t\t\t\t\t\tme.set_margin_amount_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.set_actual_charges_based_on_currency(exchange_rate);\n\t\t\t\t\t\tme.frm.set_value(\"conversion_rate\", exchange_rate);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.conversion_rate();\n\t\t}\n\t},\n\n\tconversion_rate: function() {\n\t\tconst me = this.frm;\n\t\tif(this.frm.doc.currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", 1.0);\n\t\t}\n\t\tif(this.frm.doc.currency === this.frm.doc.price_list_currency &&\n\t\t\tthis.frm.doc.plc_conversion_rate !== this.frm.doc.conversion_rate) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", this.frm.doc.conversion_rate);\n\t\t}\n\n\t\tif(flt(this.frm.doc.conversion_rate)>0.0) {\n\t\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\t\tthis.calculate_taxes_and_totals();\n\t\t\t} else if (!this.in_apply_price_list){\n\t\t\t\tthis.apply_price_list();\n\t\t\t}\n\n\t\t}\n\t\t// Make read only if Accounts Settings doesn't allow stale rates\n\t\tthis.frm.set_df_property(\"conversion_rate\", \"read_only\", erpnext.stale_rate_allowed() ? 0 : 1);\n\t},\n\n\tshipping_rule: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.shipping_rule) {\n\t\t\treturn this.frm.call({\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tmethod: \"apply_shipping_rule\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}).fail(() => this.frm.set_value('shipping_rule', ''));\n\t\t}\n\t\telse {\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t},\n\n\tset_margin_amount_based_on_currency: function(exchange_rate) {\n\t\tif (in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"]), this.frm.doc.doctype) {\n\t\t\tvar me = this;\n\t\t\t$.each(this.frm.doc.items || [], function(i, d) {\n\t\t\t\tif(d.margin_type == \"Amount\") {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"margin_rate_or_amount\",\n\t\t\t\t\t\tflt(d.margin_rate_or_amount) / flt(exchange_rate));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_actual_charges_based_on_currency: function(exchange_rate) {\n\t\tvar me = this;\n\t\t$.each(this.frm.doc.taxes || [], function(i, d) {\n\t\t\tif(d.charge_type == \"Actual\") {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, \"tax_amount\",\n\t\t\t\t\tflt(d.tax_amount) / flt(exchange_rate));\n\t\t\t}\n\t\t});\n\t},\n\n\tget_exchange_rate: function(transaction_date, from_currency, to_currency, callback) {\n\t\tvar args;\n\t\tif ([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_selling\";\n\t\t}\n\t\telse if ([\"Purchase Order\", \"Purchase Receipt\", \"Purchase Invoice\"].includes(this.frm.doctype)) {\n\t\t\targs = \"for_buying\";\n\t\t}\n\n\t\tif (!transaction_date || !from_currency || !to_currency) return;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.setup.utils.get_exchange_rate\",\n\t\t\targs: {\n\t\t\t\ttransaction_date: transaction_date,\n\t\t\t\tfrom_currency: from_currency,\n\t\t\t\tto_currency: to_currency,\n\t\t\t\targs: args\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tcallback(flt(r.message));\n\t\t\t}\n\t\t});\n\t},\n\n\tprice_list_currency: function() {\n\t\tvar me=this;\n\t\tthis.set_dynamic_labels();\n\n\t\tvar company_currency = this.get_company_currency();\n\t\t// Added `ignore_pricing_rule` to determine if document is loading after mapping from another doc\n\t\tif(this.frm.doc.price_list_currency !== company_currency  && !this.frm.doc.ignore_pricing_rule) {\n\t\t\tthis.get_exchange_rate(this.frm.doc.posting_date, this.frm.doc.price_list_currency, company_currency,\n\t\t\t\tfunction(exchange_rate) {\n\t\t\t\t\tme.frm.set_value(\"plc_conversion_rate\", exchange_rate);\n\t\t\t\t});\n\t\t} else {\n\t\t\tthis.plc_conversion_rate();\n\t\t}\n\t},\n\n\tplc_conversion_rate: function() {\n\t\tif(this.frm.doc.price_list_currency === this.get_company_currency()) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", 1.0);\n\t\t} else if(this.frm.doc.price_list_currency === this.frm.doc.currency\n\t\t\t&& this.frm.doc.plc_conversion_rate && cint(this.frm.doc.plc_conversion_rate) != 1 &&\n\t\t\tcint(this.frm.doc.plc_conversion_rate) != cint(this.frm.doc.conversion_rate)) {\n\t\t\tthis.frm.set_value(\"conversion_rate\", this.frm.doc.plc_conversion_rate);\n\t\t}\n\n\t\tif(!this.in_apply_price_list) {\n\t\t\tthis.apply_price_list(null, true);\n\t\t}\n\t},\n\n\tuom: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(item.item_code && item.uom) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_conversion_factor\",\n\t\t\t\tchild: item,\n\t\t\t\targs: {\n\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\tuom: item.uom\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tme.conversion_factor(me.frm.doc, cdt, cdn);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tconversion_factor: function(doc, cdt, cdn, dont_fetch_price_list_rate) {\n\t\tif(frappe.meta.get_docfield(cdt, \"stock_qty\", cdn)) {\n\t\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\t\tfrappe.model.round_floats_in(item, [\"qty\", \"conversion_factor\"]);\n\t\t\titem.stock_qty = flt(item.qty * item.conversion_factor, precision(\"stock_qty\", item));\n\t\t\trefresh_field(\"stock_qty\", item.name, item.parentfield);\n\t\t\tthis.toggle_conversion_factor(item);\n\n\t\t\tif(doc.doctype != \"Material Request\") {\n\t\t\t\titem.total_weight = flt(item.stock_qty * item.weight_per_unit);\n\t\t\t\trefresh_field(\"total_weight\", item.name, item.parentfield);\n\t\t\t\tthis.calculate_net_weight();\n\t\t\t}\n\n\t\t\tif (!dont_fetch_price_list_rate &&\n\t\t\t\tfrappe.meta.has_field(doc.doctype, \"price_list_currency\")) {\n\t\t\t\tthis.apply_price_list(item, true);\n\t\t\t}\n\t\t}\n\t},\n\n\ttoggle_conversion_factor: function(item) {\n\t\t// toggle read only property for conversion factor field if the uom and stock uom are same\n\t\tif(this.frm.get_field('items').grid.fields_map.conversion_factor) {\n\t\t\tthis.frm.fields_dict.items.grid.toggle_enable(\"conversion_factor\",\n\t\t\t\t((item.uom != item.stock_uom) && !frappe.meta.get_docfield(cur_frm.fields_dict.items.grid.doctype, \"conversion_factor\").read_only)? true: false);\n\t\t}\n\n\t},\n\n\tqty: function(doc, cdt, cdn) {\n\t\tlet item = frappe.get_doc(cdt, cdn);\n\t\tthis.conversion_factor(doc, cdt, cdn, true);\n\t\tthis.apply_pricing_rule(item, true);\n\t},\n\n\tservice_stop_date: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_stop_date) {\n\t\t\tlet start_date = Date.parse(child.service_start_date);\n\t\t\tlet end_date = Date.parse(child.service_end_date);\n\t\t\tlet stop_date = Date.parse(child.service_stop_date);\n\n\t\t\tif(stop_date < start_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be before Service Start Date\"));\n\t\t\t} else if (stop_date > end_date) {\n\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_stop_date\", \"\");\n\t\t\t\tfrappe.throw(__(\"Service Stop Date cannot be after Service End Date\"));\n\t\t\t}\n\t\t}\n\t},\n\n\tservice_start_date: function(frm, cdt, cdn) {\n\t\tvar child = locals[cdt][cdn];\n\n\t\tif(child.service_start_date) {\n\t\t\tfrappe.call({\n\t\t\t\t\"method\": \"erpnext.stock.get_item_details.calculate_service_end_date\",\n\t\t\t\targs: {\"args\": child},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tfrappe.model.set_value(cdt, cdn, \"service_end_date\", r.message.service_end_date);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tcalculate_net_weight: function(){\n\t\t/* Calculate Total Net Weight then further applied shipping rule to calculate shipping charges.*/\n\t\tvar me = this;\n\t\tthis.frm.doc.total_net_weight= 0.0;\n\n\t\t$.each(this.frm.doc[\"items\"] || [], function(i, item) {\n\t\t\tme.frm.doc.total_net_weight += flt(item.total_weight);\n\t\t});\n\t\trefresh_field(\"total_net_weight\");\n\t\tthis.shipping_rule();\n\t},\n\n\tset_dynamic_labels: function() {\n\t\t// What TODO? should we make price list system non-mandatory?\n\t\tthis.frm.toggle_reqd(\"plc_conversion_rate\",\n\t\t\t!!(this.frm.doc.price_list_name && this.frm.doc.price_list_currency));\n\n\t\tvar company_currency = this.get_company_currency();\n\t\tthis.change_form_labels(company_currency);\n\t\tthis.change_grid_labels(company_currency);\n\t\tthis.frm.refresh_fields();\n\t},\n\n\tchange_form_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_total\", \"base_net_total\", \"base_total_taxes_and_charges\",\n\t\t\t\"base_discount_amount\", \"base_grand_total\", \"base_rounded_total\", \"base_in_words\",\n\t\t\t\"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\", \"total_amount_to_pay\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_change_amount\", \"base_operating_cost\",\n\t\t\t\"base_raw_material_cost\", \"base_total_cost\", \"base_scrap_material_cost\",\n\t\t\t\"base_rounding_adjustment\"], company_currency);\n\n\t\tthis.frm.set_currency_labels([\"total\", \"net_total\", \"total_taxes_and_charges\", \"discount_amount\",\n\t\t\t\"grand_total\", \"taxes_and_charges_added\", \"taxes_and_charges_deducted\",\n\t\t\t\"rounded_total\", \"in_words\", \"paid_amount\", \"write_off_amount\", \"operating_cost\",\n\t\t\t\"scrap_material_cost\", \"rounding_adjustment\", \"raw_material_cost\",\n\t\t\t\"total_cost\"], this.frm.doc.currency);\n\n\t\tthis.frm.set_currency_labels([\"outstanding_amount\", \"total_advance\"],\n\t\t\tthis.frm.doc.party_account_currency);\n\n\t\tcur_frm.set_df_property(\"conversion_rate\", \"description\", \"1 \" + this.frm.doc.currency\n\t\t\t+ \" = [?] \" + company_currency);\n\n\t\tif(this.frm.doc.price_list_currency && this.frm.doc.price_list_currency!=company_currency) {\n\t\t\tcur_frm.set_df_property(\"plc_conversion_rate\", \"description\", \"1 \"\n\t\t\t\t+ this.frm.doc.price_list_currency + \" = [?] \" + company_currency);\n\t\t}\n\n\t\t// toggle fields\n\t\tthis.frm.toggle_display([\"conversion_rate\", \"base_total\", \"base_net_total\",\n\t\t\t\"base_total_taxes_and_charges\", \"base_taxes_and_charges_added\", \"base_taxes_and_charges_deducted\",\n\t\t\t\"base_grand_total\", \"base_rounded_total\", \"base_in_words\", \"base_discount_amount\",\n\t\t\t\"base_paid_amount\", \"base_write_off_amount\", \"base_operating_cost\", \"base_raw_material_cost\",\n\t\t\t\"base_total_cost\", \"base_scrap_material_cost\", \"base_rounding_adjustment\"],\n\t\tthis.frm.doc.currency != company_currency);\n\n\t\tthis.frm.toggle_display([\"plc_conversion_rate\", \"price_list_currency\"],\n\t\t\tthis.frm.doc.price_list_currency != company_currency);\n\n\t\tvar show = cint(cur_frm.doc.discount_amount) ||\n\t\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"net_total\"))\n\t\t\tcur_frm.toggle_display(\"net_total\", show);\n\n\t\tif(frappe.meta.get_docfield(cur_frm.doctype, \"base_net_total\"))\n\t\t\tcur_frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n\n\t},\n\n\tchange_grid_labels: function(company_currency) {\n\t\tvar me = this;\n\n\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_net_rate\", \"base_price_list_rate\", \"base_amount\", \"base_net_amount\"],\n\t\t\tcompany_currency, \"items\");\n\n\t\tthis.frm.set_currency_labels([\"rate\", \"net_rate\", \"price_list_rate\", \"amount\", \"net_amount\"],\n\t\t\tthis.frm.doc.currency, \"items\");\n\n\t\tif(this.frm.fields_dict[\"operations\"]) {\n\t\t\tthis.frm.set_currency_labels([\"operating_cost\", \"hour_rate\"], this.frm.doc.currency, \"operations\");\n\t\t\tthis.frm.set_currency_labels([\"base_operating_cost\", \"base_hour_rate\"], company_currency, \"operations\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"operations\"].grid;\n\t\t\t$.each([\"base_operating_cost\", \"base_hour_rate\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"scrap_items\"]) {\n\t\t\tthis.frm.set_currency_labels([\"rate\", \"amount\"], this.frm.doc.currency, \"scrap_items\");\n\t\t\tthis.frm.set_currency_labels([\"base_rate\", \"base_amount\"], company_currency, \"scrap_items\");\n\n\t\t\tvar item_grid = this.frm.fields_dict[\"scrap_items\"].grid;\n\t\t\t$.each([\"base_rate\", \"base_amount\"], function(i, fname) {\n\t\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t\t});\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"taxes\"]) {\n\t\t\tthis.frm.set_currency_labels([\"tax_amount\", \"total\", \"tax_amount_after_discount\"], this.frm.doc.currency, \"taxes\");\n\n\t\t\tthis.frm.set_currency_labels([\"base_tax_amount\", \"base_total\", \"base_tax_amount_after_discount\"], company_currency, \"taxes\");\n\t\t}\n\n\t\tif(this.frm.fields_dict[\"advances\"]) {\n\t\t\tthis.frm.set_currency_labels([\"advance_amount\", \"allocated_amount\"],\n\t\t\t\tthis.frm.doc.party_account_currency, \"advances\");\n\t\t}\n\n\t\t// toggle columns\n\t\tvar item_grid = this.frm.fields_dict[\"items\"].grid;\n\t\t$.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n\t\t});\n\n\t\tvar show = (cint(cur_frm.doc.discount_amount)) ||\n\t\t\t((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n\n\t\t$.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, show);\n\t\t});\n\n\t\t$.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n\t\t\tif(frappe.meta.get_docfield(item_grid.doctype, fname))\n\t\t\t\titem_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n\t\t});\n\n\t\t// set labels\n\t\tvar $wrapper = $(this.frm.wrapper);\n\t},\n\n\trecalculate: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\trecalculate_values: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tcalculate_charges: function() {\n\t\tthis.calculate_taxes_and_totals();\n\t},\n\n\tignore_pricing_rule: function() {\n\t\tif(this.frm.doc.ignore_pricing_rule) {\n\t\t\tvar me = this;\n\t\t\tvar item_list = [];\n\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tif (d.item_code && !d.is_free_item) {\n\t\t\t\t\titem_list.push({\n\t\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\t\"parent\": d.parent\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.remove_pricing_rules\",\n\t\t\t\targs: { item_list: item_list },\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\t\tr.message.forEach(row_item => {\n\t\t\t\t\t\t\tme.remove_pricing_rule(row_item);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.apply_pricing_rule();\n\t\t}\n\t},\n\n\tapply_pricing_rule: function(item, calculate_taxes_and_totals) {\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!(args.items && args.items.length)) {\n\t\t\tif(calculate_taxes_and_totals) me.calculate_taxes_and_totals();\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pricing_rule.pricing_rule.apply_pricing_rule\",\n\t\t\targs: {\targs: args, doc: me.frm.doc },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc && r.message) {\n\t\t\t\t\tme._set_values_for_item_list(r.message);\n\t\t\t\t\tif(item) me.set_gross_profit(item);\n\t\t\t\t\tif(me.frm.doc.apply_discount_on) me.frm.trigger(\"apply_discount_on\")\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t_get_args: function(item) {\n\t\tvar me = this;\n\t\treturn {\n\t\t\t\"items\": this._get_item_list(item),\n\t\t\t\"customer\": me.frm.doc.customer || me.frm.doc.party_name,\n\t\t\t\"quotation_to\": me.frm.doc.quotation_to,\n\t\t\t\"customer_group\": me.frm.doc.customer_group,\n\t\t\t\"territory\": me.frm.doc.territory,\n\t\t\t\"supplier\": me.frm.doc.supplier,\n\t\t\t\"supplier_group\": me.frm.doc.supplier_group,\n\t\t\t\"currency\": me.frm.doc.currency,\n\t\t\t\"conversion_rate\": me.frm.doc.conversion_rate,\n\t\t\t\"price_list\": me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n\t\t\t\"price_list_currency\": me.frm.doc.price_list_currency,\n\t\t\t\"plc_conversion_rate\": me.frm.doc.plc_conversion_rate,\n\t\t\t\"company\": me.frm.doc.company,\n\t\t\t\"transaction_date\": me.frm.doc.transaction_date || me.frm.doc.posting_date,\n\t\t\t\"campaign\": me.frm.doc.campaign,\n\t\t\t\"sales_partner\": me.frm.doc.sales_partner,\n\t\t\t\"ignore_pricing_rule\": me.frm.doc.ignore_pricing_rule,\n\t\t\t\"doctype\": me.frm.doc.doctype,\n\t\t\t\"name\": me.frm.doc.name,\n\t\t\t\"is_return\": cint(me.frm.doc.is_return),\n\t\t\t\"update_stock\": in_list(['Sales Invoice', 'Purchase Invoice'], me.frm.doc.doctype) ? cint(me.frm.doc.update_stock) : 0,\n\t\t\t\"conversion_factor\": me.frm.doc.conversion_factor,\n\t\t\t\"pos_profile\": me.frm.doc.doctype == 'Sales Invoice' ? me.frm.doc.pos_profile : '',\n\t\t\t\"coupon_code\": me.frm.doc.coupon_code\n\t\t};\n\t},\n\n\t_get_item_list: function(item) {\n\t\tvar item_list = [];\n\t\tvar append_item = function(d) {\n\t\t\tif (d.item_code) {\n\t\t\t\titem_list.push({\n\t\t\t\t\t\"doctype\": d.doctype,\n\t\t\t\t\t\"name\": d.name,\n\t\t\t\t\t\"child_docname\": d.name,\n\t\t\t\t\t\"item_code\": d.item_code,\n\t\t\t\t\t\"item_group\": d.item_group,\n\t\t\t\t\t\"brand\": d.brand,\n\t\t\t\t\t\"qty\": d.qty,\n\t\t\t\t\t\"stock_qty\": d.stock_qty,\n\t\t\t\t\t\"uom\": d.uom,\n\t\t\t\t\t\"stock_uom\": d.stock_uom,\n\t\t\t\t\t\"parenttype\": d.parenttype,\n\t\t\t\t\t\"parent\": d.parent,\n\t\t\t\t\t\"pricing_rules\": d.pricing_rules,\n\t\t\t\t\t\"warehouse\": d.warehouse,\n\t\t\t\t\t\"serial_no\": d.serial_no,\n\t\t\t\t\t\"price_list_rate\": d.price_list_rate,\n\t\t\t\t\t\"conversion_factor\": d.conversion_factor || 1.0\n\t\t\t\t});\n\n\t\t\t\t// if doctype is Quotation Item / Sales Order Iten then add Margin Type and rate in item_list\n\t\t\t\tif (in_list([\"Quotation Item\", \"Sales Order Item\", \"Delivery Note Item\", \"Sales Invoice Item\"]), d.doctype){\n\t\t\t\t\titem_list[0][\"margin_type\"] = d.margin_type;\n\t\t\t\t\titem_list[0][\"margin_rate_or_amount\"] = d.margin_rate_or_amount;\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (item) {\n\t\t\tappend_item(item);\n\t\t} else {\n\t\t\t$.each(this.frm.doc[\"items\"] || [], function(i, d) {\n\t\t\t\tappend_item(d);\n\t\t\t});\n\t\t}\n\t\treturn item_list;\n\t},\n\n\t_set_values_for_item_list: function(children) {\n\t\tvar me = this;\n\t\tvar price_list_rate_changed = false;\n\t\tvar items_rule_dict = {};\n\n\t\tfor(var i=0, l=children.length; i<l; i++) {\n\t\t\tvar d = children[i];\n\t\t\tvar existing_pricing_rule = frappe.model.get_value(d.doctype, d.name, \"pricing_rules\");\n\t\t\tfor(var k in d) {\n\t\t\t\tvar v = d[k];\n\t\t\t\tif ([\"doctype\", \"name\"].indexOf(k)===-1) {\n\t\t\t\t\tif(k==\"price_list_rate\") {\n\t\t\t\t\t\tif(flt(v) != flt(d.price_list_rate)) price_list_rate_changed = true;\n\t\t\t\t\t}\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, v);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if pricing rule set as blank from an existing value, apply price_list\n\t\t\tif(!me.frm.doc.ignore_pricing_rule && existing_pricing_rule && !d.pricing_rules) {\n\t\t\t\tme.apply_price_list(frappe.get_doc(d.doctype, d.name));\n\t\t\t} else if(!d.pricing_rules) {\n\t\t\t\tme.remove_pricing_rule(frappe.get_doc(d.doctype, d.name));\n\t\t\t}\n\n\t\t\tif (d.free_item_data) {\n\t\t\t\tme.apply_product_discount(d.free_item_data);\n\t\t\t}\n\n\t\t\tif (d.apply_rule_on_other_items) {\n\t\t\t\titems_rule_dict[d.name] = d;\n\t\t\t}\n\t\t}\n\n\t\tme.apply_rule_on_other_items(items_rule_dict);\n\n\t\tif(!price_list_rate_changed) me.calculate_taxes_and_totals();\n\t},\n\n\tapply_rule_on_other_items: function(args) {\n\t\tconst me = this;\n\t\tconst fields = [\"discount_percentage\", \"pricing_rules\", \"discount_amount\", \"rate\"];\n\n\t\tfor(var k in args) {\n\t\t\tlet data = args[k];\n\n\t\t\tif (data && data.apply_rule_on_other_items) {\n\t\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\t\tif (in_list(data.apply_rule_on_other_items, d[data.apply_rule_on])) {\n\t\t\t\t\t\tfor(var k in data) {\n\t\t\t\t\t\t\tif (in_list(fields, k) && data[k] && (data.price_or_product_discount === 'price' || k === 'pricing_rules')) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, k, data[k]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t},\n\n\tapply_product_discount: function(free_item_data) {\n\t\tconst items = this.frm.doc.items.filter(d => (d.item_code == free_item_data.item_code\n\t\t\t&& d.is_free_item)) || [];\n\n\t\tif (!items.length) {\n\t\t\tlet row_to_modify = frappe.model.add_child(this.frm.doc,\n\t\t\t\tthis.frm.doc.doctype + ' Item', 'items');\n\n\t\t\tfor (let key in free_item_data) {\n\t\t\t\trow_to_modify[key] = free_item_data[key];\n\t\t\t}\n\t\t} if (items && items.length && free_item_data) {\n\t\t\titems[0].qty = free_item_data.qty\n\t\t}\n\t},\n\n\tapply_price_list: function(item, reset_plc_conversion) {\n\t\t// We need to reset plc_conversion_rate sometimes because the call to\n\t\t// `erpnext.stock.get_item_details.apply_price_list` is sensitive to its value\n\t\tif (!reset_plc_conversion) {\n\t\t\tthis.frm.set_value(\"plc_conversion_rate\", \"\");\n\t\t}\n\n\t\tvar me = this;\n\t\tvar args = this._get_args(item);\n\t\tif (!((args.items && args.items.length) || args.price_list)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (me.in_apply_price_list == true) return;\n\n\t\tme.in_apply_price_list = true;\n\t\treturn this.frm.call({\n\t\t\tmethod: \"erpnext.stock.get_item_details.apply_price_list\",\n\t\t\targs: {\targs: args },\n\t\t\tcallback: function(r) {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => me.frm.set_value(\"price_list_currency\", r.message.parent.price_list_currency),\n\t\t\t\t\t\t() => me.frm.set_value(\"plc_conversion_rate\", r.message.parent.plc_conversion_rate),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tif(args.items.length) {\n\t\t\t\t\t\t\t\tme._set_values_for_item_list(r.message.children);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t() => { me.in_apply_price_list = false; }\n\t\t\t\t\t]);\n\n\t\t\t\t} else {\n\t\t\t\t\tme.in_apply_price_list = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}).always(() => {\n\t\t\tme.in_apply_price_list = false;\n\t\t});\n\t},\n\n\tremove_pricing_rule: function(item) {\n\t\tlet me = this;\n\t\tconst fields = [\"discount_percentage\",\n\t\t\t\"discount_amount\", \"margin_rate_or_amount\", \"rate_with_margin\"];\n\n\t\tif(item.remove_free_item) {\n\t\t\tvar items = [];\n\n\t\t\tme.frm.doc.items.forEach(d => {\n\t\t\t\tif(d.item_code != item.remove_free_item || !d.is_free_item) {\n\t\t\t\t\titems.push(d);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.frm.doc.items = items;\n\t\t\trefresh_field('items');\n\t\t} else if(item.applied_on_items && item.apply_on) {\n\t\t\tconst applied_on_items = item.applied_on_items.split(',');\n\t\t\tme.frm.doc.items.forEach(row => {\n\t\t\t\tif(applied_on_items.includes(row[item.apply_on])) {\n\t\t\t\t\tfields.forEach(f => {\n\t\t\t\t\t\trow[f] = 0;\n\t\t\t\t\t});\n\n\t\t\t\t\t[\"pricing_rules\", \"margin_type\"].forEach(field => {\n\t\t\t\t\t\tif (row[field]) {\n\t\t\t\t\t\t\trow[field] = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tme.trigger_price_list_rate();\n\t\t}\n\t},\n\n\ttrigger_price_list_rate: function() {\n\t\tvar me  = this;\n\n\t\tthis.frm.doc.items.forEach(child_row => {\n\t\t\tme.frm.script_manager.trigger(\"price_list_rate\",\n\t\t\t\tchild_row.doctype, child_row.name);\n\t\t})\n\t},\n\n\tvalidate_company_and_party: function() {\n\t\tvar me = this;\n\t\tvar valid = true;\n\n\t\t$.each([\"company\", \"customer\"], function(i, fieldname) {\n\t\t\tif(frappe.meta.has_field(me.frm.doc.doctype, fieldname) && me.frm.doc.doctype != \"Purchase Order\") {\n\t\t\t\tif (!me.frm.doc[fieldname]) {\n\t\t\t\t\tfrappe.msgprint(__(\"Please specify\") + \": \" +\n\t\t\t\t\t\tfrappe.meta.get_label(me.frm.doc.doctype, fieldname, me.frm.doc.name) +\n\t\t\t\t\t\t\". \" + __(\"It is needed to fetch Item Details.\"));\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn valid;\n\t},\n\n\tget_terms: function() {\n\t\tvar me = this;\n\n\t\terpnext.utils.get_terms(this.frm.doc.tc_name, this.frm.doc, function(r) {\n\t\t\tif(!r.exc) {\n\t\t\t\tme.frm.set_value(\"terms\", r.message);\n\t\t\t}\n\t\t});\n\t},\n\n\ttaxes_and_charges: function() {\n\t\tvar me = this;\n\t\tif(this.frm.doc.taxes_and_charges) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_taxes_and_charges\",\n\t\t\t\targs: {\n\t\t\t\t\t\"master_doctype\": frappe.meta.get_docfield(this.frm.doc.doctype, \"taxes_and_charges\",\n\t\t\t\t\t\tthis.frm.doc.name).options,\n\t\t\t\t\t\"master_name\": this.frm.doc.taxes_and_charges\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\tif(me.frm.doc.shipping_rule && me.frm.doc.taxes) {\n\t\t\t\t\t\t\tfor (let tax of r.message) {\n\t\t\t\t\t\t\t\tme.frm.add_child(\"taxes\", tax);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trefresh_field(\"taxes\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.frm.set_value(\"taxes\", r.message);\n\t\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\ttax_category: function() {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tfrappe.run_serially([\n\t\t\t() => this.update_item_tax_map(),\n\t\t\t() => erpnext.utils.set_taxes(this.frm, \"tax_category\"),\n\t\t]);\n\t},\n\n\titem_tax_template: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tif(me.frm.updating_party_details) return;\n\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(item.item_tax_template) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_map\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\titem_tax_template: item.item_tax_template,\n\t\t\t\t\tas_json: true\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\titem.item_tax_rate = r.message;\n\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titem.item_tax_rate = \"{}\";\n\t\t\tme.calculate_taxes_and_totals();\n\t\t}\n\t},\n\n\tupdate_item_tax_map: function() {\n\t\tvar me = this;\n\t\tvar item_codes = [];\n\t\t$.each(this.frm.doc.items || [], function(i, item) {\n\t\t\tif(item.item_code) {\n\t\t\t\titem_codes.push(item.item_code);\n\t\t\t}\n\t\t});\n\n\t\tif(item_codes.length) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_item_tax_info\",\n\t\t\t\targs: {\n\t\t\t\t\tcompany: me.frm.doc.company,\n\t\t\t\t\ttax_category: cstr(me.frm.doc.tax_category),\n\t\t\t\t\titem_codes: item_codes\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(!r.exc) {\n\t\t\t\t\t\t$.each(me.frm.doc.items || [], function(i, item) {\n\t\t\t\t\t\t\tif(item.item_code && r.message.hasOwnProperty(item.item_code)) {\n\t\t\t\t\t\t\t\tif (!item.item_tax_template) {\n\t\t\t\t\t\t\t\t\titem.item_tax_template = r.message[item.item_code].item_tax_template;\n\t\t\t\t\t\t\t\t\titem.item_tax_rate = r.message[item.item_code].item_tax_rate;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tme.add_taxes_from_item_tax_template(item.item_tax_rate);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\titem.item_tax_template = \"\";\n\t\t\t\t\t\t\t\titem.item_tax_rate = \"{}\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.calculate_taxes_and_totals();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tis_recurring: function() {\n\t\t// set default values for recurring documents\n\t\tif(this.frm.doc.is_recurring && this.frm.doc.__islocal) {\n\t\t\tfrappe.msgprint(__(\"Please set recurring after saving\"));\n\t\t\tthis.frm.set_value('is_recurring', 0);\n\t\t\treturn;\n\t\t}\n\n\t\tif(this.frm.doc.is_recurring) {\n\t\t\tif(!this.frm.doc.recurring_id) {\n\t\t\t\tthis.frm.set_value('recurring_id', this.frm.doc.name);\n\t\t\t}\n\n\t\t\tvar owner_email = this.frm.doc.owner==\"Administrator\"\n\t\t\t\t? frappe.user_info(\"Administrator\").email\n\t\t\t\t: this.frm.doc.owner;\n\n\t\t\tthis.frm.doc.notification_email_address = $.map([cstr(owner_email),\n\t\t\t\tcstr(this.frm.doc.contact_email)], function(v) { return v || null; }).join(\", \");\n\t\t\tthis.frm.doc.repeat_on_day_of_month = frappe.datetime.str_to_obj(this.frm.doc.posting_date).getDate();\n\t\t}\n\n\t\trefresh_many([\"notification_email_address\", \"repeat_on_day_of_month\"]);\n\t},\n\n\tfrom_date: function() {\n\t\t// set to_date\n\t\tif(this.frm.doc.from_date) {\n\t\t\tvar recurring_type_map = {'Monthly': 1, 'Quarterly': 3, 'Half-yearly': 6,\n\t\t\t\t'Yearly': 12};\n\n\t\t\tvar months = recurring_type_map[this.frm.doc.recurring_type];\n\t\t\tif(months) {\n\t\t\t\tvar to_date = frappe.datetime.add_months(this.frm.doc.from_date,\n\t\t\t\t\tmonths);\n\t\t\t\tthis.frm.doc.to_date = frappe.datetime.add_days(to_date, -1);\n\t\t\t\trefresh_field('to_date');\n\t\t\t}\n\t\t}\n\t},\n\n\tset_gross_profit: function(item) {\n\t\tif ([\"Sales Order\", \"Quotation\"].includes(this.frm.doc.doctype) && item.valuation_rate) {\n\t\t\tvar rate = flt(item.rate) * flt(this.frm.doc.conversion_rate || 1);\n\t\t\titem.gross_profit = flt(((rate - item.valuation_rate) * item.stock_qty), precision(\"amount\", item));\n\t\t}\n\t},\n\n\tsetup_item_selector: function() {\n\t\t// TODO: remove item selector\n\n\t\treturn;\n\t\t// if(!this.item_selector) {\n\t\t// \tthis.item_selector = new erpnext.ItemSelector({frm: this.frm});\n\t\t// }\n\t},\n\n\tget_advances: function() {\n\t\tif(!this.frm.is_return) {\n\t\t\treturn this.frm.call({\n\t\t\t\tmethod: \"set_advances\",\n\t\t\t\tdoc: this.frm.doc,\n\t\t\t\tcallback: function(r, rt) {\n\t\t\t\t\trefresh_field(\"advances\");\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tmake_payment_entry: function() {\n\t\treturn frappe.call({\n\t\t\tmethod: cur_frm.cscript.get_method_for_payment(),\n\t\t\targs: {\n\t\t\t\t\"dt\": cur_frm.doc.doctype,\n\t\t\t\t\"dn\": cur_frm.doc.name\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t\tvar doclist = frappe.model.sync(r.message);\n\t\t\t\tfrappe.set_route(\"Form\", doclist[0].doctype, doclist[0].name);\n\t\t\t\t// cur_frm.refresh_fields()\n\t\t\t}\n\t\t});\n\t},\n\n\tget_method_for_payment: function(){\n\t\tvar method = \"erpnext.accounts.doctype.payment_entry.payment_entry.get_payment_entry\";\n\t\tif(cur_frm.doc.__onload && cur_frm.doc.__onload.make_payment_via_journal_entry){\n\t\t\tif(in_list(['Sales Invoice', 'Purchase Invoice'],  cur_frm.doc.doctype)){\n\t\t\t\tmethod = \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_invoice\";\n\t\t\t}else {\n\t\t\t\tmethod= \"erpnext.accounts.doctype.journal_entry.journal_entry.get_payment_entry_against_order\";\n\t\t\t}\n\t\t}\n\n\t\treturn method\n\t},\n\n\tset_query_for_batch: function(doc, cdt, cdn) {\n\t\t// Show item's batches in the dropdown of batch no\n\n\t\tvar me = this;\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get batch no\"));\n\t\t} else if (doc.doctype == \"Purchase Receipt\" ||\n\t\t\t(doc.doctype == \"Purchase Invoice\" && doc.update_stock)) {\n\n\t\t\treturn {\n\t\t\t\tfilters: {'item': item.item_code}\n\t\t\t}\n\t\t} else {\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'posting_date': me.frm.doc.posting_date || frappe.datetime.nowdate(),\n\t\t\t}\n\n\t\t\tif (doc.is_return) {\n\t\t\t\tfilters[\"is_return\"] = 1;\n\t\t\t}\n\n\t\t\tif (item.warehouse) filters[\"warehouse\"] = item.warehouse;\n\n\t\t\treturn {\n\t\t\t\tquery : \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t},\n\n\tset_query_for_item_tax_template: function(doc, cdt, cdn) {\n\t\tvar item = frappe.get_doc(cdt, cdn);\n\t\tif(!item.item_code) {\n\t\t\tfrappe.throw(__(\"Please enter Item Code to get item taxes\"));\n\t\t} else {\n\n\t\t\tlet filters = {\n\t\t\t\t'item_code': item.item_code,\n\t\t\t\t'valid_from': [\"<=\", doc.transaction_date || doc.bill_date || doc.posting_date],\n\t\t\t\t'item_group': item.item_group,\n\t\t\t}\n\n\t\t\tif (doc.tax_category)\n\t\t\t\tfilters['tax_category'] = doc.tax_category;\n\t\t\tif (doc.company)\n\t\t\t\tfilters['company'] = doc.company;\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.controllers.queries.get_tax_template\",\n\t\t\t\tfilters: filters\n\t\t\t}\n\t\t}\n\t},\n\n\tpayment_terms_template: function() {\n\t\tvar me = this;\n\t\tconst doc = this.frm.doc;\n\t\tif(doc.payment_terms_template && doc.doctype !== 'Delivery Note') {\n\t\t\tvar posting_date = doc.posting_date || doc.transaction_date;\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_terms\",\n\t\t\t\targs: {\n\t\t\t\t\tterms_template: doc.payment_terms_template,\n\t\t\t\t\tposting_date: posting_date,\n\t\t\t\t\tgrand_total: doc.rounded_total || doc.grand_total,\n\t\t\t\t\tbill_date: doc.bill_date\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tme.frm.set_value(\"payment_schedule\", r.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tpayment_term: function(doc, cdt, cdn) {\n\t\tvar row = locals[cdt][cdn];\n\t\tif(row.payment_term) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.accounts_controller.get_payment_term_details\",\n\t\t\t\targs: {\n\t\t\t\t\tterm: row.payment_term,\n\t\t\t\t\tbill_date: this.frm.doc.bill_date,\n\t\t\t\t\tposting_date: this.frm.doc.posting_date || this.frm.doc.transaction_date,\n\t\t\t\t\tgrand_total: this.frm.doc.rounded_total || this.frm.doc.grand_total\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif(r.message && !r.exc) {\n\t\t\t\t\t\tfor (var d in r.message) {\n\t\t\t\t\t\t\tfrappe.model.set_value(cdt, cdn, d, r.message[d]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tagainst_blanket_order: function(doc, cdt, cdn) {\n\t\tvar item = locals[cdt][cdn];\n\t\tif(!item.against_blanket_order) {\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order\", null);\n\t\t\tfrappe.model.set_value(this.frm.doctype + \" Item\", item.name, \"blanket_order_rate\", 0.00);\n\t\t}\n\t},\n\n\tblanket_order: function(doc, cdt, cdn) {\n\t\tvar me = this;\n\t\tvar item = locals[cdt][cdn];\n\t\tif (item.blanket_order && (item.parenttype==\"Sales Order\" || item.parenttype==\"Purchase Order\")) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.stock.get_item_details.get_blanket_order_details\",\n\t\t\t\targs: {\n\t\t\t\t\targs:{\n\t\t\t\t\t\titem_code: item.item_code,\n\t\t\t\t\t\tcustomer: doc.customer,\n\t\t\t\t\t\tsupplier: doc.supplier,\n\t\t\t\t\t\tcompany: doc.company,\n\t\t\t\t\t\ttransaction_date: doc.transaction_date,\n\t\t\t\t\t\tblanket_order: item.blanket_order\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (!r.message) {\n\t\t\t\t\t\tfrappe.throw(__(\"Invalid Blanket Order for the selected Customer and Item\"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => frappe.model.set_value(cdt, cdn, \"blanket_order_rate\", r.message.blanket_order_rate),\n\t\t\t\t\t\t\t() => me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn)\n\t\t\t\t\t\t]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\n\tset_reserve_warehouse: function() {\n\t\tthis.autofill_warehouse(this.frm.doc.supplied_items, \"reserve_warehouse\", this.frm.doc.set_reserve_warehouse);\n\t},\n\n\tset_warehouse: function() {\n\t\tthis.autofill_warehouse(this.frm.doc.items, \"warehouse\", this.frm.doc.set_warehouse);\n\t},\n\n\tautofill_warehouse : function (child_table, warehouse_field, warehouse) {\n\t\tif (warehouse && child_table && child_table.length) {\n\t\t\tlet doctype = child_table[0].doctype;\n\t\t\t$.each(child_table || [], function(i, item) {\n\t\t\t\tfrappe.model.set_value(doctype, item.name, warehouse_field, warehouse);\n\t\t\t});\n\t\t}\n\t},\n\n\tcoupon_code: function() {\n\t\tvar me = this;\n\t\tfrappe.run_serially([\n\t\t\t() => this.frm.doc.ignore_pricing_rule=1,\n\t\t\t() => me.ignore_pricing_rule(),\n\t\t\t() => this.frm.doc.ignore_pricing_rule=0,\n\t\t\t() => me.apply_pricing_rule()\n\t\t]);\n\t}\n});\n\nerpnext.show_serial_batch_selector = function (frm, d, callback, on_close, show_dialog) {\n\tlet warehouse, receiving_stock, existing_stock;\n\tif (frm.doc.is_return) {\n\t\tif ([\"Purchase Receipt\", \"Purchase Invoice\"].includes(frm.doc.doctype)) {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = d.warehouse;\n\t\t} else if ([\"Delivery Note\", \"Sales Invoice\"].includes(frm.doc.doctype)) {\n\t\t\treceiving_stock = true;\n\t\t}\n\t} else {\n\t\tif (frm.doc.doctype == \"Stock Entry\") {\n\t\t\tif (frm.doc.purpose == \"Material Receipt\") {\n\t\t\t\treceiving_stock = true;\n\t\t\t} else {\n\t\t\t\texisting_stock = true;\n\t\t\t\twarehouse = d.s_warehouse;\n\t\t\t}\n\t\t} else {\n\t\t\texisting_stock = true;\n\t\t\twarehouse = d.warehouse;\n\t\t}\n\t}\n\n\tif (!warehouse) {\n\t\tif (receiving_stock) {\n\t\t\twarehouse = [\"like\", \"\"];\n\t\t} else if (existing_stock) {\n\t\t\twarehouse = [\"!=\", \"\"];\n\t\t}\n\t}\n\n\tfrappe.require(\"assets/erpnext/js/utils/serial_no_batch_selector.js\", function() {\n\t\tnew erpnext.SerialNoBatchSelector({\n\t\t\tfrm: frm,\n\t\t\titem: d,\n\t\t\twarehouse_details: {\n\t\t\t\ttype: \"Warehouse\",\n\t\t\t\tname: warehouse\n\t\t\t},\n\t\t\tcallback: callback,\n\t\t\ton_close: on_close\n\t\t}, show_dialog);\n\t});\n}\n","erpnext.ItemSelector = Class.extend({\n\tinit: function(opts) {\n\t\t$.extend(this, opts);\n\n\t\tif (!this.item_field) {\n\t\t\tthis.item_field = 'item_code';\n\t\t}\n\n\t\tif (!this.item_query) {\n\t\t\tthis.item_query = erpnext.queries.item().query;\n\t\t}\n\n\t\tthis.grid = this.frm.get_field(\"items\").grid;\n\t\tthis.setup();\n\t},\n\n\tsetup: function() {\n\t\tvar me = this;\n\t\tif(!this.grid.add_items_button) {\n\t\t\tthis.grid.add_items_button = this.grid.add_custom_button(__('Add Items'), function() {\n\t\t\t\tif(!me.dialog) {\n\t\t\t\t\tme.make_dialog();\n\t\t\t\t}\n\t\t\t\tme.dialog.show();\n\t\t\t\tme.render_items();\n\t\t\t\tsetTimeout(function() { me.dialog.input.focus(); }, 1000);\n\t\t\t});\n\t\t}\n\t},\n\n\tmake_dialog: function() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Add Items')\n\t\t});\n\t\tvar body = $(this.dialog.body);\n\t\tbody.html('<div><p><input type=\"text\" class=\"form-control\"></p>\\\n\t\t\t<br><div class=\"results\"></div></div>');\n\n\t\tthis.dialog.input = body.find('.form-control');\n\t\tthis.dialog.results = body.find('.results');\n\n\t\tvar me = this;\n\t\tthis.dialog.results.on('click', '.image-view-item', function() {\n\t\t\tme.add_item($(this).attr('data-name'));\n\t\t});\n\n\t\tthis.dialog.input.on('keyup', function() {\n\t\t\tif(me.timeout_id) {\n\t\t\t\tclearTimeout(me.timeout_id);\n\t\t\t}\n\t\t\tme.timeout_id = setTimeout(function() {\n\t\t\t\tme.render_items();\n\t\t\t\tme.timeout_id = undefined;\n\t\t\t}, 500);\n\t\t});\n\t},\n\n\tadd_item: function(item_code) {\n\t\t// add row or update qty\n\t\tvar added = false;\n\n\t\t// find row with item if exists\n\t\t$.each(this.frm.doc.items || [], (i, d) => {\n\t\t\tif(d[this.item_field]===item_code) {\n\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', d.qty + 1);\n\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, d.qty]), indicator: 'green'});\n\t\t\t\tadded = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\tif(!added) {\n\t\t\tvar d = null;\n\t\t\tfrappe.run_serially([\n\t\t\t\t() => { d = this.grid.add_new_row(); },\n\t\t\t\t() => frappe.model.set_value(d.doctype, d.name, this.item_field, item_code),\n\t\t\t\t() => frappe.timeout(0.1),\n\t\t\t\t() => {\n\t\t\t\t\tfrappe.model.set_value(d.doctype, d.name, 'qty', 1);\n\t\t\t\t\tfrappe.show_alert({message: __(\"Added {0} ({1})\", [item_code, 1]), indicator: 'green'});\n\t\t\t\t}\n\t\t\t]);\n\t\t}\n\n\t},\n\n\trender_items: function() {\n\t\tlet args = {\n\t\t\tquery: this.item_query,\n\t\t\tfilters: {}\n\t\t};\n\t\targs.txt = this.dialog.input.val();\n\t\targs.as_dict = 1;\n\n\t\tif (this.get_filters) {\n\t\t\t$.extend(args.filters, this.get_filters() || {});\n\t\t}\n\n\t\tvar me = this;\n\t\tfrappe.link_search(\"Item\", args, function(r) {\n\t\t\t$.each(r.values, function(i, d) {\n\t\t\t\tif(!d.image) {\n\t\t\t\t\td.abbr = frappe.get_abbr(d.item_name);\n\t\t\t\t\td.color = frappe.get_palette(d.item_name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tme.dialog.results.html(frappe.render_template('item_selector', {'data':r.values}));\n\t\t});\n\t}\n});","frappe.provide('frappe.help.help_links');\n\nconst docsUrl = 'https://erpnext.com/docs/';\n\nfrappe.help.help_links['Form/Rename Tool'] = [\n\t{ label: 'Bulk Rename', url: docsUrl + 'user/manual/en/setting-up/data/bulk-rename' },\n]\n\n//Setup\n\nfrappe.help.help_links['List/User'] = [\n\t{ label: 'New User', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/adding-users' },\n\t{ label: 'Rename User', url: docsUrl + 'user/manual/en/setting-up/articles/rename-user' },\n]\n\nfrappe.help.help_links['permission-manager'] = [\n\t{ label: 'Role Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/role-based-permissions' },\n\t{ label: 'Managing Perm Level in Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/articles/managing-perm-level' },\n\t{ label: 'User Permissions', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/user-permissions' },\n\t{ label: 'Sharing', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/sharing' },\n\t{ label: 'Password', url: docsUrl + 'user/manual/en/setting-up/articles/change-password' },\n]\n\nfrappe.help.help_links['Form/System Settings'] = [\n\t{ label: 'Naming Series', url: docsUrl + 'user/manual/en/setting-up/settings/system-settings' },\n]\n\nfrappe.help.help_links['data-import-tool'] = [\n\t{ label: 'Importing and Exporting Data', url: docsUrl + 'user/manual/en/setting-up/data/data-import-tool' },\n\t{ label: 'Overwriting Data from Data Import Tool', url: docsUrl + 'user/manual/en/setting-up/articles/overwriting-data-from-data-import-tool' },\n]\n\nfrappe.help.help_links['module_setup'] = [\n\t{ label: 'Role Permissions Manager', url: docsUrl + 'user/manual/en/setting-up/users-and-permissions/role-based-permissions' },\n]\n\nfrappe.help.help_links['Form/Naming Series'] = [\n\t{ label: 'Naming Series', url: docsUrl + 'user/manual/en/setting-up/settings/naming-series' },\n\t{ label: 'Setting the Current Value for Naming Series', url: docsUrl + 'user/manual/en/setting-up/articles/naming-series-current-value' },\n]\n\nfrappe.help.help_links['Form/Global Defaults'] = [\n\t{ label: 'Global Settings', url: docsUrl + 'user/manual/en/setting-up/settings/global-defaults' },\n]\n\nfrappe.help.help_links['Form/Email Digest'] = [\n\t{ label: 'Email Digest', url: docsUrl + 'user/manual/en/setting-up/email/email-digest' },\n]\n\nfrappe.help.help_links['List/Print Heading'] = [\n\t{ label: 'Print Heading', url: docsUrl + 'user/manual/en/setting-up/print/print-headings' },\n]\n\nfrappe.help.help_links['List/Letter Head'] = [\n\t{ label: 'Letter Head', url: docsUrl + 'user/manual/en/setting-up/print/letter-head' },\n]\n\nfrappe.help.help_links['List/Address Template'] = [\n\t{ label: 'Address Template', url: docsUrl + 'user/manual/en/setting-up/print/address-template' },\n]\n\nfrappe.help.help_links['List/Terms and Conditions'] = [\n\t{ label: 'Terms and Conditions', url: docsUrl + 'user/manual/en/setting-up/print/terms-and-conditions' },\n]\n\nfrappe.help.help_links['List/Cheque Print Template'] = [\n\t{ label: 'Cheque Print Template', url: docsUrl + 'user/manual/en/setting-up/print/cheque-print-template' },\n]\n\nfrappe.help.help_links['List/Email Account'] = [\n\t{ label: 'Email Account', url: docsUrl + 'user/manual/en/setting-up/email/email-account' },\n]\n\nfrappe.help.help_links['List/Notification'] = [\n\t{ label: 'Notification', url: docsUrl + 'user/manual/en/setting-up/email/notifications' },\n]\n\nfrappe.help.help_links['Form/Notification'] = [\n\t{ label: 'Notification', url: docsUrl + 'user/manual/en/setting-up/email/notifications' },\n]\n\nfrappe.help.help_links['List/Email Digest'] = [\n\t{ label: 'Email Digest', url: docsUrl + 'user/manual/en/setting-up/email/email-digest' },\n]\n\nfrappe.help.help_links['List/Auto Email Report'] = [\n\t{ label: 'Auto Email Reports', url: docsUrl + 'user/manual/en/setting-up/email/email-reports' },\n]\n\nfrappe.help.help_links['Form/Print Settings'] = [\n\t{ label: 'Print Settings', url: docsUrl + 'user/manual/en/setting-up/print/print-settings' },\n]\n\nfrappe.help.help_links['print-format-builder'] = [\n\t{ label: 'Print Format Builder', url: docsUrl + 'user/manual/en/setting-up/print/print-settings' },\n]\n\nfrappe.help.help_links['List/Print Heading'] = [\n\t{ label: 'Print Heading', url: docsUrl + 'user/manual/en/setting-up/print/print-headings' },\n]\n\n//setup-integrations\n\nfrappe.help.help_links['Form/PayPal Settings'] = [\n\t{ label: 'PayPal Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/paypal-integration' },\n]\n\nfrappe.help.help_links['Form/Razorpay Settings'] = [\n\t{ label: 'Razorpay Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/razorpay-integration' },\n]\n\nfrappe.help.help_links['Form/Dropbox Settings'] = [\n\t{ label: 'Dropbox Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/dropbox-backup' },\n]\n\nfrappe.help.help_links['Form/LDAP Settings'] = [\n\t{ label: 'LDAP Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/ldap-integration' },\n]\n\nfrappe.help.help_links['Form/Stripe Settings'] = [\n\t{ label: 'Stripe Settings', url: docsUrl + 'user/manual/en/setting-up/integrations/stripe-integration' },\n]\n\n//Sales\n\nfrappe.help.help_links['Form/Quotation'] = [\n\t{ label: 'Quotation', url: docsUrl + 'user/manual/en/selling/quotation' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/selling/articles/sales-persons-in-the-sales-transactions' },\n\t{ label: 'Applying Margin', url: docsUrl + 'user/manual/en/selling/articles/adding-margin' },\n]\n\nfrappe.help.help_links['List/Customer'] = [\n\t{ label: 'Customer', url: docsUrl + 'user/manual/en/CRM/customer' },\n\t{ label: 'Credit Limit', url: docsUrl + 'user/manual/en/accounts/credit-limit' },\n]\n\nfrappe.help.help_links['Form/Customer'] = [\n\t{ label: 'Customer', url: docsUrl + 'user/manual/en/CRM/customer' },\n\t{ label: 'Credit Limit', url: docsUrl + 'user/manual/en/accounts/credit-limit' },\n]\n\nfrappe.help.help_links['List/Sales Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['Form/Sales Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['List/Sales Order'] = [\n\t{ label: 'Sales Order', url: docsUrl + 'user/manual/en/selling/sales-order' },\n\t{ label: 'Recurring Sales Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n]\n\nfrappe.help.help_links['Form/Sales Order'] = [\n\t{ label: 'Sales Order', url: docsUrl + 'user/manual/en/selling/sales-order' },\n\t{ label: 'Recurring Sales Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Applying Discount', url: docsUrl + 'user/manual/en/selling/articles/applying-discount' },\n\t{ label: 'Drop Shipping', url: docsUrl + 'user/manual/en/selling/articles/drop-shipping' },\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/selling/articles/sales-persons-in-the-sales-transactions' },\n\t{ label: 'Close Sales Order', url: docsUrl + 'user/manual/en/selling/articles/close-sales-order' },\n\t{ label: 'Applying Margin', url: docsUrl + 'user/manual/en/selling/articles/adding-margin' },\n]\n\nfrappe.help.help_links['Form/Product Bundle'] = [\n\t{ label: 'Product Bundle', url: docsUrl + 'user/manual/en/selling/setup/product-bundle' },\n]\n\nfrappe.help.help_links['Form/Selling Settings'] = [\n\t{ label: 'Selling Settings', url: docsUrl + 'user/manual/en/selling/setup/selling-settings' },\n]\n\n//Buying\n\nfrappe.help.help_links['List/Supplier'] = [\n\t{ label: 'Supplier', url: docsUrl + 'user/manual/en/buying/supplier' },\n]\n\nfrappe.help.help_links['Form/Supplier'] = [\n\t{ label: 'Supplier', url: docsUrl + 'user/manual/en/buying/supplier' },\n]\n\nfrappe.help.help_links['Form/Request for Quotation'] = [\n\t{ label: 'Request for Quotation', url: docsUrl + 'user/manual/en/buying/request-for-quotation' },\n\t{ label: 'RFQ Video', url: docsUrl + 'user/videos/learn/request-for-quotation.html' },\n]\n\nfrappe.help.help_links['Form/Supplier Quotation'] = [\n\t{ label: 'Supplier Quotation', url: docsUrl + 'user/manual/en/buying/supplier-quotation' },\n]\n\nfrappe.help.help_links['Form/Buying Settings'] = [\n\t{ label: 'Buying Settings', url: docsUrl + 'user/manual/en/buying/setup/buying-settings' },\n]\n\nfrappe.help.help_links['List/Purchase Order'] = [\n\t{ label: 'Purchase Order', url: docsUrl + 'user/manual/en/buying/purchase-order' },\n\t{ label: 'Recurring Purchase Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['Form/Purchase Order'] = [\n\t{ label: 'Purchase Order', url: docsUrl + 'user/manual/en/buying/purchase-order' },\n\t{ label: 'Item UoM', url: docsUrl + 'user/manual/en/buying/articles/purchasing-in-different-unit' },\n\t{ label: 'Supplier Item Code', url: docsUrl + 'user/manual/en/buying/articles/maintaining-suppliers-part-no-in-item' },\n\t{ label: 'Recurring Purchase Order', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Purchase Taxes and Charges Template'] = [\n\t{ label: 'Setting Up Taxes', url: docsUrl + 'user/manual/en/setting-up/setting-up-taxes' },\n]\n\nfrappe.help.help_links['List/POS Profile'] = [\n\t{ label: 'POS Profile', url: docsUrl + 'user/manual/en/setting-up/pos-setting' },\n]\n\nfrappe.help.help_links['List/Price List'] = [\n\t{ label: 'Price List', url: docsUrl + 'user/manual/en/setting-up/price-lists' },\n]\n\nfrappe.help.help_links['List/Authorization Rule'] = [\n\t{ label: 'Authorization Rule', url: docsUrl + 'user/manual/en/setting-up/authorization-rule' },\n]\n\nfrappe.help.help_links['Form/SMS Settings'] = [\n\t{ label: 'SMS Settings', url: docsUrl + 'user/manual/en/setting-up/sms-setting' },\n]\n\nfrappe.help.help_links['List/Stock Reconciliation'] = [\n\t{ label: 'Stock Reconciliation', url: docsUrl + 'user/manual/en/setting-up/stock-reconciliation-for-non-serialized-item' },\n]\n\nfrappe.help.help_links['Tree/Territory'] = [\n\t{ label: 'Territory', url: docsUrl + 'user/manual/en/setting-up/territory' },\n]\n\nfrappe.help.help_links['Form/Dropbox Backup'] = [\n\t{ label: 'Dropbox Backup', url: docsUrl + 'user/manual/en/setting-up/third-party-backups' },\n\t{ label: 'Setting Up Dropbox Backup', url: docsUrl + 'user/manual/en/setting-up/articles/setting-up-dropbox-backups' },\n]\n\nfrappe.help.help_links['List/Workflow'] = [\n\t{ label: 'Workflow', url: docsUrl + 'user/manual/en/setting-up/workflows' },\n]\n\nfrappe.help.help_links['List/Company'] = [\n\t{ label: 'Company', url: docsUrl + 'user/manual/en/setting-up/company-setup' },\n\t{ label: 'Managing Multiple Companies', url: docsUrl + 'user/manual/en/setting-up/articles/managing-multiple-companies' },\n\t{ label: 'Delete All Related Transactions for a Company', url: docsUrl + 'user/manual/en/setting-up/articles/delete-a-company-and-all-related-transactions' },\n]\n\n//Accounts\n\nfrappe.help.help_links['modules/Accounts'] = [\n\t{ label: 'Introduction to Accounts', url: docsUrl + 'user/manual/en/accounts/' },\n\t{ label: 'Chart of Accounts', url: docsUrl + 'user/manual/en/accounts/chart-of-accounts.html' },\n\t{ label: 'Multi Currency Accounting', url: docsUrl + 'user/manual/en/accounts/multi-currency-accounting' },\n]\n\nfrappe.help.help_links['Tree/Account'] = [\n\t{ label: 'Chart of Accounts', url: docsUrl + 'user/manual/en/accounts/chart-of-accounts' },\n\t{ label: 'Managing Tree Mastes', url: docsUrl + 'user/manual/en/setting-up/articles/managing-tree-structure-masters' },\n]\n\nfrappe.help.help_links['Form/Sales Invoice'] = [\n\t{ label: 'Sales Invoice', url: docsUrl + 'user/manual/en/accounts/sales-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Recurring Sales Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['List/Sales Invoice'] = [\n\t{ label: 'Sales Invoice', url: docsUrl + 'user/manual/en/accounts/sales-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Recurring Sales Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['pos'] = [\n\t{ label: 'Point of Sale Invoice', url: docsUrl + 'user/manual/en/accounts/point-of-sale-pos-invoice' },\n]\n\nfrappe.help.help_links['List/POS Profile'] = [\n\t{ label: 'Point of Sale Profile', url: docsUrl + 'user/manual/en/setting-up/pos-setting' },\n]\n\nfrappe.help.help_links['List/Purchase Invoice'] = [\n\t{ label: 'Purchase Invoice', url: docsUrl + 'user/manual/en/accounts/purchase-invoice' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n\t{ label: 'Recurring Purchase Invoice', url: docsUrl + 'user/manual/en/accounts/recurring-orders-and-invoices' },\n]\n\nfrappe.help.help_links['List/Journal Entry'] = [\n\t{ label: 'Journal Entry', url: docsUrl + 'user/manual/en/accounts/journal-entry' },\n\t{ label: 'Advance Payment Entry', url: docsUrl + 'user/manual/en/accounts/advance-payment-entry' },\n\t{ label: 'Accounts Opening Balance', url: docsUrl + 'user/manual/en/accounts/opening-accounts' },\n]\n\nfrappe.help.help_links['List/Payment Entry'] = [\n\t{ label: 'Payment Entry', url: docsUrl + 'user/manual/en/accounts/payment-entry' },\n]\n\nfrappe.help.help_links['List/Payment Request'] = [\n\t{ label: 'Payment Request', url: docsUrl + 'user/manual/en/accounts/payment-request' },\n]\n\nfrappe.help.help_links['List/Asset'] = [\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n]\n\nfrappe.help.help_links['List/Asset Category'] = [\n\t{ label: 'Asset Category', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n]\n\nfrappe.help.help_links['Tree/Cost Center'] = [\n\t{ label: 'Budgeting', url: docsUrl + 'user/manual/en/accounts/budgeting' },\n]\n\nfrappe.help.help_links['List/Item'] = [\n\t{ label: 'Item', url: docsUrl + 'user/manual/en/stock/item' },\n\t{ label: 'Item Price', url: docsUrl + 'user/manual/en/stock/item/item-price' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Item Wise Taxation', url: docsUrl + 'user/manual/en/accounts/item-wise-taxation' },\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n\t{ label: 'Item Codification', url: docsUrl + 'user/manual/en/stock/item/item-codification' },\n\t{ label: 'Item Variants', url: docsUrl + 'user/manual/en/stock/item/item-variants' },\n\t{ label: 'Item Valuation', url: docsUrl + 'user/manual/en/stock/item/item-valuation-fifo-and-moving-average' },\n]\n\nfrappe.help.help_links['Form/Item'] = [\n\t{ label: 'Item', url: docsUrl + 'user/manual/en/stock/item' },\n\t{ label: 'Item Price', url: docsUrl + 'user/manual/en/stock/item/item-price' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Item Wise Taxation', url: docsUrl + 'user/manual/en/accounts/item-wise-taxation' },\n\t{ label: 'Managing Fixed Assets', url: docsUrl + 'user/manual/en/accounts/managing-fixed-assets' },\n\t{ label: 'Item Codification', url: docsUrl + 'user/manual/en/stock/item/item-codification' },\n\t{ label: 'Item Variants', url: docsUrl + 'user/manual/en/stock/item/item-variants' },\n\t{ label: 'Item Valuation', url: docsUrl + 'user/manual/en/stock/item/item-valuation-fifo-and-moving-average' },\n]\n\nfrappe.help.help_links['List/Purchase Receipt'] = [\n\t{ label: 'Purchase Receipt', url: docsUrl + 'user/manual/en/stock/purchase-receipt' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n]\n\nfrappe.help.help_links['List/Delivery Note'] = [\n\t{ label: 'Delivery Note', url: docsUrl + 'user/manual/en/stock/delivery-note' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n]\n\nfrappe.help.help_links['Form/Delivery Note'] = [\n\t{ label: 'Delivery Note', url: docsUrl + 'user/manual/en/stock/delivery-note' },\n\t{ label: 'Sales Return', url: docsUrl + 'user/manual/en/stock/sales-return' },\n\t{ label: 'Barcode', url: docsUrl + 'user/manual/en/stock/articles/track-items-using-barcode' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Installation Note'] = [\n\t{ label: 'Installation Note', url: docsUrl + 'user/manual/en/stock/installation-note' },\n]\n\n\nfrappe.help.help_links['Tree'] = [\n\t{ label: 'Managing Tree Structure Masters', url: docsUrl + 'user/manual/en/setting-up/articles/managing-tree-structure-masters' },\n]\n\nfrappe.help.help_links['List/Budget'] = [\n\t{ label: 'Budgeting', url: docsUrl + 'user/manual/en/accounts/budgeting' },\n]\n\n//Stock\n\nfrappe.help.help_links['List/Material Request'] = [\n\t{ label: 'Material Request', url: docsUrl + 'user/manual/en/stock/material-request' },\n\t{ label: 'Auto-creation of Material Request', url: docsUrl + 'user/manual/en/stock/articles/auto-creation-of-material-request' },\n]\n\nfrappe.help.help_links['Form/Material Request'] = [\n\t{ label: 'Material Request', url: docsUrl + 'user/manual/en/stock/material-request' },\n\t{ label: 'Auto-creation of Material Request', url: docsUrl + 'user/manual/en/stock/articles/auto-creation-of-material-request' },\n]\n\nfrappe.help.help_links['Form/Stock Entry'] = [\n\t{ label: 'Stock Entry', url: docsUrl + 'user/manual/en/stock/stock-entry' },\n\t{ label: 'Stock Entry Types', url: docsUrl + 'user/manual/en/stock/articles/stock-entry-purpose' },\n\t{ label: 'Repack Entry', url: docsUrl + 'user/manual/en/stock/articles/repack-entry' },\n\t{ label: 'Opening Stock', url: docsUrl + 'user/manual/en/stock/opening-stock' },\n\t{ label: 'Subcontracting', url: docsUrl + 'user/manual/en/manufacturing/subcontracting' },\n]\n\nfrappe.help.help_links['List/Stock Entry'] = [\n\t{ label: 'Stock Entry', url: docsUrl + 'user/manual/en/stock/stock-entry' },\n]\n\nfrappe.help.help_links['Tree/Warehouse'] = [\n\t{ label: 'Warehouse', url: docsUrl + 'user/manual/en/stock/warehouse' },\n]\n\nfrappe.help.help_links['List/Serial No'] = [\n\t{ label: 'Serial No', url: docsUrl + 'user/manual/en/stock/serial-no' },\n]\n\nfrappe.help.help_links['Form/Serial No'] = [\n\t{ label: 'Serial No', url: docsUrl + 'user/manual/en/stock/serial-no' },\n]\n\nfrappe.help.help_links['Form/Batch'] = [\n\t{ label: 'Batch', url: docsUrl + 'user/manual/en/stock/batch' },\n]\n\nfrappe.help.help_links['Form/Packing Slip'] = [\n\t{ label: 'Packing Slip', url: docsUrl + 'user/manual/en/stock/tools/packing-slip' },\n]\n\nfrappe.help.help_links['Form/Quality Inspection'] = [\n\t{ label: 'Quality Inspection', url: docsUrl + 'user/manual/en/stock/tools/quality-inspection' },\n]\n\nfrappe.help.help_links['Form/Landed Cost Voucher'] = [\n\t{ label: 'Landed Cost Voucher', url: docsUrl + 'user/manual/en/stock/tools/landed-cost-voucher' },\n]\n\nfrappe.help.help_links['Tree/Item Group'] = [\n\t{ label: 'Item Group', url: docsUrl + 'user/manual/en/stock/setup/item-group' },\n]\n\nfrappe.help.help_links['Form/Item Attribute'] = [\n\t{ label: 'Item Attribute', url: docsUrl + 'user/manual/en/stock/setup/item-attribute' },\n]\n\nfrappe.help.help_links['Form/UOM'] = [\n\t{ label: 'Fractions in UOM', url: docsUrl + 'user/manual/en/stock/articles/managing-fractions-in-uom' },\n]\n\nfrappe.help.help_links['Form/Stock Reconciliation'] = [\n\t{ label: 'Opening Stock Entry', url: docsUrl + 'user/manual/en/stock/opening-stock' },\n]\n\n//CRM\n\nfrappe.help.help_links['Form/Lead'] = [\n\t{ label: 'Lead', url: docsUrl + 'user/manual/en/CRM/lead' },\n]\n\nfrappe.help.help_links['Form/Opportunity'] = [\n\t{ label: 'Opportunity', url: docsUrl + 'user/manual/en/CRM/opportunity' },\n]\n\nfrappe.help.help_links['Form/Address'] = [\n\t{ label: 'Address', url: docsUrl + 'user/manual/en/CRM/address' },\n]\n\nfrappe.help.help_links['Form/Contact'] = [\n\t{ label: 'Contact', url: docsUrl + 'user/manual/en/CRM/contact' },\n]\n\nfrappe.help.help_links['Form/Newsletter'] = [\n\t{ label: 'Newsletter', url: docsUrl + 'user/manual/en/CRM/newsletter' },\n]\n\nfrappe.help.help_links['Form/Campaign'] = [\n\t{ label: 'Campaign', url: docsUrl + 'user/manual/en/CRM/setup/campaign' },\n]\n\nfrappe.help.help_links['Tree/Sales Person'] = [\n\t{ label: 'Sales Person', url: docsUrl + 'user/manual/en/CRM/setup/sales-person' },\n]\n\nfrappe.help.help_links['Form/Sales Person'] = [\n\t{ label: 'Sales Person Target', url: docsUrl + 'user/manual/en/selling/setup/sales-person-target-allocation' },\n]\n\n//Support\n\nfrappe.help.help_links['List/Feedback Trigger'] = [\n\t{ label: 'Feedback Trigger', url: docsUrl + 'user/manual/en/setting-up/feedback/setting-up-feedback' },\n]\n\nfrappe.help.help_links['List/Feedback Request'] = [\n\t{ label: 'Feedback Request', url: docsUrl + 'user/manual/en/setting-up/feedback/submit-feedback' },\n]\n\nfrappe.help.help_links['List/Feedback Request'] = [\n\t{ label: 'Feedback Request', url: docsUrl + 'user/manual/en/setting-up/feedback/submit-feedback' },\n]\n\n//Manufacturing\n\nfrappe.help.help_links['Form/BOM'] = [\n\t{ label: 'Bill of Material', url: docsUrl + 'user/manual/en/manufacturing/bill-of-materials' },\n\t{ label: 'Nested BOM Structure', url: docsUrl + 'user/manual/en/manufacturing/articles/nested-bom-structure' },\n]\n\nfrappe.help.help_links['Form/Work Order'] = [\n\t{ label: 'Work Order', url: docsUrl + 'user/manual/en/manufacturing/work-order' },\n]\n\nfrappe.help.help_links['Form/Workstation'] = [\n\t{ label: 'Workstation', url: docsUrl + 'user/manual/en/manufacturing/workstation' },\n]\n\nfrappe.help.help_links['Form/Operation'] = [\n\t{ label: 'Operation', url: docsUrl + 'user/manual/en/manufacturing/operation' },\n]\n\nfrappe.help.help_links['Form/BOM Update Tool'] = [\n\t{ label: 'BOM Update Tool', url: docsUrl + 'user/manual/en/manufacturing/tools/bom-update-tool' },\n]\n\n//Customize\n\nfrappe.help.help_links['Form/Customize Form'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n\t{ label: 'Customize Field', url: docsUrl + 'user/manual/en/customize-erpnext/customize-form' },\n]\n\nfrappe.help.help_links['Form/Custom Field'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n]\n\nfrappe.help.help_links['Form/Custom Field'] = [\n\t{ label: 'Custom Field', url: docsUrl + 'user/manual/en/customize-erpnext/custom-field' },\n]\n","frappe.provide('agriculture');\n\nagriculture.TernaryPlot = class TernaryPlot {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\n\t\tfrappe.require('assets/frappe/js/lib/snap.svg-min.js', () => {\n\t\t\tthis.make_svg();\n\t\t\tthis.init_snap();\n\t\t\tthis.init_config();\n\t\t\tthis.make_plot();\n\t\t\tthis.make_plot_marking();\n\t\t\tthis.make_legend();\n\t\t\tthis.mark_blip();\n\t\t});\n\t}\n\n\tmake_svg() {\n\t\tthis.$svg = $('<svg height=\"350\" width=\"400\">');\n\t\t$(this.parent).append(this.$svg);\n\t}\n\n\tinit_snap() {\n\t\tthis.paper = new Snap(this.$svg.get(0));\n\t}\n\n\tinit_config() {\n\t\tthis.config = {\n\t\t\ttriangle_side: 300,\n\t\t\tspacing: 50,\n\t\t\tstrokeWidth: 1,\n\t\t\tstroke: frappe.ui.color.get('black')\n\t\t};\n\t\tthis.config.scaling_factor = this.config.triangle_side / 100;\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tthis.coords = {\n\t\t\tsand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('peach')\n\t\t\t},\n\t\t\tloamy_sand: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + 10 * p * Snap.cos(60), s + (100 - 10) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 85) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 70) * p, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink')\n\t\t\t},\n\t\t\tsandy_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 15 * p * Snap.cos(60), s + (100 - 15) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 75) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'light')\n\t\t\t},\n\t\t\tloam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60) - 22.5 * p, s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60) - 10 * p, s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 7.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 7.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('brown')\n\t\t\t},\n\t\t\tsilt_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p + 27.5 * p * Snap.cos(60), s + t * Snap.cos(30) - 27.5 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 50) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'dark')\n\t\t\t},\n\t\t\tsilt: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 12.5 * p * Snap.cos(60), s + (100 - 12.5) * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p + 12.5 * p * Snap.cos(60), s + 90 * p * Snap.cos(30),\n\t\t\t\t\ts + (100 - 20) * p, s + t * Snap.cos(30),\n\t\t\t\t\ts + t, s + t * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green')\n\t\t\t},\n\t\t\tsilty_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60), s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan', 'dark')\n\t\t\t},\n\t\t\tsilty_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60), s + 60 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('cyan')\n\t\t\t},\n\t\t\tclay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 20 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('green', 'light')\n\t\t\t},\n\t\t\tsandy_clay_loam: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60), s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + 20 * p * Snap.cos(60) + 27.5 * p, s + (100 - 20) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 27.5 * p * Snap.cos(60) - 45 * p, s + 72.5 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('pink', 'dark')\n\t\t\t},\n\t\t\tsandy_clay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60), s + (100 - 35) * p * Snap.cos(30),\n\t\t\t\t\ts + 35 * p * Snap.cos(60) + 20 * p, s + (100 - 35) * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('red')\n\t\t\t},\n\t\t\tclay: {\n\t\t\t\tpoints: [\n\t\t\t\t\ts + t * Snap.cos(60), s,\n\t\t\t\t\ts + 55 * p * Snap.cos(60), s + (100 - 55) * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 45 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 40 * p * Snap.cos(60) - 20 * p, s + 60 * p * Snap.cos(30),\n\t\t\t\t\ts + t - 60 * p * Snap.cos(60), s + 40 * p * Snap.cos(30)\n\t\t\t\t],\n\t\t\t\tcolor: frappe.ui.color.get('yellow')\n\t\t\t},\n\t\t};\n\t}\n\n\tget_coords(soil_type) {\n\t\treturn this.coords[soil_type].points;\n\t}\n\n\tget_color(soil_type) {\n\t\treturn this.coords[soil_type].color;\n\t}\n\n\tmake_plot() {\n\t\tfor (let soil_type in this.coords) {\n\t\t\tthis.paper.polygon(this.get_coords(soil_type)).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: this.config.stroke,\n\t\t\t\tstrokeWidth: this.config.strokeWidth\n\t\t\t});\n\t\t}\n\t}\n\n\tmake_plot_marking() {\n\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\tlet clay = this.paper.text(t * Snap.cos(60) / 2, s + t * Snap.cos(30) / 2, __(\"Clay\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tclay.transform(\"r300\");\n\n\t\tlet silt = this.paper.text(t, s + t * Snap.cos(30) / 2, __(\"Silt\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsilt.transform(\"r60\");\n\n\t\tlet sand = this.paper.text(35 + t * Snap.cos(60), 90 + t * Snap.cos(30), __(\"Sand\")).attr({\n\t\t\tfill: frappe.ui.color.get('black')\n\t\t});\n\t\tsand.transform(\"r0\");\n\t}\n\n\tmake_legend() {\n\t\t// let side = len(this.coords)/2;\n\t\tlet index = 1;\n\t\tlet offset = 0;\n\t\tlet exec_once = true;\n\t\tfor (let soil_type in this.coords) {\n\t\t\tif (index > 6 && exec_once){\n\t\t\t\toffset = 300;\n\t\t\t\tindex = 1;\n\t\t\t\texec_once = false;\n\t\t\t}\n\t\t\tlet rect = this.paper.rect(0+offset, 0+index*20, 100, 19, 5, 5).attr({\n\t\t\t\tfill: this.get_color(soil_type),\n\t\t\t\tstroke: frappe.ui.color.get('black')\n\t\t\t});\n\t\t\tlet text = this.paper.text(5+offset, 16+index*20, soil_type).attr({\n\t\t\t\tfill: frappe.ui.color.get('black'),\n\t\t\t\t'font-size': 12\n\t\t\t});\n\t\t\tindex++;\n\t\t}\n\t}\n\n\tmark_blip({clay, sand, silt} = this) {\n\t\tif (clay + sand + silt != 0){\n\t\t\tlet { triangle_side: t, spacing: s, scaling_factor: p } = this.config;\n\n\t\t\tlet x_blip = s + clay * p * Snap.cos(60) + silt * p;\n\t\t\tlet y_blip = s + silt * p * Snap.cos(30) + sand * p * Snap.sin(60);\n\t\t\tthis.blip = this.paper.circle(x_blip, y_blip, 4).attr({\n\t\t\t\tfill: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstroke: frappe.ui.color.get(\"orange\"),\n\t\t\t\tstrokeWidth: 2\n\t\t\t});\n\t\t}\n\t}\n\n\tremove_blip() {\n\t\tif (typeof this.blip !== 'undefined')\n\t\t\tthis.blip.remove();\n\t}\n};\n","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.ItemQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.get_variant_fields().concat(this.mandatory);\n\t\tthis.mandatory = this.mandatory.concat(this.get_attributes_fields());\n\t\tthis.check_naming_series_based_on();\n\t\tthis._super();\n\t\tthis.init_post_render_dialog_operations();\n\t\tthis.preset_fields_for_template();\n\t\tthis.dialog.$wrapper.find('.edit-full').text(__('Edit in full page for more options like assets, serial nos, batches etc.'))\n\t},\n\n\tcheck_naming_series_based_on: function() {\n\t\tif (frappe.defaults.get_default(\"item_naming_by\") === \"Naming Series\") {\n\t\t\tthis.mandatory = this.mandatory.filter(d => d.fieldname !== \"item_code\");\n\t\t}\n\t},\n\n\tinit_post_render_dialog_operations: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.append(frappe.render_template(\"item_quick_entry\"));\n\t\tthis.init_for_create_variant_trigger();\n\t\tthis.init_for_item_template_trigger();\n\t\t// explicitly hide manufacturing fields as hidden not working.\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.get_field(\"item_template\").df.hidden = 1;\n\t\tthis.dialog.get_field(\"item_template\").refresh();\n\t},\n\n\tregister_primary_action: function() {\n\t\tvar me = this;\n\t\tthis.dialog.set_primary_action(__('Save'), function() {\n\t\t\tif (me.dialog.working) return;\n\n\t\t\tvar data = me.dialog.get_values();\n\t\t\tvar variant_values = {};\n\n\t\t\tif (me.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\t\tvariant_values = me.get_variant_doc();\n\t\t\t\tif (!Object.keys(variant_values).length) {\n\t\t\t\t\tdata = null;\n\t\t\t\t}\n\t\t\t\tvariant_values.stock_uom = me.template_doc.stock_uom;\n\t\t\t\tvariant_values.item_group = me.template_doc.item_group;\n\t\t\t}\n\n\t\t\tif (data) {\n\t\t\t\tme.dialog.working = true;\n\t\t\t\tvar values = me.update_doc();\n\t\t\t\t//patch for manufacturer type variants as extend is overwriting it.\n\t\t\t\tif (variant_values['variant_based_on'] == \"Manufacturer\") {\n\t\t\t\t\tvalues['variant_based_on'] = \"Manufacturer\";\n\t\t\t\t}\n\t\t\t\t$.extend(variant_values, values);\n\t\t\t\tme.insert(variant_values);\n\t\t\t}\n\t\t});\n\t},\n\n\tinsert: function(variant_values) {\n\t\tlet me = this;\n\t\treturn new Promise(resolve => {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.insert\",\n\t\t\t\targs: {\n\t\t\t\t\tdoc: variant_values\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t// delete the old doc\n\t\t\t\t\tfrappe.model.clear_doc(me.dialog.doc.doctype, me.dialog.doc.name);\n\t\t\t\t\tme.dialog.doc = r.message;\n\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\tfrappe.ui.form.update_calling_link(me.dialog.doc);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (me.after_insert) {\n\t\t\t\t\t\t\tme.after_insert(me.dialog.doc);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tme.open_form_if_not_list();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function() {\n\t\t\t\t\tme.open_doc();\n\t\t\t\t},\n\t\t\t\talways: function() {\n\t\t\t\t\tme.dialog.working = false;\n\t\t\t\t\tresolve(me.dialog.doc);\n\t\t\t\t},\n\t\t\t\tfreeze: true\n\t\t\t});\n\t\t});\n\t},\n\n\topen_doc: function() {\n\t\tthis.dialog.hide();\n\t\tthis.update_doc();\n\t\tif (this.dialog.fields_dict.create_variant.$input.prop(\"checked\")) {\n\t\t\tvar template = this.dialog.fields_dict.item_template.input.value;\n\t\t\tif (template)\n\t\t\t\tfrappe.set_route(\"Form\", this.doctype, template);\n\t\t} else {\n\t\t\tfrappe.set_route('Form', this.doctype, this.doc.name);\n\t\t}\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldname: \"create_variant\",\n\t\t\tfieldtype: \"Check\",\n\t\t\tlabel: __(\"Create Variant\")\n\t\t},\n\t\t{\n\t\t\tfieldname: 'item_template',\n\t\t\tlabel: __('Item Template'),\n\t\t\treqd: 0,\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: \"Item\",\n\t\t\tget_query: function() {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\"has_variants\": 1\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n\n\tget_manufacturing_fields: function() {\n\t\tthis.manufacturer_fields = [{\n\t\t\tfieldtype: 'Link',\n\t\t\toptions: 'Manufacturer',\n\t\t\tlabel: 'Manufacturer',\n\t\t\tfieldname: \"manufacturer\",\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}, {\n\t\t\tfieldtype: 'Data',\n\t\t\tlabel: 'Manufacturer Part Number',\n\t\t\tfieldname: 'manufacturer_part_no',\n\t\t\thidden: 1,\n\t\t\treqd: 0\n\t\t}];\n\t\treturn this.manufacturer_fields;\n\t},\n\n\tget_attributes_fields: function() {\n\t\tvar attribute_fields = [{\n\t\t\tfieldname: 'attribute_html',\n\t\t\tfieldtype: 'HTML'\n\t\t}]\n\n\t\tattribute_fields = attribute_fields.concat(this.get_manufacturing_fields());\n\t\treturn attribute_fields;\n\t},\n\n\tinit_for_create_variant_trigger: function() {\n\t\tvar me = this;\n\n\t\tthis.dialog.fields_dict.create_variant.$input.on(\"click\", function() {\n\t\t\tme.preset_fields_for_template();\n\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t});\n\t},\n\n\tpreset_fields_for_template: function() {\n\t\tvar for_variant = this.dialog.get_value('create_variant');\n\n\t\t// setup template field, seen and mandatory if variant\n\t\tlet template_field = this.dialog.get_field(\"item_template\");\n\t\ttemplate_field.df.reqd = for_variant;\n\t\ttemplate_field.set_value('');\n\t\ttemplate_field.df.hidden = !for_variant;\n\t\ttemplate_field.refresh();\n\n\t\t// hide properties for variant\n\t\t['item_code', 'item_name', 'item_group', 'stock_uom'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.hidden = for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t\tthis.dialog.get_field('attribute_html').toggle(false);\n\n\t\t// non mandatory for variants\n\t\t['item_code', 'stock_uom', 'item_group'].forEach((d) => {\n\t\t\tlet f = this.dialog.get_field(d);\n\t\t\tf.df.reqd = !for_variant;\n\t\t\tf.refresh();\n\t\t});\n\n\t},\n\n\tinit_for_item_template_trigger: function() {\n\t\tvar me = this;\n\n\t\tme.dialog.fields_dict[\"item_template\"].df.onchange = () => {\n\t\t\tvar template = me.dialog.fields_dict.item_template.input.value;\n\t\t\tme.template_doc = null;\n\t\t\tif (template) {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"frappe.client.get\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\t\tname: template\n\t\t\t\t\t},\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tme.template_doc = r.message;\n\t\t\t\t\t\tme.is_manufacturer = false;\n\n\t\t\t\t\t\tif (me.template_doc.variant_based_on === \"Manufacturer\") {\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(true, [], true);\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tme.init_post_template_trigger_operations(false, me.template_doc.attributes, false);\n\t\t\t\t\t\t\tme.render_attributes(me.template_doc.attributes);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tme.dialog.get_field('attribute_html').toggle(false);\n\t\t\t\tme.init_post_template_trigger_operations(false, [], true);\n\t\t\t}\n\t\t}\n\t},\n\n\tinit_post_template_trigger_operations: function(is_manufacturer, attributes, attributes_flag) {\n\t\tthis.attributes = attributes;\n\t\tthis.attribute_values = {};\n\t\tthis.attributes_count = attributes.length;\n\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.is_manufacturer = is_manufacturer;\n\t\tthis.toggle_manufacturer_fields();\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").toggleClass(\"hide-control\", attributes_flag);\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes-header\").toggleClass(\"hide-control\", attributes_flag);\n\t},\n\n\ttoggle_manufacturer_fields: function() {\n\t\tvar me = this;\n\t\t$.each(this.manufacturer_fields, function(i, dialog_field) {\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.hidden = !me.is_manufacturer;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).df.reqd = dialog_field.fieldname == 'manufacturer' ? me.is_manufacturer : false;\n\t\t\tme.dialog.get_field(dialog_field.fieldname).refresh();\n\t\t});\n\t},\n\n\tinitiate_render_attributes: function() {\n\t\tthis.dialog.fields_dict.attribute_html.$wrapper.find(\".attributes\").empty();\n\t\tthis.render_attributes(this.attributes);\n\t},\n\n\trender_attributes: function(attributes) {\n\t\tvar me = this;\n\n\t\tthis.dialog.get_field('attribute_html').toggle(true);\n\n\t\t$.each(attributes, function(index, row) {\n\t\t\tvar desc = \"\";\n\t\t\tvar fieldtype = \"Data\";\n\t\t\tif (row.numeric_values) {\n\t\t\t\tfieldtype = \"Float\";\n\t\t\t\tdesc = \"Min Value: \" + row.from_range + \" , Max Value: \" + row.to_range + \", in Increments of: \" + row.increment;\n\t\t\t}\n\n\t\t\tme.init_make_control(fieldtype, row);\n\t\t\tme[row.attribute].set_value(me.attribute_values[row.attribute] || \"\");\n\t\t\tme[row.attribute].$wrapper.toggleClass(\"has-error\", me.attribute_values[row.attribute] ? false : true);\n\n\t\t\t// Set Label explicitly as make_control is not displaying label\n\t\t\t$(me[row.attribute].label_area).text(__(row.attribute));\n\n\t\t\tif (desc) {\n\t\t\t\t$(repl(`<p class=\"help-box small text-muted hidden-xs\">%(desc)s</p>`, {\n\t\t\t\t\t\"desc\": desc\n\t\t\t\t})).insertAfter(me[row.attribute].input_area);\n\t\t\t}\n\n\t\t\tif (!row.numeric_values) {\n\t\t\t\tme.init_awesomplete_for_attribute(row);\n\t\t\t} else {\n\t\t\t\tme[row.attribute].$input.on(\"change\", function() {\n\t\t\t\t\tme.attribute_values[row.attribute] = $(this).val();\n\t\t\t\t\t$(this).closest(\".frappe-control\").toggleClass(\"has-error\", $(this).val() ? false : true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tinit_make_control: function(fieldtype, row) {\n\t\tthis[row.attribute] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\t\"fieldtype\": fieldtype,\n\t\t\t\t\"label\": row.attribute,\n\t\t\t\t\"fieldname\": row.attribute,\n\t\t\t\t\"options\": row.options || \"\"\n\t\t\t},\n\t\t\tparent: $(this.dialog.fields_dict.attribute_html.wrapper).find(\".attributes\"),\n\t\t\tonly_input: false\n\t\t});\n\t\tthis[row.attribute].make_input();\n\t},\n\n\tinit_awesomplete_for_attribute: function(row) {\n\t\tvar me = this;\n\n\t\tthis[row.attribute].input.awesomplete = new Awesomplete(this[row.attribute].input, {\n\t\t\tminChars: 0,\n\t\t\tmaxItems: 99,\n\t\t\tautoFirst: true,\n\t\t\tlist: [],\n\t\t});\n\n\t\tthis[row.attribute].$input.on('input', function(e) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Item Attribute Value\",\n\t\t\t\t\tfilters: [\n\t\t\t\t\t\t[\"parent\", \"=\", $(e.target).attr(\"data-fieldname\")],\n\t\t\t\t\t\t[\"attribute_value\", \"like\", e.target.value + \"%\"]\n\t\t\t\t\t],\n\t\t\t\t\tfields: [\"attribute_value\"],\n\t\t\t\t\tparent: \"Item Attribute\"\n\t\t\t\t},\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\te.target.awesomplete.list = r.message.map(function(d) {\n\t\t\t\t\t\t\treturn d.attribute_value;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}).on('focus', function(e) {\n\t\t\t$(e.target).val('').trigger('input');\n\t\t}).on(\"awesomplete-close\", function (e) {\n\t\t\tme.attribute_values[$(e.target).attr(\"data-fieldname\")] = e.target.value;\n\t\t\t$(e.target).closest(\".frappe-control\").toggleClass(\"has-error\", e.target.value ? false : true);\n\t\t});\n\t},\n\n\tget_variant_doc: function() {\n\t\tvar me = this;\n\t\tvar variant_doc = {};\n\t\tvar attribute = this.validate_mandatory_attributes();\n\n\t\tif (Object.keys(attribute).length) {\n\t\t\tfrappe.call({\n\t\t\t\tmethod: \"erpnext.controllers.item_variant.create_variant_doc_for_quick_entry\",\n\t\t\t\targs: {\n\t\t\t\t\t\"template\": me.dialog.fields_dict.item_template.$input.val(),\n\t\t\t\t\targs: attribute\n\t\t\t\t},\n\t\t\t\tasync: false,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tif (Object.prototype.toString.call(r.message) == \"[object Object]\") {\n\t\t\t\t\t\tvariant_doc = r.message;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar msgprint_dialog = frappe.msgprint(__(\"Item Variant {0} already exists with same attributes\", [repl('<a class=\"strong variant-click\" data-item-code=\"%(item)s\" \\\n\t\t\t\t\t\t\t\t>%(item)s</a>', {\n\t\t\t\t\t\t\t\titem: r.message\n\t\t\t\t\t\t\t})]));\n\n\t\t\t\t\t\tmsgprint_dialog.$wrapper.find(\".variant-click\").on(\"click\", function() {\n\t\t\t\t\t\t\tmsgprint_dialog.hide();\n\t\t\t\t\t\t\tme.dialog.hide();\n\t\t\t\t\t\t\tif (frappe._from_link) {\n\t\t\t\t\t\t\t\tfrappe._from_link.set_value($(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.set_route('Form', \"Item\", $(this).attr(\"data-item-code\"));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\treturn variant_doc;\n\t},\n\n\tvalidate_mandatory_attributes: function() {\n\t\tvar me = this;\n\t\tvar attribute = {};\n\t\tvar mandatory = [];\n\n\t\t$.each(this.attributes, function(index, attr) {\n\t\t\tvar value = me.attribute_values[attr.attribute] || \"\";\n\t\t\tif (value) {\n\t\t\t\tattribute[attr.attribute] = attr.numeric_values ? flt(value) : value;\n\t\t\t} else {\n\t\t\t\tmandatory.push(attr.attribute);\n\t\t\t}\n\t\t})\n\n\t\tif (this.is_manufacturer) {\n\t\t\t$.each(this.manufacturer_fields, function(index, field) {\n\t\t\t\tattribute[field.fieldname] = me.dialog.fields_dict[field.fieldname].input.value;\n\t\t\t});\n\t\t}\n\t\treturn attribute;\n\t}\n});","frappe.provide('frappe.ui.form');\n\nfrappe.ui.form.CustomerQuickEntryForm = frappe.ui.form.QuickEntryForm.extend({\n\tinit: function(doctype, after_insert) {\n\t\tthis.skip_redirect_on_error = true;\n\t\tthis._super(doctype, after_insert);\n\t},\n\n\trender_dialog: function() {\n\t\tthis.mandatory = this.mandatory.concat(this.get_variant_fields());\n\t\tthis._super();\n\t},\n\n\tget_variant_fields: function() {\n\t\tvar variant_fields = [{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Contact Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Email Id\"),\n\t\t\tfieldname: \"email_id\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Mobile Number\"),\n\t\t\tfieldname: \"mobile_no\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Section Break\",\n\t\t\tlabel: __(\"Primary Address Details\"),\n\t\t\tcollapsible: 1\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 1\"),\n\t\t\tfieldname: \"address_line1\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Address Line 2\"),\n\t\t\tfieldname: \"address_line2\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"ZIP Code\"),\n\t\t\tfieldname: \"pincode\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tfieldtype: \"Column Break\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"City\"),\n\t\t\tfieldname: \"city\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"State\"),\n\t\t\tfieldname: \"state\",\n\t\t\tfieldtype: \"Data\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Country\"),\n\t\t\tfieldname: \"country\",\n\t\t\tfieldtype: \"Link\",\n\t\t\toptions: \"Country\"\n\t\t},\n\t\t{\n\t\t\tlabel: __(\"Customer POS Id\"),\n\t\t\tfieldname: \"customer_pos_id\",\n\t\t\tfieldtype: \"Data\",\n\t\t\thidden: 1\n\t\t}];\n\n\t\treturn variant_fields;\n\t},\n})","frappe.provide('erpnext.hub');\n\nfrappe.views.MarketplaceFactory = class MarketplaceFactory extends frappe.views.Factory {\n\tshow() {\n\t\tis_marketplace_disabled()\n\t\t\t.then(disabled => {\n\t\t\t\tif (disabled) {\n\t\t\t\t\tfrappe.show_not_found('Marketplace');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (frappe.pages.marketplace) {\n\t\t\t\t\tfrappe.container.change_to('marketplace');\n\t\t\t\t\terpnext.hub.marketplace.refresh();\n\t\t\t\t} else {\n\t\t\t\t\tthis.make('marketplace');\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tmake(page_name) {\n\t\tconst assets = [\n\t\t\t'/assets/js/marketplace.min.js'\n\t\t];\n\n\t\tfrappe.require(assets, () => {\n\t\t\terpnext.hub.marketplace = new erpnext.hub.Marketplace({\n\t\t\t\tparent: this.make_page(true, page_name)\n\t\t\t});\n\t\t});\n\t}\n};\n\nfunction is_marketplace_disabled() {\n\treturn frappe.call({\n\t\tmethod: \"erpnext.hub_node.doctype.marketplace_settings.marketplace_settings.is_marketplace_enabled\"\n\t}).then(r => r.message)\n}\n","class CallPopup {\n\tconstructor(call_log) {\n\t\tthis.caller_number = call_log.from;\n\t\tthis.call_log = call_log;\n\t\tthis.setup_listener();\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.dialog = new frappe.ui.Dialog({\n\t\t\t'static': true,\n\t\t\t'minimizable': true,\n\t\t\t'fields': [{\n\t\t\t\t'fieldname': 'name',\n\t\t\t\t'label': 'Name',\n\t\t\t\t'default': this.get_caller_name() || __('Unknown Caller'),\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Open Contact'),\n\t\t\t\t'click': () => frappe.set_route('Form', 'Contact', this.call_log.contact),\n\t\t\t\t'depends_on': () => this.call_log.contact\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Open Lead'),\n\t\t\t\t'click': () => frappe.set_route('Form', 'Lead', this.call_log.lead),\n\t\t\t\t'depends_on': () => this.call_log.lead\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Contact'),\n\t\t\t\t'click': () => frappe.new_doc('Contact', { 'mobile_no': this.caller_number }),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Create New Lead'),\n\t\t\t\t'click': () => frappe.new_doc('Lead', { 'mobile_no': this.caller_number }),\n\t\t\t\t'depends_on': () => !this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Column Break',\n\t\t\t}, {\n\t\t\t\t'fieldname': 'number',\n\t\t\t\t'label': 'Phone Number',\n\t\t\t\t'fieldtype': 'Data',\n\t\t\t\t'default': this.caller_number,\n\t\t\t\t'read_only': 1\n\t\t\t}, {\n\t\t\t\t'fielname': 'last_interaction',\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t\t'label': __('Activity'),\n\t\t\t\t'depends_on': () => this.get_caller_name()\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Last Issue'),\n\t\t\t\t'fieldname': 'last_issue',\n\t\t\t\t'read_only': true,\n\t\t\t\t'depends_on': () => this.call_log.contact,\n\t\t\t\t'default': `<i class=\"text-muted\">${__('No issue has been raised by the caller.')}<i>`\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Last Communication'),\n\t\t\t\t'fieldname': 'last_communication',\n\t\t\t\t'read_only': true,\n\t\t\t\t'default': `<i class=\"text-muted\">${__('No communication found.')}<i>`\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Section Break',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Small Text',\n\t\t\t\t'label': __('Call Summary'),\n\t\t\t\t'fieldname': 'call_summary',\n\t\t\t}, {\n\t\t\t\t'fieldtype': 'Button',\n\t\t\t\t'label': __('Save'),\n\t\t\t\t'click': () => {\n\t\t\t\t\tconst call_summary = this.dialog.get_value('call_summary');\n\t\t\t\t\tif (!call_summary) return;\n\t\t\t\t\tfrappe.xcall('erpnext.communication.doctype.call_log.call_log.add_call_summary', {\n\t\t\t\t\t\t'call_log': this.call_log.name,\n\t\t\t\t\t\t'summary': call_summary,\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tthis.close_modal();\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: `\n\t\t\t\t\t\t\t\t${__('Call Summary Saved')}\n\t\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\tclass=\"text-small text-muted\"\n\t\t\t\t\t\t\t\t\thref=\"#Form/Call Log/${this.call_log.name}\">\n\t\t\t\t\t\t\t\t\t${__('View call log')}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}],\n\t\t});\n\t\tthis.set_call_status();\n\t\tthis.dialog.get_close_btn().show();\n\t\tthis.make_last_interaction_section();\n\t\tthis.dialog.$body.addClass('call-popup');\n\t\tthis.dialog.set_secondary_action(this.close_modal.bind(this));\n\t\tfrappe.utils.play_sound('incoming-call');\n\t\tthis.dialog.show();\n\t}\n\n\tset_indicator(color, blink=false) {\n\t\tlet classes = `indicator ${color} ${blink ? 'blink': ''}`;\n\t\tthis.dialog.header.find('.indicator').attr('class', classes);\n\t}\n\n\tset_call_status(call_status) {\n\t\tlet title = '';\n\t\tcall_status = call_status || this.call_log.status;\n\t\tif (['Ringing'].includes(call_status) || !call_status) {\n\t\t\ttitle = __('Incoming call from {0}', [this.get_caller_name() || this.caller_number]);\n\t\t\tthis.set_indicator('blue', true);\n\t\t} else if (call_status === 'In Progress') {\n\t\t\ttitle = __('Call Connected');\n\t\t\tthis.set_indicator('yellow');\n\t\t} else if (call_status === 'Missed') {\n\t\t\tthis.set_indicator('red');\n\t\t\ttitle = __('Call Missed');\n\t\t} else if (['Completed', 'Disconnected'].includes(call_status)) {\n\t\t\tthis.set_indicator('red');\n\t\t\ttitle = __('Call Disconnected');\n\t\t} else {\n\t\t\tthis.set_indicator('blue');\n\t\t\ttitle = call_status;\n\t\t}\n\t\tthis.dialog.set_title(title);\n\t}\n\n\tupdate_call_log(call_log) {\n\t\tthis.call_log = call_log;\n\t\tthis.set_call_status();\n\t}\n\n\tclose_modal() {\n\t\tthis.dialog.hide();\n\t\tdelete erpnext.call_popup;\n\t}\n\n\tcall_disconnected(call_log) {\n\t\tfrappe.utils.play_sound('call-disconnect');\n\t\tthis.update_call_log(call_log);\n\t\tsetTimeout(() => {\n\t\t\tif (!this.dialog.get_value('call_summary')) {\n\t\t\t\tthis.close_modal();\n\t\t\t}\n\t\t}, 30000);\n\t}\n\n\tmake_last_interaction_section() {\n\t\tfrappe.xcall('erpnext.crm.doctype.utils.get_last_interaction', {\n\t\t\t'contact': this.call_log.contact,\n\t\t\t'lead': this.call_log.lead\n\t\t}).then(data => {\n\t\t\tconst comm_field = this.dialog.get_field('last_communication');\n\t\t\tif (data.last_communication) {\n\t\t\t\tconst comm = data.last_communication;\n\t\t\t\tcomm_field.set_value(comm.content);\n\t\t\t}\n\n\t\t\tif (data.last_issue) {\n\t\t\t\tconst issue = data.last_issue;\n\t\t\t\tconst issue_field = this.dialog.get_field(\"last_issue\");\n\t\t\t\tissue_field.set_value(issue.subject);\n\t\t\t\tissue_field.$wrapper.append(`\n\t\t\t\t\t<a class=\"text-medium\" href=\"#List/Issue?customer=${issue.customer}\">\n\t\t\t\t\t\t${__('View all issues from {0}', [issue.customer])}\n\t\t\t\t\t</a>\n\t\t\t\t`);\n\t\t\t}\n\t\t});\n\t}\n\n\tget_caller_name() {\n\t\tlet log = this.call_log;\n\t\treturn log.contact_name || log.lead_name;\n\t}\n\n\tsetup_listener() {\n\t\tfrappe.realtime.on(`call_${this.call_log.id}_disconnected`, call_log => {\n\t\t\tthis.call_disconnected(call_log);\n\t\t\t// Remove call disconnect listener after the call is disconnected\n\t\t\tfrappe.realtime.off(`call_${this.call_log.id}_disconnected`);\n\t\t});\n\t}\n}\n\n$(document).on('app_ready', function () {\n\tfrappe.realtime.on('show_call_popup', call_log => {\n\t\tif (!erpnext.call_popup) {\n\t\t\terpnext.call_popup = new CallPopup(call_log);\n\t\t} else {\n\t\t\terpnext.call_popup.update_call_log(call_log);\n\t\t\terpnext.call_popup.dialog.show();\n\t\t}\n\t});\n});\n","frappe.provide('frappe.ui.form');\n\nlet default_dimensions = {};\n\nlet doctypes_with_dimensions = [\"GL Entry\", \"Sales Invoice\", \"Purchase Invoice\", \"Payment Entry\", \"Asset\",\n\t\"Expense Claim\", \"Stock Entry\", \"Budget\", \"Payroll Entry\", \"Delivery Note\", \"Shipping Rule\", \"Loyalty Program\",\n\t\"Fee Schedule\", \"Fee Structure\", \"Stock Reconciliation\", \"Travel Request\", \"Fees\", \"POS Profile\", \"Opening Invoice Creation Tool\",\n\t\"Subscription\", \"Purchase Order\", \"Journal Entry\", \"Material Request\", \"Purchase Receipt\", \"Landed Cost Item\", \"Asset\"];\n\nlet child_docs = [\"Sales Invoice Item\", \"Purchase Invoice Item\", \"Purchase Order Item\", \"Journal Entry Account\",\n\t\"Material Request Item\", \"Delivery Note Item\", \"Purchase Receipt Item\", \"Stock Entry Detail\", \"Payment Entry Deduction\",\n\t\"Landed Cost Item\", \"Asset Value Adjustment\", \"Opening Invoice Creation Tool Item\", \"Subscription Plan\"];\n\nfrappe.call({\n\tmethod: \"erpnext.accounts.doctype.accounting_dimension.accounting_dimension.get_dimension_filters\",\n\tcallback: function(r) {\n\t\terpnext.dimension_filters = r.message[0];\n\t\tdefault_dimensions = r.message[1];\n\t}\n});\n\ndoctypes_with_dimensions.forEach((doctype) => {\n\tfrappe.ui.form.on(doctype, {\n\t\tonload: function(frm) {\n\t\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\t\tfrappe.model.with_doctype(dimension['document_type'], () => {\n\t\t\t\t\tif(frappe.meta.has_field(dimension['document_type'], 'is_group')) {\n\t\t\t\t\t\tfrm.set_query(dimension['fieldname'], {\n\t\t\t\t\t\t\t\"is_group\": 0\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tcompany: function(frm) {\n\t\t\tif(frm.doc.company && (Object.keys(default_dimensions || {}).length > 0)\n\t\t\t\t&& default_dimensions[frm.doc.company]) {\n\t\t\t\tfrm.trigger('update_dimension');\n\t\t\t}\n\t\t},\n\n\t\tupdate_dimension: function(frm) {\n\t\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\t\tif(frm.is_new()) {\n\t\t\t\t\tif(frm.doc.company && Object.keys(default_dimensions || {}).length > 0\n\t\t\t\t\t\t&& default_dimensions[frm.doc.company]) {\n\n\t\t\t\t\t\tlet default_dimension = default_dimensions[frm.doc.company][dimension['fieldname']];\n\n\t\t\t\t\t\tif(default_dimension) {\n\t\t\t\t\t\t\tif (frappe.meta.has_field(doctype, dimension['fieldname'])) {\n\t\t\t\t\t\t\t\tfrm.set_value(dimension['fieldname'], default_dimension);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$.each(frm.doc.items || frm.doc.accounts || [], function(i, row) {\n\t\t\t\t\t\t\t\tfrappe.model.set_value(row.doctype, row.name, dimension['fieldname'], default_dimension);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n});\n\nchild_docs.forEach((doctype) => {\n\tfrappe.ui.form.on(doctype, {\n\t\titems_add: function(frm, cdt, cdn) {\n\t\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\t\tvar row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(\"items\", row, [dimension['fieldname']]);\n\t\t\t});\n\t\t},\n\n\t\taccounts_add: function(frm, cdt, cdn) {\n\t\t\terpnext.dimension_filters.forEach((dimension) => {\n\t\t\t\tvar row = frappe.get_doc(cdt, cdn);\n\t\t\t\tfrm.script_manager.copy_from_first_row(\"accounts\", row, [dimension['fieldname']]);\n\t\t\t});\n\t\t}\n\t});\n});"],"names":["frappe","provide","$","extend","breadcrumbs","preferred","Item Group","Customer Group","Supplier Group","Territory","Sales Person","Sales Partner","Brand","Maintenance Schedule","Maintenance Visit","module_map","ERPNext Integrations","Geo","Portal","Utilities","Shopping Cart","Contacts","erpnext","get_currency","company","cur_frm","doc","get_doc","default_currency","boot","sysdefaults","currency","get_presentation_currency_list","const","currency_list","docs","filter","d","doctype","map","name","unshift","toggle_naming_series","fields_dict","naming_series","toggle_display","__islocal","hide_company","companies","Object","keys","locals","length","set_value","last_selected_company","is_perpetual_inventory_enabled","enable_perpetual_inventory","stale_rate_allowed","cint","allow_stale","setup_serial_no","grid_row","open_grid_row","grid_form","serial_no","get_status","$btn","__","appendTo","css","margin-bottom","margin-top","$wrapper","me","this","on","model","get_value","item_code","data","has_serial_no","show_serial_batch_selector","frm","route_to_adjustment_jv","args","with_doctype","let","journal_entry","get_new_doc","accounts","forEach","je_account","child_row","add_child","account","debit_in_account_currency","credit_in_account_currency","party_type","set_route","utils","set_party_dashboard_indicators","__onload","dashboard_info","company_wise_info","info","add_indicator_for_multicompany","dashboard","add_indicator","format_currency","billing_this_year","total_unpaid","loyalty_points","stats_area","removeClass","stats_area_row","addClass","color","indicator","get_party_name","Customer","Supplier","Employee","Member","copy_value_in_all_rows","dt","dn","table_fieldname","fieldname","cl","i","refresh_field","get_terms","tc_name","callback","call","method","template_name","r","make_bank_account","docname","freeze","doclist","sync","message","add_dimensions","report_name","index","filters","query_reports","dimension_filters","dimension","some","el","splice","label","fieldtype","options","make_subscription","make_pricing_rule","first_row_is_empty","child_table","isArray","remove_empty_first_row","child_table_name","rows","get_tree_options","option","unscrub_option","unscrub","user_permission","defaults","get_user_permissions","perm","c","sort","value","self","indexOf","get_tree_default","includes","get_default","copy_parent_value_in_all_row","parent_fieldname","create_new_doc","update_fields","new_doc","entries","ref","key","ui","form","make_quick_entry","select_alternate_items","opts","warehouse_field","item_field","dialog","Dialog","title","fields","cannot_add_rows","in_place_edit","get_data","hidden","in_list_view","read_only","default","onchange","warehouse","on_grid_fields_dict","actual_qty","get_query","e","query","primary_action","get_values","alternate_item","row","child_doctype","qty","required_qty","script_manager","trigger","then","original_item_field","child_docname","hide","primary_action_label","condition","alternative_items","df","push","grid","refresh","show","update_child_items","cannot_add_row","child_meta","get_meta","get_precision","find","f","precision","disabled","reqd","uom","exc","conversion_factor","trans_items","parent_doctype","parent_doctype_name","reload_doc","delivery_date","schedule_date","rate","map_current_doc","query_args","get_query_filters","get_query_method","_map","items","items_doctype","meta","get_docfield","link_fieldname","source_doctype","already_set","item_qty_map","each","source_name","src","flt","with_doc","source_doc","msgprint","type","source_names","target_doc","dirty","MultiSelectDialog","target","date_field","undefined","setters","add_filters_group","action","selections","values","link_formatters","item_name","employee_name","document","datetime","is_timezone_same","set_df_property","sys_defaults","time_zone","queries","user","lead","customer","supplier","item","bom","task","customer_filter","throw","get_label","contact_query","dynamic_link","link_doctype","link_name","address_query","company_address_query","is_your_company_address","supplier_filter","lead_filter","not_a_group_filter","is_group","employee","cstr","setup_queries","query_fn","set_query","parentfield","link_fields","get_docfields","setup_warehouse_query","cdt","cdn","SMSManager","setup","default_msg","Lead","Opportunity","Quotation","Sales Order","quotation_no","po_no","Delivery Note","Sales Invoice","Material Request","Purchase Order","Purchase Receipt","in_list","contact_person","party_name","mobile_no","contact_no","get_contact_number","contact","ref_doctype","ref_name","contact_name","number","show_dialog","mobile_nos","make_dialog","set_values","width","send","input","onclick","btn","v","set_working","receiver_list","msg","done_working","get_party_details","company_address","shipping_address","quotation_to","party","price_list","selling_price_list","bill_date","buying_price_list","shipping_address_name","posting_date","transaction_date","validate_mandatory","supplier_tds","updating_party_details","run_serially","add_item","is_new","prev_route","get_prev_route","get_address_display","address_field","display_field","address_dict","set_taxes_from_address","triggered_from_field","billing_address_field","shipping_address_field","tax_category","billing_address","set_taxes","customer_group","supplier_group","get_contact_details","trigger_on","get_shipping_address","address","stock","StockController","Controller","onload","setup_posting_date_time_check","docstatus","set_posting_time","nowdate","posting_time","now_time","show_stock_ledger","add_custom_button","route_options","voucher_no","from_date","to_date","moment","modified","format","show_cancelled_entries","show_general_ledger","group_by","payments","make_payment","$body","body","set_payment_primary_action","make_keyboard","select_text","click","select","set_primary_action","amount","submit_invoice","empty","html","render_template","show_payment_details","bind_keyboard_event","clear_amount","make_multimode_payment","change_amount","payment_val","outstanding_amount","mode_of_payment","multimode_payments","idx","paid_amount","selected_mode","repl","highlight_selected_row","bind_amount_change_event","set_outstanding_amount","val","conversion_rate","update_payment_amount","bind_form_control_event","bind_numeric_keys_event","attr","update_paid_amount","change","write_off_amount","selected_row","text","slice","stopPropagation","base_write_off_amount","calculate_outstanding_amount","show_amounts","calculate_write_off_amount","update_write_off","update_invoice","taxes_and_totals","apply_pricing_rule_on_item","effective_item_rate","price_list_rate","parenttype","blanket_order_rate","margin_type","rate_with_margin","margin_rate_or_amount","base_rate_with_margin","discount_percentage","discount_amount","calculate_taxes_and_totals","discount_amount_applied","_calculate_taxes_and_totals","calculate_discount_amount","is_return","calculate_total_advance","is_pos","update_paid_amount_for_return","calculate_commission","calculate_contribution","grand_total","refresh_fields","set_discount_amount","apply_discount_amount","validate_conversion_rate","calculate_item_values","initialize_taxes","determine_exclusive_rate","calculate_net_total","calculate_taxes","manipulate_grand_total_for_inclusive_tax","calculate_totals","_cleanup","conversion_rate_label","company_currency","get_company_currency","err_message","round_floats_in","net_rate","net_amount","item_tax_amount","total_weight","weight_per_unit","stock_qty","set_in_company_currency","tax","item_wise_tax_detail","tax_fields","charge_type","apply_discount_on","cscript","validate_taxes_and_charges","validate_inclusive_tax","has_inclusive_tax","included_in_print_rate","n","item_tax_map","_load_item_tax_rate","item_tax_rate","cumulated_tax_fraction","total_inclusive_tax_amount_per_qty","current_tax_fraction","get_current_tax_fraction","tax_fraction_for_current_item","inclusive_tax_amount_per_qty","grand_total_fraction_for_current_item","tax_rate","_get_tax_rate","row_id","add_deduct_tax","account_head","total_qty","total","base_total","net_total","base_net_total","base_amount","base_net_amount","rounding_adjustment","actual_tax_dict","tax_amount","current_tax_amount","get_current_tax_amount","tax_amount_for_current_item","tax_amount_after_discount_amount","category","grand_total_for_current_item","round_off_totals","set_cumulative_total","row_idx","JSON","parse","actual","set_item_wise_tax","tax_detail","item_wise_tax_amount","any_inclusive_tax","taxes","last_tax","non_inclusive_tax_amount","sum","diff","Math","abs","pow","tax_count","base_grand_total","taxes_and_charges_added","taxes_and_charges_deducted","total_taxes_and_charges","set_rounded_total","disable_rounded_total","rounded_total","base_rounded_total","round_based_on_smallest_currency_fraction","base_in_words","in_words","temporary_fields","stringify","additional_discount_percentage","scrub","distributed_amount","base_discount_amount","total_for_discount_amount","get_total_for_discount_amount","discount_amount_loss","total_actual_tax","actual_taxes_dict","actual_tax_amount","total_allocated_amount","adv","allocated_amount","total_advance","calculate_paid_amount","party_account_currency","total_amount_to_pay","total_amount_for_payment","redeem_loyalty_points","loyalty_amount","set_default_payment","calculate_change_amount","base_paid_amount","pay","payment_status","base_change_amount","payment_types","TransactionController","_super","flags","hide_serial_batch_dialog","has_margin_field","has_field","set_gross_profit","tax_table","set_dynamic_labels","via_discount_percentage","items_add","set_warehouse","get_field","set_query_for_batch","payment_terms_template","payment_schedule","calculate_net_weight","set_indicator_formatter","batch_no_field","get_route_options_for_new_doc","blanket_order_type","get_user_default","amended_from","return_against","setup_quality_inspection","inspection_type","reference_type","reference_name","description","item_serial_no","split","batch_no","make_payment_request","payment_request_type","recipient_id","contact_email","onload_post_render","load_after_mapping","after_ajax","apply_default_taxes","setup_item_selector","set_multiple_add","setup_sms","scan_barcode_field","set_new_description","is_mobile","$input_wrapper","$input_group","append","$input","barcode","scan_barcode","search_value","exist","cur_grid","row_to_modify","existing_item_row","blank_item_row","from_barcode","field","taxes_and_charges_field","taxes_and_charges","master_doctype","tax_template","status","page","add_menu_item","send_sms","update_stock","show_batch_dialog","validate_company_and_party","child","price_list_currency","plc_conversion_rate","order_type","is_subcontracted","ignore_pricing_rule","project","weight_uom","manufacturer","stock_uom","pos_profile","cost_center","item_tax_template","add_taxes_from_item_tax_template","free_item_data","apply_product_discount","is_internal_customer","is_internal_supplier","get_incoming_rate","toggle_conversion_factor","db","has_batch_no","k","remove_pricing_rule","apply_rule_on_other_items","grid_rows","remove","voucher_type","item_args","from_warehouse","allow_zero_valuation_rate","valid_serial_nos","serial_nos","trim","replace","x","join","user_defaults","set_qty_in_transactions_based_on_serial_no_input","validate","set_pricing","company_doc","default_letter_head","letter_head","default_selling_terms","default_buying_terms","update_item_tax_map","apply_pricing_rule","set_party_account","party_account_field","rt","due_date","recalculate_terms","message1","message2","final_message","term","payment_term","get_exchange_rate","exchange_rate","set_margin_amount_based_on_currency","set_actual_charges_based_on_currency","in_apply_price_list","apply_price_list","shipping_rule","fail","from_currency","to_currency","dont_fetch_price_list_rate","fields_map","toggle_enable","service_stop_date","start_date","Date","service_start_date","end_date","service_end_date","stop_date","total_net_weight","toggle_reqd","price_list_name","change_form_labels","change_grid_labels","set_currency_labels","item_grid","fname","set_column_disp","wrapper","recalculate","recalculate_values","calculate_charges","item_list","is_free_item","pricing_rules","parent","row_item","_set_values_for_item_list","_get_args","_get_item_list","territory","campaign","sales_partner","coupon_code","append_item","item_group","brand","children","price_list_rate_changed","items_rule_dict","l","existing_pricing_rule","apply_rule_on","price_or_product_discount","reset_plc_conversion","always","remove_free_item","applied_on_items","apply_on","trigger_price_list_rate","valid","master_name","as_json","item_codes","hasOwnProperty","is_recurring","recurring_id","owner_email","owner","user_info","email","notification_email_address","repeat_on_day_of_month","str_to_obj","getDate","refresh_many","months","Monthly","Quarterly","Half-yearly","Yearly","recurring_type","add_months","add_days","valuation_rate","gross_profit","get_advances","make_payment_entry","get_method_for_payment","make_payment_via_journal_entry","set_query_for_item_tax_template","valid_from","terms_template","against_blanket_order","blanket_order","set_reserve_warehouse","autofill_warehouse","supplied_items","on_close","receiving_stock","existing_stock","purpose","s_warehouse","require","SerialNoBatchSelector","warehouse_details","ItemSelector","Class","init","item_query","add_items_button","render_items","setTimeout","focus","results","timeout_id","clearTimeout","added","show_alert","add_new_row","timeout","txt","as_dict","get_filters","link_search","image","abbr","get_abbr","get_palette","docsUrl","help","help_links","url","agriculture","TernaryPlot","[object Object]","assign","make_svg","init_snap","init_config","make_plot","make_plot_marking","make_legend","mark_blip","$svg","paper","Snap","get","config","triangle_side","spacing","strokeWidth","stroke","scaling_factor","coords","sand","points","s","t","cos","loamy_sand","p","sandy_loam","loam","silt_loam","silt","silty_clay_loam","silty_clay","clay_loam","sandy_clay_loam","sandy_clay","clay","soil_type","polygon","get_coords","fill","get_color","transform","offset","exec_once","rect","font-size","x_blip","y_blip","sin","blip","circle","ItemQuickEntryForm","QuickEntryForm","after_insert","render_dialog","mandatory","get_variant_fields","concat","get_attributes_fields","check_naming_series_based_on","init_post_render_dialog_operations","preset_fields_for_template","attribute_html","init_for_create_variant_trigger","init_for_item_template_trigger","toggle_manufacturer_fields","register_primary_action","working","variant_values","create_variant","prop","get_variant_doc","template_doc","update_doc","insert","Promise","resolve","clear_doc","_from_link","update_calling_link","open_form_if_not_list","error","open_doc","template","item_template","has_variants","get_manufacturing_fields","manufacturer_fields","attribute_fields","init_post_template_trigger_operations","for_variant","template_field","toggle","is_manufacturer","variant_based_on","attributes","render_attributes","attributes_flag","attribute_values","attributes_count","toggleClass","dialog_field","initiate_render_attributes","desc","numeric_values","from_range","to_range","increment","init_make_control","attribute","label_area","insertAfter","input_area","closest","init_awesomplete_for_attribute","make_control","only_input","make_input","awesomplete","Awesomplete","minChars","maxItems","autoFirst","list","attribute_value","variant_doc","validate_mandatory_attributes","async","prototype","toString","msgprint_dialog","CustomerQuickEntryForm","skip_redirect_on_error","collapsible","views","MarketplaceFactory","Factory","show_not_found","pages","marketplace","container","change_to","hub","make","page_name","Marketplace","make_page","CallPopup","call_log","caller_number","from","setup_listener","static","minimizable","get_caller_name","depends_on","fielname","call_summary","xcall","summary","close_modal","set_call_status","get_close_btn","make_last_interaction_section","set_secondary_action","bind","play_sound","blink","classes","header","call_status","set_indicator","set_title","call_popup","update_call_log","comm_field","last_communication","comm","content","last_issue","issue","issue_field","subject","log","lead_name","realtime","call_disconnected","off","default_dimensions","update_dimension","default_dimension","copy_from_first_row","accounts_add"],"mappings":"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"}